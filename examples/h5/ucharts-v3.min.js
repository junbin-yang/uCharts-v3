!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t="undefined"!=typeof globalThis?globalThis:t||self).UCharts=i()}(this,function(){"use strict";class t{constructor(t={}){this.events={},this.events=t}on(t,i){this.events[t]=this.events[t]||[],this.events[t].push(i)}off(t,i){this.events[t]&&(this.events[t]=i?this.events[t].filter(t=>t!==i):[])}emit(t,i){this.events[t]&&this.events[t].forEach(t=>{try{t(i)}catch(t){console.error("[EventEmitter]",t)}})}}class i{static objectAssign(t,...i){if(null==t)throw new TypeError("[uCharts] Cannot convert undefined or null to object");if(!i||0===i.length)return t;const e=(t,i)=>{if(null==i)return t;for(const s in i)if(Object.prototype.hasOwnProperty.call(i,s)){const o=t[s],a=i[s];o&&a&&"object"==typeof o&&"object"==typeof a&&!Array.isArray(o)&&!Array.isArray(a)?t[s]=e(o,a):t[s]=a}return t};return i.forEach(i=>{null!=i&&(t=e(t,i))}),t}static isFloat(t){return t%1!=0}static toFixed(t,e=2){return i.isFloat(t)?t.toFixed(e):t}static hexToRgb(t,i=1){const e=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(t,i,e,s)=>i+i+e+e+s+s),s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!s)throw new Error(`Invalid HEX color: ${t}`);return`rgba(${parseInt(s[1],16)}, ${parseInt(s[2],16)}, ${parseInt(s[3],16)}, ${Math.max(0,Math.min(1,i))})`}static fillSeries(t,i){let e=0;for(let s=0;s<t.length;s++){let o=t[s];if(o.color||(o.color=i.color[e],e=(e+1)%i.color.length),o.linearIndex||(o.linearIndex=s),o.index||(o.index=0),o.type||(o.type=i.type),void 0===o.show&&(o.show=!0),o.pointShape||(o.pointShape="circle"),!o.legendShape)switch(o.type){case"line":o.legendShape="line";break;case"column":case"bar":o.legendShape="rect";break;case"area":case"mount":o.legendShape="triangle";break;default:o.legendShape="circle"}}return t}static filterSeries(t){let i=[];for(let e=0;e<t.length;e++)1==t[e].show&&i.push(t[e]);return i}static dataCombineStack(t,i){const e=t=>"object"==typeof t&&null!==t&&"value"in t&&"color"in t,s=t=>"object"==typeof t&&null!==t&&"name"in t&&"value"in t,o=new Array(i).fill(0);for(const a of t)for(let t=0;t<i;t++){const i=a.data[t];null!==i&&("number"==typeof i?o[t]+=i:e(i)||s(i)?o[t]+=i.value:Array.isArray(i)&&(o[t]+=i[0]||0))}return[...t.flatMap(t=>t.data.map(t=>null===t?{value:0}:"number"==typeof t?{value:t}:e(t)||s(t)?t:Array.isArray(t)?{value:t[0]||0}:{value:0})),...o.map(t=>({value:t}))]}static dataCombine(t){return t.reduce((t,i)=>{const e=i.data||[];return t.concat(e)},[])}static getDataRange(t,e){let s=0,o=e-t;return s=o>=1e4?1e3:o>=1e3?100:o>=100?10:o>=10?5:o>=1?1:o>=.1?.1:o>=.01?.01:o>=.001?.001:o>=1e-4?1e-4:o>=1e-5?1e-5:1e-6,{minRange:i.findRange(t,"lower",s),maxRange:i.findRange(e,"upper",s)}}static findRange(t,i,e){e=e||10,i=i||"upper";let s=1;for(;e<1;)e*=10,s*=10;for(t="upper"===i?Math.ceil(t*s):Math.floor(t*s);t%e!==0;)if("upper"===i){if(t==t+1)break;t++}else t--;return t/s}static fillCustomColor(t,i,s){let o=i||[];if("custom"==t&&0==o.length&&(o=e.linearColor),"custom"==t&&o.length<s.length){let t=s.length-o.length;for(let i=0;i<t;i++)o.push(e.linearColor[(i+1)%e.linearColor.length])}return o}static isSameSign(t,i){return Math.abs(t)===t&&Math.abs(i)===i||Math.abs(t)!==t&&Math.abs(i)!==i}static isSameXCoordinateArea(t,i){return this.isSameSign(t.x,i.x)}static isCollision(t,i){return t.end.x=t.start.x+t.width,t.end.y=t.start.y-t.height,i.end.x=i.start.x+i.width,i.end.y=i.start.y-i.height,!(i.start.x>t.end.x||i.end.x<t.start.x||i.end.y>t.start.y||i.start.y<t.end.y)}static convertCoordinateOrigin(t,i,e){return{x:e.x+t,y:e.y-i}}static approximatelyEqual(t,i){return Math.abs(t-i)<1e-10}}const e=new class{constructor(){this.fontUnit="vp",this.fontSize=13,this.fontColor="#666666",this.background="#FFFFFF",this.duration=1e3,this.rotate=!1,this.padding=[10,10,10,10],this.yAxisWidth=50,this.xAxisHeight=74,this.dataPointShape=["circle","circle","circle","circle"],this.color=["#3D8AF2","#58DB6B","#FAC858","#EE6666","#73C0DE","#3CA272","#FC8452","#9A60B4","#ea7ccc"],this.linearColor=["#0EE2F8","#2BDCA8","#FA7D8D","#EB88E2","#2AE3A0","#0EE2F8","#EB88E2","#6773E3","#F78A85"],this.pieChartLinePadding=15,this.pieChartTextPadding=5,this.titleFontSize=20,this.subtitleFontSize=15,this.radarLabelTextMargin=13}},s=t=>{i.objectAssign(e,t)};class o{constructor(s,o={}){if(this.context=s.context,!this.context)throw new Error("未获取到context");const a={type:"column",context:void 0,pixelRatio:1,fontSize:e.fontSize,fontColor:e.fontColor,background:e.background,title:{value:void 0,fontSize:e.titleFontSize,color:e.fontColor,offsetX:0,offsetY:0},subtitle:{value:void 0,fontSize:e.subtitleFontSize,color:"#7cb5ec",offsetX:0,offsetY:0},animation:!0,timing:"easeOut",duration:e.duration,enableScroll:!1,scrollPosition:"current",yAxis:{disabled:!1,disableGrid:!1,splitNumber:5,gridType:"solid",dashLength:8,gridColor:"#CCCCCC",padding:10,showTitle:!1,data:[]},xAxis:{disabled:!1,axisLine:!0,axisLineColor:"#CCCCCC",calibration:!1,fontColor:e.fontColor,fontSize:e.fontSize,lineHeight:20,marginTop:0,rotateLabel:!1,rotateAngle:45,labelCount:0,itemCount:5,boundaryGap:"center",disableGrid:!0,splitNumber:5,gridColor:"#CCCCCC",gridType:"solid",dashLength:4,gridEval:1,scrollShow:!1,scrollAlign:"left",scrollColor:"#A6A6A6",scrollBackgroundColor:"#EFEBEF",min:void 0,max:void 0,title:void 0,titleFontSize:e.fontSize,titleOffsetY:0,titleOffsetX:0,titleFontColor:e.fontColor},rotate:!1,rotateLock:!1,padding:e.padding,categories:[],series:[],legend:{show:!0,position:"bottom",float:"center",padding:5,margin:0,backgroundColor:"rgba(0,0,0,0)",borderColor:"rgba(0,0,0,0)",borderWidth:0,fontSize:e.fontSize,fontColor:e.fontColor,lineHeight:11,hiddenColor:"#CECECE",itemGap:10},touchMoveLimit:60,dataLabel:!0,dataPointShape:!0,dataPointShapeType:"solid",enableMarkLine:!1,color:e.color,extra:{column:{},arcbar:{},area:{},bar:{},bubble:{},candle:{},funnel:{},gauge:{},line:{},map:{},mix:{},mount:{},pie:{},radar:{},ring:{},rose:{},scatter:{},word:{},heatmap:{}}};if(this.opts=i.objectAssign({},a,s),""!=this.opts.background&&"none"!=this.opts.background||(this.opts.background="#FFFFFF"),this.opts.xAxis.scrollPosition=this.opts.xAxis.scrollAlign,this.opts.width=this.context.width,this.opts.height=this.context.height,this.opts.rotate){const t=this.opts.width,i=this.opts.height;this.opts.width=i,this.opts.height=t}this.opts.pixelRatio>1&&(e.yAxisWidth*=this.opts.pixelRatio,this.opts.fontSize*=this.opts.pixelRatio,this.opts.title.fontSize*=this.opts.pixelRatio,this.opts.subtitle.fontSize*=this.opts.pixelRatio),this.animation=void 0,this.event=new t(o),this.scrollOption={currentOffset:0,startTouchX:0,distance:0,lastMoveTime:0},this.opts.chartData={},this.opts.extra.markLine&&0==this.opts.enableMarkLine&&(this.opts.enableMarkLine=!0)}updateData(t){this.opts=i.objectAssign({},this.opts,t),this.opts.updateData=!0;let s=t.scrollPosition||"current";if(this.opts.width=this.context.width,this.opts.height=this.context.height,this.opts.rotate){const t=this.opts.width,i=this.opts.height;this.opts.width=i,this.opts.height=t}switch(s){case"current":this.opts._scrollDistance_=this.scrollOption.currentOffset;break;case"left":this.opts._scrollDistance_=0,this.scrollOption={currentOffset:0,startTouchX:0,distance:0,lastMoveTime:0};break;case"right":let t=this.calculateYAxisData(this.opts.series).yAxisWidth;e.yAxisWidth=t[0].width;let i=0,s=this.getXAxisPoints(this.opts.categories),o=s.xAxisPoints,a=s.startX;i=s.endX-a-s.eachSpacing*(o.length-1),this.scrollOption={currentOffset:i,startTouchX:i,distance:0,lastMoveTime:0},this.opts._scrollDistance_=i}this.render(),this.opts.updateData=!1}on(t,i){this.event.on(t,i)}getTouches(t){let i={x:0,y:0};return this.opts.rotate?(i.y=this.opts.height-t.x*this.opts.pixelRatio,i.x=t.y*this.opts.pixelRatio):(i.x=t.x*this.opts.pixelRatio,i.y=t.y*this.opts.pixelRatio),i}findLegendIndex(t,i){let e=-1;if(((t,i)=>t.x>i.start.x&&t.x<i.end.x&&t.y>i.start.y&&t.y<i.end.y)(t,i.area)){let s=i.points,o=-1;for(let i=0,a=s.length;i<a;i++){let a=s[i];for(let i=0;i<a.length;i++){o+=1;let s=a[i].area;if(s&&t.x>s[0]-0&&t.x<s[2]+0&&t.y>s[1]-0&&t.y<s[3]+0){e=o;break}}}return e}return e}isInExactChartArea(t){return t.x<=this.opts.width-this.opts.area[1]+10&&t.x>=this.opts.area[3]-10&&t.y>=this.opts.area[0]&&t.y<=this.opts.height-this.opts.area[2]}isInExactPieChartArea(t,i,e){return Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)<=Math.pow(e,2)}isInAngleRange(t,i,e){const s=t=>{for(;t<0;)t+=2*Math.PI;for(;t>2*Math.PI;)t-=2*Math.PI;return t};return t=s(t),(i=s(i))>(e=s(e))&&(e+=2*Math.PI,t<i&&(t+=2*Math.PI)),t>=i&&t<=e}getSeriesDataItem(t,e,s){let o=[],a=[],h=e.constructor.toString().indexOf("Array")>-1;if(h){let e=i.filterSeries(t);for(let t=0;t<s.length;t++)a.push(e[s[t]])}else a=t;for(let t=0;t<a.length;t++){let i=a[t],s=-1;if(s=h?e[t]:e,null!==i.data[s]&&void 0!==i.data[s]&&i.show){let t={};t.color=i.color,t.type=i.type,t.style=i.style,t.pointShape=i.pointShape,t.disableLegend=i.disableLegend,t.legendShape=i.legendShape,t.name=i.name,t.show=i.show,t.data=i.formatter?i.formatter(String(i.data[s]),s,i):i.data[s],o.push(t)}}return o}getToolTipData(t,i,e,s,o){let a=this.opts.chartData.calPoints?this.opts.chartData.calPoints:[],h={};if(e.length>0){let t=[];for(let i=0;i<e.length;i++)t.push(a[e[i]]);h=t[0][i[0]]}else for(let t=0;t<a.length;t++)if(a[t][i]){h=a[t][i];break}return{textList:t.map(t=>{var e,a;let h="";this.opts.categories&&this.opts.categories.length>0&&(h=s[i]);let n=t.data;return"object"==typeof t.data&&null!==t.data&&(n=t.data.value),{text:(null==o?void 0:o.formatter)?o.formatter(t,h,i,this.opts):t.name+": "+n,color:t.color,legendShape:"auto"==(null===(e=this.opts.extra.tooltip)||void 0===e?void 0:e.legendShape)?t.legendShape:null===(a=this.opts.extra.tooltip)||void 0===a?void 0:a.legendShape}}),offset:{x:Math.round(h.x),y:Math.round(h.y)}}}getMixToolTipData(t,i,e,s){let o=this.opts.chartData.xAxisPoints[i]+this.opts.chartData.eachSpacing/2,a=t.map(t=>{var o,a;return{text:(null==s?void 0:s.formatter)?s.formatter(t,e[i],i,this.opts):t.name+": "+t.data,color:t.color,disableLegend:!!t.disableLegend,legendShape:"auto"==(null===(o=this.opts.extra.tooltip)||void 0===o?void 0:o.legendShape)?t.legendShape:null===(a=this.opts.extra.tooltip)||void 0===a?void 0:a.legendShape}});return a=a.filter(t=>{if(!0!==t.disableLegend)return t}),{textList:a,offset:{x:Math.round(o),y:0}}}getLegendDataIndex(t){let i=this.getTouches(t);return this.findLegendIndex(i,this.opts.chartData.legendData)}getCurrentDataIndex(t){const i=(t,i,e=0)=>{let s={index:-1,group:[]},o=this.opts.chartData.eachSpacing/2,a=this.opts.chartData.yAxisPoints;return i&&i.length>0&&this.isInExactChartArea(t)&&a.forEach((i,a)=>{t.y+e+o>i&&(s.index=a)}),s},e=(t,i)=>{let e={index:-1,group:[]},s=this.getPieDataPoints(i.series);if(i&&i.center&&this.isInExactPieChartArea(t,i.center,i.radius)){let o=Math.atan2(i.center.y-t.y,t.x-i.center.x);o=-o,this.opts.extra.pie&&this.opts.extra.pie.offsetAngle&&(o-=this.opts.extra.pie.offsetAngle*Math.PI/180),this.opts.extra.ring&&this.opts.extra.ring.offsetAngle&&(o-=this.opts.extra.ring.offsetAngle*Math.PI/180);for(let t=0,i=s.length;t<i;t++)if(this.isInAngleRange(o,s[t]._start_,s[t]._start_+2*s[t]._proportion_*Math.PI)){e.index=t;break}}return e},s=(t,i)=>{var e;let s={index:-1,group:[]},o=this.getRoseDataPoints(this.opts._series_,null===(e=this.opts.extra.rose)||void 0===e?void 0:e.type,i.radius,i.radius);if(i&&i.center&&this.isInExactPieChartArea(t,i.center,i.radius)){let e=Math.atan2(i.center.y-t.y,t.x-i.center.x);e=-e,this.opts.extra.rose&&this.opts.extra.rose.offsetAngle&&(e-=this.opts.extra.rose.offsetAngle*Math.PI/180);for(let t=0,i=o.length;t<i;t++)if(this.isInAngleRange(e,o[t]._start_,o[t]._start_+2*o[t]._rose_proportion_*Math.PI)){s.index=t;break}}return s},o=(t,i,e)=>{let s=2*Math.PI/e,o={index:-1,group:[]};if(this.isInExactPieChartArea(t,i.center,i.radius)){const e=t=>(t<0&&(t+=2*Math.PI),t>2*Math.PI&&(t-=2*Math.PI),t);let a=Math.atan2(i.center.y-t.y,t.x-i.center.x);a*=-1,a<0&&(a+=2*Math.PI),i.angleList.map(t=>t=e(-1*t)).forEach((t,i)=>{let h=e(t-s/2),n=e(t+s/2);n<h&&(n+=2*Math.PI),(a>=h&&a<=n||a+2*Math.PI>=h&&a+2*Math.PI<=n)&&(o.index=i)})}return o},a=t=>{let i={index:-1,group:[]},e=this.opts.chartData.mapData,s=this.opts.series,o=this.pointToCoordinate(t.y,t.x,e.bounds,e.scale,e.xoffset,e.yoffset),a=[o.x,o.y];for(let t=0,e=s.length;t<e;t++){let e=s[t].geometry.coordinates;if(this.isPoiWithinPoly(a,e,this.opts.chartData.mapData.mercator)){i.index=t;break}}return i};let h=this.getTouches(t);return"pie"===this.opts.type||"ring"===this.opts.type?e(h,this.opts.chartData.pieData):"rose"===this.opts.type?s(h,this.opts.chartData.pieData):"radar"===this.opts.type?o(h,this.opts.chartData.radarData,this.opts.categories.length):"funnel"===this.opts.type?((t,i)=>{let e={index:-1,group:[]};for(let s=0,o=i.series.length;s<o;s++){let o=i.series[s];if(t.x>o.funnelArea[0]&&t.x<o.funnelArea[2]&&t.y>o.funnelArea[1]&&t.y<o.funnelArea[3]){e.index=s;break}}return e})(h,this.opts.chartData.funnelData):"map"===this.opts.type?a(h):"word"===this.opts.type?((t,i)=>{let e={index:-1,group:[]};for(let s=0,o=i.length;s<o;s++){let o=i[s];if(t.x>o.area[0]&&t.x<o.area[2]&&t.y>o.area[1]&&t.y<o.area[3]){e.index=s;break}}return e})(h,this.opts.chartData.wordCloudData):"bar"===this.opts.type?i(h,this.opts.chartData.calPoints,Math.abs(this.scrollOption.currentOffset)):((t,i,e=0)=>{let s={index:-1,group:[]},o=this.opts.chartData.eachSpacing/2,a=[];if(i&&i.length>0){if(this.opts.categories){for(let t=1;t<this.opts.chartData.xAxisPoints.length;t++)a.push(this.opts.chartData.xAxisPoints[t]-o);"line"!=this.opts.type&&"area"!=this.opts.type||"justify"!=this.opts.xAxis.boundaryGap||(a=this.opts.chartData.xAxisPoints)}else o=0;if(this.isInExactChartArea(t))if(this.opts.categories&&0!=this.opts.categories.length)a.forEach((i,a)=>{t.x+e+o>i&&(s.index=a)});else{let e=Array(i.length);for(let s=0;s<i.length;s++){e[s]=Array(i[s].length);for(let o=0;o<i[s].length;o++)e[s][o]=Math.abs(i[s][o].x-t.x)}let o=Array(e.length),a=Array(e.length);for(let t=0;t<e.length;t++)o[t]=Math.min(...e[t]),a[t]=e[t].indexOf(o[t]);let h=Math.min(...o);s.index=[];for(let t=0;t<o.length;t++)o[t]==h&&(s.group.push(t),s.index.push(a[t]))}}return s})(h,this.opts.chartData.calPoints,Math.abs(this.scrollOption.currentOffset))}touchLegend(t,i){let e=this.getLegendDataIndex(t);e>=0&&("candle"==this.opts.type?this.opts.seriesMA[e].show=!this.opts.seriesMA[e].show:this.opts.series[e].show=!this.opts.series[e].show,this.opts.animation=!!i,this.opts._scrollDistance_=this.scrollOption.currentOffset,this.render())}showToolTip(t,e){var s,o,a,h,n,r,l,p,c;let x=this.getTouches(t);if(this.opts=i.objectAssign({},this.opts,{_scrollDistance_:this.scrollOption.currentOffset,animation:!1}),"line"===this.opts.type||"area"===this.opts.type||"column"===this.opts.type||"scatter"===this.opts.type||"bubble"===this.opts.type){let i=this.getCurrentDataIndex(t),s=null==(null==e?void 0:e.index)?i.index:e.index;if("number"==typeof s&&s>-1||Array.isArray(s)&&s.length>0){let t=this.getSeriesDataItem(this.opts.series,s,i.group);if(0!==t.length){let o=this.getToolTipData(t,s,i.group,this.opts.categories,e),a=o.textList,h=o.offset;h.y=x.y,this.opts.tooltip={textList:(null==e?void 0:e.textList)?e.textList:a,offset:(null==e?void 0:e.offset)?e.offset:h,option:e,index:s,group:i.group}}}else this.opts.tooltip={show:!1}}if("mount"===this.opts.type){let a=null==(null==e?void 0:e.index)?this.getCurrentDataIndex(t).index:e.index;if("number"==typeof a&&a>-1)if(this.opts=i.objectAssign({},this.opts,{animation:!1}),"number"==typeof a){let t=this.opts._series_[a],i=[{text:(null==e?void 0:e.formatter)?e.formatter(t,"",a,this.opts):t.name+": "+t.data,color:t.color,legendShape:"auto"==(null===(s=this.opts.extra.tooltip)||void 0===s?void 0:s.legendShape)?t.legendShape:null===(o=this.opts.extra.tooltip)||void 0===o?void 0:o.legendShape}],h={x:this.opts.chartData.calPoints[a].x,y:x.y};this.opts.tooltip={textList:void 0!==(null==e?void 0:e.textList)?e.textList:i,offset:void 0!==(null==e?void 0:e.offset)?e.offset:h,option:e,index:a}}else this.opts.tooltip={show:!1}}if("bar"===this.opts.type){let i=this.getCurrentDataIndex(t),s=null==(null==e?void 0:e.index)?i.index:e.index;if("number"==typeof s&&s>-1){let t=this.getSeriesDataItem(this.opts.series,s,i.group);if(0!==t.length){let o=this.getToolTipData(t,s,i.group,this.opts.categories,e),a=o.textList,h=o.offset;h.x=x.x,this.opts.tooltip={textList:void 0!==(null==e?void 0:e.textList)?e.textList:a,offset:void 0!==(null==e?void 0:e.offset)?e.offset:h,option:e,index:s}}}else this.opts.tooltip={show:!1}}if("mix"===this.opts.type){let s=this.getCurrentDataIndex(t),o=null==(null==e?void 0:e.index)?s.index:e.index;if("number"==typeof o&&o>-1){let t=this.scrollOption.currentOffset;this.opts=i.objectAssign({},this.opts,{_scrollDistance_:t,animation:!1});let a=this.getSeriesDataItem(this.opts.series,o,s.group);if(0!==a.length){let t=this.getMixToolTipData(a,o,this.opts.categories,e),i=t.textList,s=t.offset;s.y=x.y,this.opts.tooltip={textList:void 0!==(null==e?void 0:e.textList)?e.textList:i,offset:void 0!==(null==e?void 0:e.offset)?e.offset:s,option:e,index:o}}}else this.opts.tooltip={show:!1}}if("pie"===this.opts.type||"ring"===this.opts.type||"rose"===this.opts.type||"funnel"===this.opts.type){let s=null==(null==e?void 0:e.index)?this.getCurrentDataIndex(t).index:e.index;if("number"==typeof s&&s>-1){this.opts=i.objectAssign({},this.opts,{animation:!1});let t=i.objectAssign({},this.opts._series_[s]),o=[{text:(null==e?void 0:e.formatter)?e.formatter(t,"",s,this.opts):t.name+": "+t.data,color:t.color,legendShape:"auto"==(null===(a=this.opts.extra.tooltip)||void 0===a?void 0:a.legendShape)?t.legendShape:null===(h=this.opts.extra.tooltip)||void 0===h?void 0:h.legendShape}],n={x:x.x,y:x.y};this.opts.tooltip={textList:void 0!==(null==e?void 0:e.textList)?e.textList:o,offset:void 0!==(null==e?void 0:e.offset)?e.offset:n,option:e,index:s}}else this.opts.tooltip={show:!1}}if("radar"===this.opts.type){let s=this.getCurrentDataIndex(t),o=null==(null==e?void 0:e.index)?s.index:e.index;if("number"==typeof o&&o>-1){this.opts=i.objectAssign({},this.opts,{animation:!1});let t=this.getSeriesDataItem(this.opts.series,o,s.group);if(0!==t.length){let i=t.map(t=>{var i,s;const a=this.opts.categories;return{text:(null==e?void 0:e.formatter)?e.formatter(t,a[o],o,this.opts):t.name+": "+t.data,color:t.color,legendShape:"auto"==(null===(i=this.opts.extra.tooltip)||void 0===i?void 0:i.legendShape)?t.legendShape:null===(s=this.opts.extra.tooltip)||void 0===s?void 0:s.legendShape}}),s={x:x.x,y:x.y};this.opts.tooltip={textList:void 0!==(null==e?void 0:e.textList)?e.textList:i,offset:void 0!==(null==e?void 0:e.offset)?e.offset:s,option:e,index:o}}}else this.opts.tooltip={show:!1}}if("word"===this.opts.type){let s=this.getCurrentDataIndex(t),o=null==(null==e?void 0:e.index)?s.index:e.index;if("number"==typeof o&&o>-1){this.opts=i.objectAssign({},this.opts,{animation:!1});let t=i.objectAssign({},this.opts.series[o]),s=[{text:(null==e?void 0:e.formatter)?e.formatter(t,"",o,this.opts):t.name,color:t.color,legendShape:"auto"==(null===(n=this.opts.extra.tooltip)||void 0===n?void 0:n.legendShape)?t.legendShape:null===(r=this.opts.extra.tooltip)||void 0===r?void 0:r.legendShape}],a={x:x.x,y:x.y};this.opts.tooltip={textList:void 0!==(null==e?void 0:e.textList)?e.textList:s,offset:void 0!==(null==e?void 0:e.offset)?e.offset:a,option:e,index:o}}else this.opts.tooltip={show:!1};this.opts.updateData=!1}if("candle"===this.opts.type){let s=this.getCurrentDataIndex(t),o=null==(null==e?void 0:e.index)?s.index:e.index;if("number"==typeof o&&o>-1){let t=this.scrollOption.currentOffset;this.opts=i.objectAssign({},this.opts,{_scrollDistance_:t,animation:!1});let a=this.getSeriesDataItem(this.opts.series,o,s.group);if(0!==a.length){let t=this.getCandleToolTipData(this.opts.series[0].data,a,o,this.opts.categories,this.opts.extra.candle),i=t.textList,s=t.offset;s.y=x.y,this.opts.tooltip={textList:(null==e?void 0:e.textList)?e.textList:i,offset:(null==e?void 0:e.offset)?e.offset:s,option:e,index:o}}}else this.opts.tooltip={show:!1}}if("map"===this.opts.type){let s=this.getCurrentDataIndex(t),o=null==(null==e?void 0:e.index)?s.index:e.index;if("number"==typeof o&&o>-1){this.opts=i.objectAssign({},this.opts,{animation:!1});let t=i.objectAssign({},this.opts.series[o]);t.name=null===(l=null==t?void 0:t.properties)||void 0===l?void 0:l.name;let s=[{text:(null==e?void 0:e.formatter)?e.formatter(t.name,"",o,this.opts):t.name,color:null==t?void 0:t.color,legendShape:"auto"==(null===(p=this.opts.extra.tooltip)||void 0===p?void 0:p.legendShape)?t.legendShape:null===(c=this.opts.extra.tooltip)||void 0===c?void 0:c.legendShape}],a={x:x.x,y:x.y};this.opts.tooltip={textList:void 0!==(null==e?void 0:e.textList)?e.textList:s,offset:void 0!==(null==e?void 0:e.offset)?e.offset:a,option:e,index:o}}else this.opts.tooltip={show:!1};this.opts.updateData=!1}this.render()}scrollStart(t){const i=this.getTouches(t);!0===this.opts.enableScroll&&(this.scrollOption.startTouchX=i.x)}scroll(t){0===this.scrollOption.lastMoveTime&&(this.scrollOption.lastMoveTime=Date.now());let e=this.opts.touchMoveLimit||60,s=Date.now();if(!(s-Number(this.scrollOption.lastMoveTime)<Math.floor(1e3/e))&&0!=this.scrollOption.startTouchX&&(this.scrollOption.lastMoveTime=s,!0===this.opts.enableScroll)){let e=this.getTouches(t).x-Number(this.scrollOption.startTouchX),s=this.scrollOption.currentOffset,o=this.calValidDistance(s+e);return this.scrollOption.distance=e=o-s,this.opts=i.objectAssign({},this.opts,{_scrollDistance_:s+e,animation:!1}),this.render(),s+e}}scrollEnd(){if(!0===this.opts.enableScroll){let t=this.scrollOption,i=t.currentOffset,e=t.distance;this.scrollOption.currentOffset=i+e,this.scrollOption.distance=0,this.scrollOption.moveCount=0}}translate(t){this.scrollOption={currentOffset:t,startTouchX:t,distance:0,lastMoveTime:0},this.opts=i.objectAssign({},this.opts,{_scrollDistance_:t,animation:!1}),this.render()}off(t,i){this.event.off(t,i)}setFillStyle(t){this.context.fillStyle=t}setStrokeStyle(t){this.context.strokeStyle=t}setLineWidth(t){this.context.lineWidth=t}setLineCap(t){this.context.lineCap=t}setFontSize(t){this.context.font=String(t)+e.fontUnit+" sans-serif"}setTextAlign(t){this.context.textAlign=t}setTextBaseline(t){this.context.textBaseline=t}setShadow(t,i,e,s){this.context.shadowColor=s,this.context.shadowOffsetX=t,this.context.shadowOffsetY=i,this.context.shadowBlur=e}setLineDash(t){this.context.setLineDash(t)}measureText(t,i){return this.setFontSize(i),this.context.measureText(t).width}contextRotate(){!0!==this.opts.rotateLock?(this.context.translate(this.opts.height,0),this.context.rotate(90*Math.PI/180)):!0!==this.opts._rotate_&&(this.context.translate(this.opts.height,0),this.context.rotate(90*Math.PI/180),this.opts._rotate_=!0)}calculateLegendData(t,i){let e={area:{start:{x:0,y:0},end:{x:0,y:0},width:0,height:0,wholeWidth:0,wholeHeight:0},points:[],widthArr:[],heightArr:[]};if(!1===this.opts.legend.show)return i.legendData=e,e;const s=this.opts.legend.padding*this.opts.pixelRatio,o=this.opts.legend.margin*this.opts.pixelRatio,a=this.opts.legend.fontSize?this.opts.legend.fontSize*this.opts.pixelRatio:this.opts.fontSize;let h=15*this.opts.pixelRatio,n=5*this.opts.pixelRatio,r=Math.max(this.opts.legend.lineHeight*this.opts.pixelRatio,a);if("top"==this.opts.legend.position||"bottom"==this.opts.legend.position){let i=[],l=0,p=[],c=[];for(let e=0;e<t.length;e++){let s=t[e];const o=s.legendText?s.legendText:s.name;let r=h+n+this.measureText(o||"undefined",a)+this.opts.legend.itemGap*this.opts.pixelRatio;l+r>this.opts.width-this.opts.area[1]-this.opts.area[3]?(i.push(c),p.push(l-this.opts.legend.itemGap*this.opts.pixelRatio),l=r,c=[s]):(l+=r,c.push(s))}if(c.length){i.push(c),p.push(l-this.opts.legend.itemGap*this.opts.pixelRatio),e.widthArr=p;let t=Math.max(...p);switch(this.opts.legend.float){case"left":e.area.start.x=this.opts.area[3],e.area.end.x=this.opts.area[3]+t+2*s;break;case"right":e.area.start.x=this.opts.width-this.opts.area[1]-t-2*s,e.area.end.x=this.opts.width-this.opts.area[1];break;default:e.area.start.x=(this.opts.width-t)/2-s,e.area.end.x=(this.opts.width+t)/2+s}e.area.width=t+2*s,e.area.wholeWidth=t+2*s,e.area.height=i.length*r+2*s,e.area.wholeHeight=i.length*r+2*s+2*o,e.points=i}}else{let i=t.length,l=this.opts.height-this.opts.area[0]-this.opts.area[2]-2*o-2*s,p=Math.min(Math.floor(l/r),i);switch(e.area.height=p*r+2*s,e.area.wholeHeight=p*r+2*s,this.opts.legend.float){case"top":e.area.start.y=this.opts.area[0]+o,e.area.end.y=this.opts.area[0]+o+e.area.height;break;case"bottom":e.area.start.y=this.opts.height-this.opts.area[2]-o-e.area.height,e.area.end.y=this.opts.height-this.opts.area[2]-o;break;default:e.area.start.y=(this.opts.height-e.area.height)/2,e.area.end.y=(this.opts.height+e.area.height)/2}let c=i%p===0?i/p:Math.floor(i/p+1),x=[];for(let i=0;i<c;i++){let e=t.slice(i*p,i*p+p);x.push(e)}if(e.points=x,x.length){for(let t=0;t<x.length;t++){let i=x[t],o=0;for(let t=0;t<i.length;t++){let e=h+n+this.measureText(i[t].name||"undefined",a)+this.opts.legend.itemGap*this.opts.pixelRatio;e>o&&(o=e)}e.widthArr.push(o),e.heightArr.push(i.length*r+2*s)}let t=0;for(let i=0;i<e.widthArr.length;i++)t+=e.widthArr[i];e.area.width=t-this.opts.legend.itemGap*this.opts.pixelRatio+2*s,e.area.wholeWidth=e.area.width+s}}switch(this.opts.legend.position){case"top":e.area.start.y=this.opts.area[0]+o,e.area.end.y=this.opts.area[0]+o+e.area.height;break;case"bottom":e.area.start.y=this.opts.height-this.opts.area[2]-e.area.height-o,e.area.end.y=this.opts.height-this.opts.area[2]-o;break;case"left":e.area.start.x=this.opts.area[3],e.area.end.x=this.opts.area[3]+e.area.width;break;case"right":e.area.start.x=this.opts.width-this.opts.area[1]-e.area.width,e.area.end.x=this.opts.width-this.opts.area[1]}return i.legendData=e,e}getYAxisTextList(t,e,s){let o=[];o="stack"===e?i.dataCombineStack(t,this.opts.categories.length):i.dataCombine(t);const a=[];o.forEach(t=>{if(null!==t)if(Array.isArray(t)){if("candle"===this.opts.type)t.forEach(t=>{"number"==typeof t?a.push(t):t&&"object"==typeof t&&"number"==typeof t.value&&a.push(t.value)});else if(t.length>1){const i=t[1];"number"==typeof i?a.push(i):i&&"object"==typeof i&&"number"==typeof i.value&&a.push(i.value)}}else"object"==typeof t?"number"==typeof t.value&&a.push(t.value):"number"==typeof t&&a.push(t)});let h=s.min||0,n=s.max||0;a.length>0&&(h=Math.min(...a),n=Math.max(...a)),h===n&&(0==n?n=10:h=0);let r=i.getDataRange(h,n),l=void 0===s.min||null===s.min?r.minRange:s.min,p=((void 0===s.max||null===s.max?r.maxRange:s.max)-l)/this.opts.yAxis.splitNumber,c=[];for(let t=0;t<=this.opts.yAxis.splitNumber;t++)c.push(l+p*t);return c.reverse()}getXAxisTextList(t,e){let s=[];s="stack"===e?i.dataCombineStack(t,this.opts.categories.length):i.dataCombine(t);const o=[];s=s.filter(t=>"object"==typeof t&&null!==t?t.constructor.toString().indexOf("Array")>-1?null!==t:null!==t.value:null!==t),s.map(t=>{"object"==typeof t&&null!==t?Array.isArray(t)?"candle"==this.opts.type?t.map(t=>{o.push(t)}):o.push(t[0]):o.push(t.value):o.push(t)});let a=0,h=0;if(o.length>0&&(a=Math.min(...o),h=Math.max(...o)),"number"==typeof this.opts.xAxis.min&&(a=Math.min(this.opts.xAxis.min,a)),"number"==typeof this.opts.xAxis.max&&(h=Math.max(this.opts.xAxis.max,h)),a===h){h+=h||10}let n=a,r=[],l=(h-n)/this.opts.xAxis.splitNumber;for(let t=0;t<=this.opts.xAxis.splitNumber;t++)r.push(n+l*t);return r}calculateYAxisData(t){let e=i.objectAssign({},{type:""},this.opts.extra.column);const s=this.opts.yAxis.data.length;let o=new Array(s),a={rangesFormat:[],ranges:[],yAxisWidth:[]};if(s>0){for(let i=0;i<s;i++){o[i]=[];for(let e=0;e<t.length;e++)t[e].index==i&&o[i].push(t[e])}let h=new Array(s),n=new Array(s),r=new Array(s);for(let t=0;t<s;t++){let s=this.opts.yAxis.data[t];1==this.opts.yAxis.disabled&&(s.disabled=!0),"categories"===s.type?(s.formatter||(s.formatter=(t,i,e)=>t+(s.unit||"")),s.categories=s.categories||this.opts.categories,h[t]=s.categories):(s.formatter||(s.formatter=(t,e,o)=>i.toFixed(t,s.tofix||0)+(s.unit||"")),h[t]=this.getYAxisTextList(o[t],e.type,s));let a=s.fontSize?s.fontSize*this.opts.pixelRatio:this.opts.fontSize;r[t]={position:s.position?s.position:"left",width:0},n[t]=h[t].map((i,e)=>{let o=s.formatter(i,e,this.opts);return r[t].width=Math.max(r[t].width,this.measureText(o,a)+5),o});let l=s.calibration?4*this.opts.pixelRatio:0;r[t].width+=l+3*this.opts.pixelRatio,!0===s.disabled&&(r[t].width=0)}a.rangesFormat=n,a.ranges=h,a.yAxisWidth=r}else{let s=new Array(1),o=new Array(1),h=new Array(1);"bar"===this.opts.type?(s[0]=this.opts.categories,this.opts.yAxis.formatter||(this.opts.yAxis.formatter=(t,i,e)=>t+(this.opts.yAxis.unit||""))):(this.opts.yAxis.formatter||(this.opts.yAxis.formatter=(t,e,s)=>{var o;return i.toFixed(Number(t),null!==(o=this.opts.yAxis.tofix)&&void 0!==o?o:0)+(this.opts.yAxis.unit||"")}),s[0]=this.getYAxisTextList(t,e.type,{})),h[0]={position:"left",width:0};let n=this.opts.yAxis.fontSize*this.opts.pixelRatio||this.opts.fontSize;o[0]=s[0].map((t,i)=>{let e;e="string"==typeof t?this.opts.yAxis.formatter(Number(t),i,this.opts):this.opts.yAxis.formatter(t,i,this.opts);const s=this.measureText(e,n)+5;return h[0].width=Math.max(h[0].width,s),e}),h[0].width+=3*this.opts.pixelRatio,!0===this.opts.yAxis.disabled?(h[0]={position:"left",width:0},this.opts.yAxis.data[0]={disabled:!0}):(this.opts.yAxis.data[0]={disabled:!1,position:"left",max:this.opts.yAxis.max,min:this.opts.yAxis.min,formatter:this.opts.yAxis.formatter},"bar"===this.opts.type&&(this.opts.yAxis.data[0].categories=this.opts.categories,this.opts.yAxis.data[0].type="categories")),a.rangesFormat=o,a.ranges=s,a.yAxisWidth=h}return a}calculateXAxisData(t){let e=i.objectAssign({},{type:""},this.opts.extra.bar),s={xAxisPoints:[],startX:0,endX:0,eachSpacing:0,angle:0,xAxisHeight:this.opts.xAxis.lineHeight*this.opts.pixelRatio+this.opts.xAxis.marginTop*this.opts.pixelRatio,ranges:this.getXAxisTextList(t,e.type)};s.rangesFormat=s.ranges.map(t=>(t=Number(i.toFixed(t,2)),String(t)));let o=s.ranges.map(t=>(t=Number(i.toFixed(t,2)),String(t)));return s=i.objectAssign(s,this.getXAxisPoints(o)),s.eachSpacing,o.map(t=>this.measureText(t,this.opts.xAxis.fontSize*this.opts.pixelRatio)),!0===this.opts.xAxis.disabled&&(s.xAxisHeight=0),s}getXAxisPoints(t){let i=this.opts.width-this.opts.area[1]-this.opts.area[3],e=this.opts.enableScroll?Math.min(this.opts.xAxis.itemCount,t.length):t.length;("line"==this.opts.type||"area"==this.opts.type||"scatter"==this.opts.type||"bubble"==this.opts.type||"bar"==this.opts.type)&&e>1&&"justify"==this.opts.xAxis.boundaryGap&&(e-=1);let s=0;"mount"==this.opts.type&&this.opts.extra&&this.opts.extra.mount&&this.opts.extra.mount.widthRatio&&this.opts.extra.mount.widthRatio>1&&(this.opts.extra.mount.widthRatio>2&&(this.opts.extra.mount.widthRatio=2),s=this.opts.extra.mount.widthRatio-1,e+=s);let o=i/e,a=[],h=this.opts.area[3],n=this.opts.width-this.opts.area[1];return t.forEach((t,i)=>{a.push(h+s/2*o+i*o)}),"justify"!==this.opts.xAxis.boundaryGap&&(!0===this.opts.enableScroll?a.push(h+s*o+t.length*o):a.push(n)),{xAxisPoints:a,startX:h,endX:n,eachSpacing:o}}calculateCategoriesData(t){let i={angle:0,xAxisHeight:this.opts.xAxis.lineHeight*this.opts.pixelRatio+this.opts.xAxis.marginTop*this.opts.pixelRatio},e=this.opts.xAxis.fontSize*this.opts.pixelRatio,s=t.map((t,i)=>{let s=this.opts.xAxis.formatter?this.opts.xAxis.formatter(t,i,this.opts):t;return this.measureText(String(s),e)}),o=Math.max(...s);if(1==this.opts.xAxis.rotateLabel){i.angle=this.opts.xAxis.rotateAngle*Math.PI/180;let t=this.opts.xAxis.marginTop*this.opts.pixelRatio*2+Math.abs(o*Math.sin(i.angle));t=t<e+this.opts.xAxis.marginTop*this.opts.pixelRatio*2?t+this.opts.xAxis.marginTop*this.opts.pixelRatio*2:t,i.xAxisHeight=t}return this.opts.enableScroll&&this.opts.xAxis.scrollShow&&(i.xAxisHeight+=6*this.opts.pixelRatio),this.opts.xAxis.disabled&&(i.xAxisHeight=0),i}drawYAxisGrid(t){var i;if(!0===this.opts.yAxis.disableGrid)return;let e=(this.opts.height-this.opts.area[0]-this.opts.area[2])/this.opts.yAxis.splitNumber,s=this.opts.area[3],o=this.opts.chartData.xAxisData.xAxisPoints,a=this.opts.chartData.xAxisData.eachSpacing,h=a*(o.length-1);"mount"==this.opts.type&&this.opts.extra&&this.opts.extra.mount&&(null===(i=this.opts.extra.mount)||void 0===i?void 0:i.widthRatio)&&this.opts.extra.mount.widthRatio>1&&(this.opts.extra.mount.widthRatio>2&&(this.opts.extra.mount.widthRatio=2),h+=(this.opts.extra.mount.widthRatio-1)*a);let n=s+h,r=[],l=1;!1===this.opts.xAxis.axisLine&&(l=0);for(let t=l;t<this.opts.yAxis.splitNumber+1;t++)r.push(this.opts.height-this.opts.area[2]-e*t);this.context.save(),this.opts._scrollDistance_&&0!==this.opts._scrollDistance_&&this.context.translate(this.opts._scrollDistance_,0),"dash"==this.opts.yAxis.gridType&&this.setLineDash([this.opts.yAxis.dashLength*this.opts.pixelRatio,this.opts.yAxis.dashLength*this.opts.pixelRatio]),this.setStrokeStyle(this.opts.yAxis.gridColor),this.setLineWidth(1*this.opts.pixelRatio),r.forEach((t,i)=>{this.context.beginPath(),this.context.moveTo(s,t),this.context.lineTo(n,t),this.context.stroke()}),this.setLineDash([]),this.context.restore()}drawXAxis(t){let i=this.opts.chartData.xAxisData,s=i.xAxisPoints,o=i.startX,a=i.endX,h=i.eachSpacing,n="center";"bar"!=this.opts.type&&"line"!=this.opts.type&&"area"!=this.opts.type&&"scatter"!=this.opts.type&&"bubble"!=this.opts.type||(n=this.opts.xAxis.boundaryGap);let r=this.opts.height-this.opts.area[2],l=this.opts.area[0];if(this.opts.enableScroll&&this.opts.xAxis.scrollShow){let t=this.opts.height-this.opts.area[2]+e.xAxisHeight,i=a-o,n=h*(s.length-1);"mount"==this.opts.type&&this.opts.extra&&this.opts.extra.mount&&this.opts.extra.mount.widthRatio&&this.opts.extra.mount.widthRatio>1&&(this.opts.extra.mount.widthRatio>2&&(this.opts.extra.mount.widthRatio=2),n+=(this.opts.extra.mount.widthRatio-1)*h);let r=i*i/n,l=0;this.opts._scrollDistance_&&(l=-this.opts._scrollDistance_*i/n),this.context.beginPath(),this.setLineCap("round"),this.setLineWidth(6*this.opts.pixelRatio),this.setStrokeStyle(this.opts.xAxis.scrollBackgroundColor||"#EFEBEF"),this.context.moveTo(o,t),this.context.lineTo(a,t),this.context.stroke(),this.context.closePath(),this.context.beginPath(),this.setLineCap("round"),this.setLineWidth(6*this.opts.pixelRatio),this.setStrokeStyle(this.opts.xAxis.scrollColor||"#A6A6A6"),this.context.moveTo(o+l,t),this.context.lineTo(o+l+r,t),this.context.stroke(),this.context.closePath(),this.setLineCap("butt")}if(this.context.save(),this.opts._scrollDistance_&&0!==this.opts._scrollDistance_&&this.context.translate(this.opts._scrollDistance_,0),!0===this.opts.xAxis.calibration&&(this.setStrokeStyle(this.opts.xAxis.gridColor||"#cccccc"),this.setLineCap("butt"),this.setLineWidth(1*this.opts.pixelRatio),s.forEach((t,i)=>{i>0&&(this.context.beginPath(),this.context.moveTo(t-h/2,r),this.context.lineTo(t-h/2,r+3*this.opts.pixelRatio),this.context.closePath(),this.context.stroke())})),!0!==this.opts.xAxis.disableGrid&&(this.setStrokeStyle(this.opts.xAxis.gridColor||"#cccccc"),this.setLineCap("butt"),this.setLineWidth(1*this.opts.pixelRatio),"dash"==this.opts.xAxis.gridType&&this.setLineDash([this.opts.xAxis.dashLength*this.opts.pixelRatio,this.opts.xAxis.dashLength*this.opts.pixelRatio]),this.opts.xAxis.gridEval=this.opts.xAxis.gridEval||1,s.forEach((t,i)=>{i%this.opts.xAxis.gridEval==0&&(this.context.beginPath(),this.context.moveTo(t,r),this.context.lineTo(t,l),this.context.stroke())}),this.setLineDash([])),!0!==this.opts.xAxis.disabled){let i=t.length;this.opts.xAxis.labelCount&&(i=this.opts.xAxis.itemCount?Math.ceil(t.length/this.opts.xAxis.itemCount*this.opts.xAxis.labelCount):this.opts.xAxis.labelCount,i-=1);let e=Math.ceil(t.length/i),o=[],a=t.length;for(let i=0;i<a;i++)i%e!==0?o.push(""):o.push(t[i]);o[a-1]=t[a-1];let l=this.opts.xAxis.fontSize*this.opts.pixelRatio||this.opts.fontSize;0===this.opts._xAxisTextAngle_?o.forEach((t,i)=>{let e=this.opts.xAxis.formatter?this.opts.xAxis.formatter(t,i,this.opts):t,o=-this.measureText(String(e),l)/2;"center"==n&&(o+=h/2),this.opts.xAxis.scrollShow&&this.opts.pixelRatio;let a=this.opts._scrollDistance_||0,p="center"==n?s[i]+h/2:s[i];p-Math.abs(a)>=this.opts.area[3]-1&&p-Math.abs(a)<=this.opts.width-this.opts.area[1]+1&&(this.context.beginPath(),this.setFontSize(l),this.setFillStyle(this.opts.xAxis.fontColor||this.opts.fontColor),this.context.fillText(String(e),s[i]+o,r+this.opts.xAxis.marginTop*this.opts.pixelRatio+(this.opts.xAxis.lineHeight-this.opts.xAxis.fontSize)*this.opts.pixelRatio/2+this.opts.xAxis.fontSize*this.opts.pixelRatio),this.context.closePath(),this.context.stroke())}):o.forEach((t,i)=>{let e=this.opts.xAxis.formatter?this.opts.xAxis.formatter(t,i,this.opts):t,o=this.opts._scrollDistance_||0,a="center"==n?s[i]+h/2:s[i];if(a-Math.abs(o)>=this.opts.area[3]-1&&a-Math.abs(o)<=this.opts.width-this.opts.area[1]+1){this.context.save(),this.context.beginPath(),this.setFontSize(l),this.setFillStyle(this.opts.xAxis.fontColor||this.opts.fontColor);let t=this.measureText(String(e),l),o=s[i];"center"==n&&(o=s[i]+h/2),this.opts.xAxis.scrollShow&&this.opts.pixelRatio;let a=r+this.opts.xAxis.marginTop*this.opts.pixelRatio+l-l*Math.abs(Math.sin(this.opts._xAxisTextAngle_));this.opts.xAxis.rotateAngle<0?(o-=l/2,t=0):(o+=l/2,t=-t),this.context.translate(o,a),this.context.rotate(-1*this.opts._xAxisTextAngle_),this.context.fillText(String(e),t,0),this.context.closePath(),this.context.stroke(),this.context.restore()}})}this.context.restore(),this.opts.xAxis.title&&(this.context.beginPath(),this.setFontSize(this.opts.xAxis.titleFontSize*this.opts.pixelRatio),this.setFillStyle(this.opts.xAxis.titleFontColor),this.context.fillText(String(this.opts.xAxis.title),this.opts.width-this.opts.area[1]+this.opts.xAxis.titleOffsetX*this.opts.pixelRatio,this.opts.height-this.opts.area[2]+this.opts.xAxis.marginTop*this.opts.pixelRatio+(this.opts.xAxis.lineHeight-this.opts.xAxis.titleFontSize)*this.opts.pixelRatio/2+(this.opts.xAxis.titleFontSize+this.opts.xAxis.titleOffsetY)*this.opts.pixelRatio),this.context.closePath(),this.context.stroke()),this.opts.xAxis.axisLine&&(this.context.beginPath(),this.setStrokeStyle(this.opts.xAxis.axisLineColor),this.setLineWidth(1*this.opts.pixelRatio),this.context.moveTo(o,this.opts.height-this.opts.area[2]),this.context.lineTo(a,this.opts.height-this.opts.area[2]),this.context.stroke())}fixColumnData(t,i,e,s){return t.map(t=>{var o,a;if(null===t)return null;let h=0,n=0;return"mix"==this.opts.type?(h=(null===(o=this.opts.extra.mix.column)||void 0===o?void 0:o.seriesGap)?this.opts.extra.mix.column.seriesGap*this.opts.pixelRatio:0,n=(null===(a=this.opts.extra.mix.column)||void 0===a?void 0:a.categoryGap)?this.opts.extra.mix.column.categoryGap*this.opts.pixelRatio:0):(h=this.opts.extra.column.seriesGap?this.opts.extra.column.seriesGap*this.opts.pixelRatio:0,n=this.opts.extra.column.categoryGap?this.opts.extra.column.categoryGap*this.opts.pixelRatio:0),h=Math.min(h,i/e),n=Math.min(n,i/e),t.width=Math.ceil((i-2*n-h*(e-1))/e),this.opts.extra.mix&&this.opts.extra.mix.column&&this.opts.extra.mix.column.width&&+this.opts.extra.mix.column.width>0&&(t.width=Math.min(t.width,+this.opts.extra.mix.column.width*this.opts.pixelRatio)),this.opts.extra.column&&this.opts.extra.column.width&&+this.opts.extra.column.width>0&&(t.width=Math.min(t.width,+this.opts.extra.column.width*this.opts.pixelRatio)),t.width<=0&&(t.width=1),t.x+=(s+.5-e/2)*(t.width+h),t})}getDataPoints(t,i,e,s,o,a=1){var h;let n="center";"line"!=this.opts.type&&"area"!=this.opts.type&&"scatter"!=this.opts.type&&"bubble"!=this.opts.type||(n=null!==(h=this.opts.xAxis.boundaryGap)&&void 0!==h?h:"center");let r=[],l=this.opts.height-this.opts.area[0]-this.opts.area[2],p=this.opts.width-this.opts.area[1]-this.opts.area[3];return t.forEach((t,h)=>{if(null===t)r.push(null);else{let c={color:"",x:s[h],y:0},x=t;if("object"==typeof t&&null!==t)if(t.constructor.toString().indexOf("Array")>-1){let i,e,s;i=[].concat(this.opts.chartData.xAxisData.ranges),e=i.shift(),s=i.pop(),x=t[1],c.x=this.opts.area[3]+p*(t[0]-e)/(s-e),"bubble"==this.opts.type&&(c.r=t[2],c.t=t[3])}else x=t.value,c.color=t.color;"center"==n&&(c.x+=o/2);let d=l*(Number(x)-i)/(e-i);d*=a,c.y=this.opts.height-d-this.opts.area[2],r.push(c)}}),r}drawYAxis(){if(!0===this.opts.yAxis.disabled)return;let t=this.opts.height-this.opts.area[0]-this.opts.area[2],i=t/this.opts.yAxis.splitNumber,e=this.opts.area[3],s=this.opts.width-this.opts.area[1],o=this.opts.height-this.opts.area[2];this.context.beginPath(),this.setFillStyle(this.opts.background),1==this.opts.enableScroll&&this.opts.xAxis.scrollPosition&&"left"!==this.opts.xAxis.scrollPosition&&this.context.fillRect(0,0,e,o+2*this.opts.pixelRatio),1==this.opts.enableScroll&&this.opts.xAxis.scrollPosition&&"right"!==this.opts.xAxis.scrollPosition&&this.context.fillRect(s,0,this.opts.width,o+2*this.opts.pixelRatio),this.context.closePath(),this.context.stroke();let a=this.opts.area[3],h=this.opts.width-this.opts.area[1],n=this.opts.area[3]+(this.opts.width-this.opts.area[1]-this.opts.area[3])/2;if(this.opts.yAxis.data)for(let e=0;e<this.opts.yAxis.data.length;e++){let s=this.opts.yAxis.data[e],o=[];if("categories"===s.type)for(let i=0;i<=s.categories.length;i++)o.push(this.opts.area[0]+t/s.categories.length/2+t/s.categories.length*i);else for(let t=0;t<=this.opts.yAxis.splitNumber;t++)o.push(this.opts.area[0]+i*t);if(!0!==s.disabled){let t=this.opts.chartData.yAxisData.rangesFormat[e],i=s.fontSize?s.fontSize*this.opts.pixelRatio:this.opts.fontSize,r=this.opts.chartData.yAxisData.yAxisWidth[e],l=s.textAlign||"right";if(t.forEach((t,e)=>{const p=o[e];this.context.beginPath(),this.setFontSize(i),this.setLineWidth(1*this.opts.pixelRatio),this.setStrokeStyle(s.axisLineColor||"#cccccc"),this.setFillStyle(s.fontColor||this.opts.fontColor);let c=0,x=4*this.opts.pixelRatio;if("left"==r.position){switch(1==s.calibration&&(this.context.moveTo(a,p),this.context.lineTo(a-3*this.opts.pixelRatio,p),x+=3*this.opts.pixelRatio),l){case"left":this.setTextAlign("left"),c=a-r.width;break;case"right":this.setTextAlign("right"),c=a-x;break;default:this.setTextAlign("center"),c=a-r.width/2}this.context.fillText(String(t),c,p+i/2-3*this.opts.pixelRatio)}else if("right"==r.position){switch(1==s.calibration&&(this.context.moveTo(h,p),this.context.lineTo(h+3*this.opts.pixelRatio,p),x+=3*this.opts.pixelRatio),l){case"left":this.setTextAlign("left"),c=h+x;break;case"right":this.setTextAlign("right"),c=h+r.width;break;default:this.setTextAlign("center"),c=h+r.width/2}this.context.fillText(String(t),c,p+i/2-3*this.opts.pixelRatio)}else if("center"==r.position){switch(1==s.calibration&&(this.context.moveTo(n,p),this.context.lineTo(n-3*this.opts.pixelRatio,p),x+=3*this.opts.pixelRatio),l){case"left":this.setTextAlign("left"),c=n-r.width;break;case"right":this.setTextAlign("right"),c=n-x;break;default:this.setTextAlign("center"),c=n-r.width/2}this.context.fillText(String(t),c,p+i/2-3*this.opts.pixelRatio)}this.context.closePath(),this.context.stroke(),this.setTextAlign("left")}),!1!==s.axisLine&&(this.context.beginPath(),this.setStrokeStyle(s.axisLineColor||"#cccccc"),this.setLineWidth(1*this.opts.pixelRatio),"left"==r.position?(this.context.moveTo(a,this.opts.height-this.opts.area[2]),this.context.lineTo(a,this.opts.area[0])):"right"==r.position?(this.context.moveTo(h,this.opts.height-this.opts.area[2]),this.context.lineTo(h,this.opts.area[0])):"center"==r.position&&(this.context.moveTo(n,this.opts.height-this.opts.area[2]),this.context.lineTo(n,this.opts.area[0])),this.context.stroke()),this.opts.yAxis.showTitle){let t=s.titleFontSize*this.opts.pixelRatio||this.opts.fontSize,i=s.title;this.context.beginPath(),this.setFontSize(t),this.setFillStyle(s.titleFontColor||this.opts.fontColor),"left"==r.position?this.context.fillText(i,a-this.measureText(i,t)/2+(s.titleOffsetX||0),this.opts.area[0]-(10-(s.titleOffsetY||0))*this.opts.pixelRatio):"right"==r.position?this.context.fillText(i,h-this.measureText(i,t)/2+(s.titleOffsetX||0),this.opts.area[0]-(10-(s.titleOffsetY||0))*this.opts.pixelRatio):"center"==r.position&&this.context.fillText(i,n-this.measureText(i,t)/2+(s.titleOffsetX||0),this.opts.area[0]-(10-(s.titleOffsetY||0))*this.opts.pixelRatio),this.context.closePath(),this.context.stroke()}"left"==r.position?a-=r.width+this.opts.yAxis.padding*this.opts.pixelRatio:h+=r.width+this.opts.yAxis.padding*this.opts.pixelRatio}}}calMarkLineData(t){let i,e,s=this.opts.height-this.opts.area[0]-this.opts.area[2];for(let o=0;o<t.length;o++){t[o].yAxisIndex=t[o].yAxisIndex?t[o].yAxisIndex:0;let a=[].concat(this.opts.chartData.yAxisData.ranges[t[o].yAxisIndex]);i=a.pop(),e=a.shift();let h=s*(t[o].value-i)/(e-i);t[o].y=this.opts.height-Math.round(h)-this.opts.area[2]}return t}drawMarkLine(){let t=i.objectAssign({},{type:"solid",dashLength:4,data:[]},this.opts.extra.markLine),e=this.opts.area[3],s=this.opts.width-this.opts.area[1],o=this.calMarkLineData(t.data);const a={lineColor:"#DE4A42",showLabel:!1,labelAlign:"left",labelOffsetX:0,labelOffsetY:0,labelPadding:6,labelFontSize:13,labelFontColor:"#666666",labelBgColor:"#DFE8FF",labelBgOpacity:.8};for(let h=0;h<o.length;h++){let n=i.objectAssign({},a,o[h]);if("dash"==t.type&&this.setLineDash([t.dashLength,t.dashLength]),this.setStrokeStyle(n.lineColor),this.setLineWidth(1*this.opts.pixelRatio),this.context.beginPath(),this.context.moveTo(e,n.y),this.context.lineTo(s,n.y),this.context.stroke(),this.setLineDash([]),n.showLabel){let t=n.labelFontSize*this.opts.pixelRatio,e=n.labelText?n.labelText:n.value;this.setFontSize(t);let s=this.measureText(String(e),t)+n.labelPadding*this.opts.pixelRatio*2,o="left"==n.labelAlign?this.opts.area[3]-s:this.opts.width-this.opts.area[1];o+=n.labelOffsetX;let a=n.y-.5*t-n.labelPadding*this.opts.pixelRatio;a+=n.labelOffsetY;let h=o+n.labelPadding*this.opts.pixelRatio;this.setFillStyle(i.hexToRgb(n.labelBgColor,n.labelBgOpacity)),this.setStrokeStyle(n.labelBgColor),this.setLineWidth(1*this.opts.pixelRatio),this.context.beginPath(),this.context.rect(o,a,s,t+2*n.labelPadding*this.opts.pixelRatio),this.context.closePath(),this.context.stroke(),this.context.fill(),this.setFontSize(t),this.setTextAlign("left"),this.setFillStyle(n.labelFontColor),this.context.fillText(String(e),h,a+t+n.labelPadding*this.opts.pixelRatio/2),this.context.stroke(),this.setTextAlign("left")}}}drawLegend(t){if(!1===this.opts.legend.show)return;let i=t.legendData,e=i.points,s=i.area,o=this.opts.legend.padding*this.opts.pixelRatio,a=this.opts.legend.fontSize*this.opts.pixelRatio,h=15*this.opts.pixelRatio,n=5*this.opts.pixelRatio,r=this.opts.legend.itemGap*this.opts.pixelRatio,l=Math.max(this.opts.legend.lineHeight*this.opts.pixelRatio,a);this.context.beginPath(),this.setLineWidth(this.opts.legend.borderWidth*this.opts.pixelRatio),this.setStrokeStyle(this.opts.legend.borderColor),this.setFillStyle(this.opts.legend.backgroundColor),this.context.moveTo(s.start.x,s.start.y),this.context.rect(s.start.x,s.start.y,s.width,s.height),this.context.closePath(),this.context.fill(),this.context.stroke(),e.forEach((t,e)=>{let p=0,c=0;p=i.widthArr[e],c=i.heightArr[e];let x=0,d=0;if("top"==this.opts.legend.position||"bottom"==this.opts.legend.position){switch(this.opts.legend.float){case"left":x=s.start.x+o;break;case"right":x=s.start.x+s.width-p;break;default:x=s.start.x+(s.width-p)/2}d=s.start.y+o+e*l}else p=0==e?0:i.widthArr[e-1],x=s.start.x+o+p,d=s.start.y+o+(s.height-c)/2;this.setFontSize(this.opts.fontSize);for(let i=0;i<t.length;i++){let e=t[i];switch(e.area=[0,0,0,0],e.area[0]=x,e.area[1]=d,e.area[3]=d+l,this.context.beginPath(),this.setLineWidth(1*this.opts.pixelRatio),this.setStrokeStyle(e.show?e.color:this.opts.legend.hiddenColor),this.setFillStyle(e.show?e.color:this.opts.legend.hiddenColor),e.legendShape){case"line":this.context.moveTo(x,d+.5*l-2*this.opts.pixelRatio),this.context.fillRect(x,d+.5*l-2*this.opts.pixelRatio,15*this.opts.pixelRatio,4*this.opts.pixelRatio);break;case"triangle":this.context.moveTo(x+7.5*this.opts.pixelRatio,d+.5*l-5*this.opts.pixelRatio),this.context.lineTo(x+2.5*this.opts.pixelRatio,d+.5*l+5*this.opts.pixelRatio),this.context.lineTo(x+12.5*this.opts.pixelRatio,d+.5*l+5*this.opts.pixelRatio),this.context.lineTo(x+7.5*this.opts.pixelRatio,d+.5*l-5*this.opts.pixelRatio);break;case"diamond":this.context.moveTo(x+7.5*this.opts.pixelRatio,d+.5*l-5*this.opts.pixelRatio),this.context.lineTo(x+2.5*this.opts.pixelRatio,d+.5*l),this.context.lineTo(x+7.5*this.opts.pixelRatio,d+.5*l+5*this.opts.pixelRatio),this.context.lineTo(x+12.5*this.opts.pixelRatio,d+.5*l),this.context.lineTo(x+7.5*this.opts.pixelRatio,d+.5*l-5*this.opts.pixelRatio);break;case"circle":this.context.moveTo(x+7.5*this.opts.pixelRatio,d+.5*l),this.context.arc(x+7.5*this.opts.pixelRatio,d+.5*l,5*this.opts.pixelRatio,0,2*Math.PI);break;case"rect":default:this.context.moveTo(x,d+.5*l-5*this.opts.pixelRatio),this.context.fillRect(x,d+.5*l-5*this.opts.pixelRatio,15*this.opts.pixelRatio,10*this.opts.pixelRatio);break;case"square":this.context.moveTo(x+5*this.opts.pixelRatio,d+.5*l-5*this.opts.pixelRatio),this.context.fillRect(x+5*this.opts.pixelRatio,d+.5*l-5*this.opts.pixelRatio,10*this.opts.pixelRatio,10*this.opts.pixelRatio);case"none":}this.context.closePath(),this.context.fill(),this.context.stroke(),x+=h+n;let s=.5*l+.5*a-2;const o=e.legendText?e.legendText:e.name;this.context.beginPath(),this.setFontSize(a),this.setFillStyle(e.show?this.opts.legend.fontColor:this.opts.legend.hiddenColor),this.context.fillText(o,x,d+s),this.context.closePath(),this.context.stroke(),"top"==this.opts.legend.position||"bottom"==this.opts.legend.position?(x+=this.measureText(o,a)+r,e.area[2]=x):(e.area[2]=x+this.measureText(o,a)+r,x-=h+n,d+=l)}})}calTooltipYAxisData(t){let i=[].concat(this.opts.chartData.yAxisData.ranges),e=this.opts.height-this.opts.area[0]-this.opts.area[2],s=this.opts.area[0],o=[];for(let a=0;a<i.length;a++){let h=Math.max(...i[a]),n=h-(h-Math.min(...i[a]))*(t-s)/e,r=this.opts.yAxis.data&&this.opts.yAxis.data[a].formatter?this.opts.yAxis.data[a].formatter(n,a,this.opts):n.toFixed(0);o.push(String(r))}return o}drawToolTipHorizentalLine(){let t=i.objectAssign({},{gridType:"solid",dashLength:4,boxPadding:3,fontSize:13,labelBgColor:"#FFFFFF",labelBgOpacity:.7},this.opts.extra.tooltip),e=this.opts.area[3],s=this.opts.width-this.opts.area[1];if("dash"==t.gridType&&this.setLineDash([t.dashLength,t.dashLength]),this.setStrokeStyle(t.gridColor||"#cccccc"),this.setLineWidth(1*this.opts.pixelRatio),this.context.beginPath(),this.context.moveTo(e,this.opts.tooltip.offset.y),this.context.lineTo(s,this.opts.tooltip.offset.y),this.context.stroke(),this.setLineDash([]),t.yAxisLabel){let e=t.boxPadding*this.opts.pixelRatio,s=this.calTooltipYAxisData(this.opts.tooltip.offset.y),o=this.opts.chartData.yAxisData.yAxisWidth,a=this.opts.area[3],h=this.opts.width-this.opts.area[1];for(let n=0;n<s.length;n++){this.setFontSize(t.fontSize*this.opts.pixelRatio);let r,l,p,c=this.measureText(s[n],t.fontSize*this.opts.pixelRatio);"left"==o[n].position?(r=a-(c+2*e)-2*this.opts.pixelRatio,l=Math.max(r,r+c+2*e)):(r=h+2*this.opts.pixelRatio,l=Math.max(r+o[n].width,r+c+2*e)),p=l-r;let x=r+(p-c)/2,d=this.opts.tooltip.offset.y;this.context.beginPath(),this.setFillStyle(i.hexToRgb(t.labelBgColor,t.labelBgOpacity)),this.setStrokeStyle(t.labelBgColor),this.setLineWidth(1*this.opts.pixelRatio),this.context.rect(r,d-.5*this.opts.fontSize-e,p,this.opts.fontSize+2*e),this.context.closePath(),this.context.stroke(),this.context.fill(),this.context.beginPath(),this.setFontSize(this.opts.fontSize),this.setFillStyle(t.labelFontColor||this.opts.fontColor),this.context.fillText(s[n],x,d+.5*this.opts.fontSize),this.context.closePath(),this.context.stroke(),"left"==o[n].position?a-=o[n].width+this.opts.yAxis.padding*this.opts.pixelRatio:h+=o[n].width+this.opts.yAxis.padding*this.opts.pixelRatio}}}drawToolTipSplitLine(t){let e=this.opts.extra.tooltip||{};e.gridType=null==e.gridType?"solid":e.gridType,e.dashLength=null==e.dashLength?4:e.dashLength;let s=this.opts.area[0],o=this.opts.height-this.opts.area[2];if("dash"==e.gridType&&this.setLineDash([e.dashLength,e.dashLength]),this.setStrokeStyle(e.gridColor||"#cccccc"),this.setLineWidth(1*this.opts.pixelRatio),this.context.beginPath(),this.context.moveTo(t,s),this.context.lineTo(t,o),this.context.stroke(),this.setLineDash([]),e.xAxisLabel){let s=this.opts.categories[this.opts.tooltip.index];this.setFontSize(this.opts.fontSize);let a=this.measureText(s,this.opts.fontSize),h=t-.5*a,n=o+2*this.opts.pixelRatio;this.context.beginPath(),this.setFillStyle(i.hexToRgb(e.labelBgColor||"#FFFFFF",e.labelBgOpacity||.7)),this.setStrokeStyle(e.labelBgColor||"#FFFFFF"),this.setLineWidth(1*this.opts.pixelRatio),this.context.rect(h-Number(e.boxPadding)*this.opts.pixelRatio,n,a+2*Number(e.boxPadding)*this.opts.pixelRatio,this.opts.fontSize+2*Number(e.boxPadding)*this.opts.pixelRatio),this.context.closePath(),this.context.stroke(),this.context.fill(),this.context.beginPath(),this.setFontSize(this.opts.fontSize),this.setFillStyle(e.labelFontColor||this.opts.fontColor),this.context.fillText(String(s),h,n+Number(e.boxPadding)*this.opts.pixelRatio+this.opts.fontSize),this.context.closePath(),this.context.stroke()}}drawToolTip(t,e){let s=i.objectAssign({},{showBox:!0,showArrow:!0,showCategory:!1,bgColor:"#000000",bgOpacity:.7,borderColor:"#000000",borderWidth:0,borderRadius:0,borderOpacity:.7,boxPadding:3,fontColor:"#FFFFFF",fontSize:13,lineHeight:20,legendShow:!0,legendShape:"auto",splitLine:!0},this.opts.extra.tooltip);if(1==s.showCategory&&this.opts.categories){const i=this.opts.categories;t.unshift({text:i[this.opts.tooltip.index],color:null})}let o=s.fontSize*this.opts.pixelRatio,a=s.lineHeight*this.opts.pixelRatio,h=s.boxPadding*this.opts.pixelRatio,n=o,r=5*this.opts.pixelRatio;0==s.legendShow&&(n=0,r=0);let l=s.showArrow?8*this.opts.pixelRatio:0,p=!1;"line"!=this.opts.type&&"mount"!=this.opts.type&&"area"!=this.opts.type&&"candle"!=this.opts.type&&"mix"!=this.opts.type||1==s.splitLine&&this.drawToolTipSplitLine(this.opts.tooltip.offset.x),(e=i.objectAssign({x:0,y:0},e)).y-=8*this.opts.pixelRatio;let c=t.map(t=>this.measureText(t.text,o)),x=n+r+4*h+Math.max(...c),d=2*h+t.length*a;if(0==s.showBox)return;e.x-Math.abs(this.opts._scrollDistance_||0)+l+x>this.opts.width&&(p=!0),d+e.y>this.opts.height&&(e.y=this.opts.height-d),this.context.beginPath(),this.setFillStyle(i.hexToRgb(s.bgColor,s.bgOpacity)),this.setLineWidth(s.borderWidth*this.opts.pixelRatio),this.setStrokeStyle(i.hexToRgb(s.borderColor,s.borderOpacity));let g=s.borderRadius;p?(x+l>this.opts.width&&(e.x=this.opts.width+Math.abs(this.opts._scrollDistance_||0)+l+(x-this.opts.width)),x>e.x&&(e.x=this.opts.width+Math.abs(this.opts._scrollDistance_||0)+l+(x-this.opts.width)),s.showArrow&&(this.context.moveTo(e.x,e.y+10*this.opts.pixelRatio),this.context.lineTo(e.x-l,e.y+10*this.opts.pixelRatio+5*this.opts.pixelRatio)),this.context.arc(e.x-l-g,e.y+d-g,g,0,Math.PI/2,!1),this.context.arc(e.x-l-Math.round(x)+g,e.y+d-g,g,Math.PI/2,Math.PI,!1),this.context.arc(e.x-l-Math.round(x)+g,e.y+g,g,-Math.PI,-Math.PI/2,!1),this.context.arc(e.x-l-g,e.y+g,g,-Math.PI/2,0,!1),s.showArrow&&(this.context.lineTo(e.x-l,e.y+10*this.opts.pixelRatio-5*this.opts.pixelRatio),this.context.lineTo(e.x,e.y+10*this.opts.pixelRatio))):(s.showArrow&&(this.context.moveTo(e.x,e.y+10*this.opts.pixelRatio),this.context.lineTo(e.x+l,e.y+10*this.opts.pixelRatio-5*this.opts.pixelRatio)),this.context.arc(e.x+l+g,e.y+g,g,-Math.PI,-Math.PI/2,!1),this.context.arc(e.x+l+Math.round(x)-g,e.y+g,g,-Math.PI/2,0,!1),this.context.arc(e.x+l+Math.round(x)-g,e.y+d-g,g,0,Math.PI/2,!1),this.context.arc(e.x+l+g,e.y+d-g,g,Math.PI/2,Math.PI,!1),s.showArrow&&(this.context.lineTo(e.x+l,e.y+10*this.opts.pixelRatio+5*this.opts.pixelRatio),this.context.lineTo(e.x,e.y+10*this.opts.pixelRatio))),this.context.closePath(),this.context.fill(),s.borderWidth>0&&this.context.stroke(),s.legendShow&&t.forEach((t,i)=>{if(null!==t.color){this.context.beginPath(),this.setFillStyle(t.color);let s=e.x+l+2*h,r=e.y+(a-o)/2+a*i+h+1;switch(p&&(s=e.x-x-l+2*h),t.legendShape){case"line":this.context.moveTo(s,r+.5*n-2*this.opts.pixelRatio),this.context.fillRect(s,r+.5*n-2*this.opts.pixelRatio,n,4*this.opts.pixelRatio);break;case"triangle":this.context.moveTo(s+7.5*this.opts.pixelRatio,r+.5*n-5*this.opts.pixelRatio),this.context.lineTo(s+2.5*this.opts.pixelRatio,r+.5*n+5*this.opts.pixelRatio),this.context.lineTo(s+12.5*this.opts.pixelRatio,r+.5*n+5*this.opts.pixelRatio),this.context.lineTo(s+7.5*this.opts.pixelRatio,r+.5*n-5*this.opts.pixelRatio);break;case"diamond":this.context.moveTo(s+7.5*this.opts.pixelRatio,r+.5*n-5*this.opts.pixelRatio),this.context.lineTo(s+2.5*this.opts.pixelRatio,r+.5*n),this.context.lineTo(s+7.5*this.opts.pixelRatio,r+.5*n+5*this.opts.pixelRatio),this.context.lineTo(s+12.5*this.opts.pixelRatio,r+.5*n),this.context.lineTo(s+7.5*this.opts.pixelRatio,r+.5*n-5*this.opts.pixelRatio);break;case"circle":this.context.moveTo(s+7.5*this.opts.pixelRatio,r+.5*n),this.context.arc(s+7.5*this.opts.pixelRatio,r+.5*n,5*this.opts.pixelRatio,0,2*Math.PI);break;case"rect":default:this.context.moveTo(s,r+.5*n-5*this.opts.pixelRatio),this.context.fillRect(s,r+.5*n-5*this.opts.pixelRatio,15*this.opts.pixelRatio,10*this.opts.pixelRatio);break;case"square":this.context.moveTo(s+2*this.opts.pixelRatio,r+.5*n-5*this.opts.pixelRatio),this.context.fillRect(s+2*this.opts.pixelRatio,r+.5*n-5*this.opts.pixelRatio,10*this.opts.pixelRatio,10*this.opts.pixelRatio)}this.context.closePath(),this.context.fill()}}),t.forEach((t,i)=>{let c=e.x+l+2*h+n+r;p&&(c=e.x-x-l+2*h+n+r);let d=e.y+a*i+(a-o)/2-1+h+o;this.context.beginPath(),this.setFontSize(o),this.setTextBaseline("alphabetic"),this.setFillStyle(s.fontColor),this.context.fillText(t.text,c,d),this.context.closePath(),this.context.stroke()}),1==s.showCategory&&this.opts.categories&&t.shift()}drawCanvas(){this.context.save(),this.context.translate(0,.5),this.context.restore()}drawToolTipBridge(t){(this.opts.extra.tooltip||{}).horizentalLine&&this.opts.tooltip&&1===t&&("line"==this.opts.type||"area"==this.opts.type||"column"==this.opts.type||"mount"==this.opts.type||"candle"==this.opts.type||"mix"==this.opts.type)&&this.drawToolTipHorizentalLine(),this.context.save(),this.opts._scrollDistance_&&0!==this.opts._scrollDistance_&&!0===this.opts.enableScroll&&this.context.translate(this.opts._scrollDistance_,0),this.opts.tooltip&&this.opts.tooltip.textList&&this.opts.tooltip.textList.length&&1===t&&this.drawToolTip(this.opts.tooltip.textList,this.opts.tooltip.offset),this.context.restore()}calValidDistance(t){let i=this.opts.width-this.opts.area[1]-this.opts.area[3],e=this.opts.chartData.eachSpacing*(this.opts.chartData.xAxisData.xAxisPoints.length-1);"mount"==this.opts.type&&this.opts.extra&&this.opts.extra.mount&&this.opts.extra.mount.widthRatio&&this.opts.extra.mount.widthRatio>1&&(this.opts.extra.mount.widthRatio>2&&(this.opts.extra.mount.widthRatio=2),e+=(this.opts.extra.mount.widthRatio-1)*this.opts.chartData.eachSpacing);let s=t;return t>=0?(s=0,this.event.emit("scrollLeft",this.opts),this.scrollOption.position="left",this.opts.xAxis.scrollPosition="left"):Math.abs(t)>=e-i?(s=i-e,this.event.emit("scrollRight",this.opts),this.scrollOption.position="right",this.opts.xAxis.scrollPosition="right"):(this.scrollOption.position=t,this.opts.xAxis.scrollPosition=t),s}fixPieSeries(t){let i=[];if(t.length>0&&t[0].data.constructor.toString().indexOf("Array")>-1){this.opts._pieSeries_=t;let e=t[0].data;for(let s=0;s<e.length;s++)e[s].formatter=t[0].formatter,e[s].data=e[s].value,i.push(e[s]);this.opts.series=i}else i=t;return i}splitPoints(t,i){let e=[],s=[];return t.forEach((t,o)=>{i.connectNulls?null!==t&&s.push(t):null!==t?s.push(t):(s.length&&e.push(s),s=[])}),s.length&&e.push(s),e}createCurveControlPoints(t,i){const e=(t,i)=>!(!t[i-1]||!t[i+1])&&(t[i].y>=Math.max(t[i-1].y,t[i+1].y)||t[i].y<=Math.min(t[i-1].y,t[i+1].y)),s=(t,i)=>!(!t[i-1]||!t[i+1])&&(t[i].x>=Math.max(t[i-1].x,t[i+1].x)||t[i].x<=Math.min(t[i-1].x,t[i+1].x));let o=.2,a=.2,h=0,n=0,r=0,l=0;if(i<1?(h=t[0].x+(t[1].x-t[0].x)*o,n=t[0].y+(t[1].y-t[0].y)*o):(h=t[i].x+(t[i+1].x-t[i-1].x)*o,n=t[i].y+(t[i+1].y-t[i-1].y)*o),i>t.length-3){let i=t.length-1;r=t[i].x-(t[i].x-t[i-1].x)*a,l=t[i].y-(t[i].y-t[i-1].y)*a}else r=t[i+1].x-(t[i+2].x-t[i].x)*a,l=t[i+1].y-(t[i+2].y-t[i].y)*a;return e(t,i+1)&&(l=t[i+1].y),e(t,i)&&(n=t[i].y),s(t,i+1)&&(r=t[i+1].x),s(t,i)&&(h=t[i].x),(n>=Math.max(t[i].y,t[i+1].y)||n<=Math.min(t[i].y,t[i+1].y))&&(n=t[i].y),(l>=Math.max(t[i].y,t[i+1].y)||l<=Math.min(t[i].y,t[i+1].y))&&(l=t[i+1].y),(h>=Math.max(t[i].x,t[i+1].x)||h<=Math.min(t[i].x,t[i+1].x))&&(h=t[i].x),(r>=Math.max(t[i].x,t[i+1].x)||r<=Math.min(t[i].x,t[i+1].x))&&(r=t[i+1].x),{ctrA:{x:h,y:n},ctrB:{x:r,y:l}}}drawPointShape(t,i,e){if(this.context.beginPath(),"hollow"==this.opts.dataPointShapeType?(this.setStrokeStyle(i),this.setFillStyle(this.opts.background),this.setLineWidth(2*this.opts.pixelRatio)):(this.setStrokeStyle("#ffffff"),this.setFillStyle(i),this.setLineWidth(1*this.opts.pixelRatio)),"diamond"===e)t.forEach((t,i)=>{null!==t&&(this.context.moveTo(t.x,t.y-4.5),this.context.lineTo(t.x-4.5,t.y),this.context.lineTo(t.x,t.y+4.5),this.context.lineTo(t.x+4.5,t.y),this.context.lineTo(t.x,t.y-4.5))});else if("circle"===e)t.forEach((t,i)=>{null!==t&&(this.context.moveTo(t.x+2.5*this.opts.pixelRatio,t.y),this.context.arc(t.x,t.y,3*this.opts.pixelRatio,0,2*Math.PI,!1))});else if("square"===e)t.forEach((t,i)=>{null!==t&&(this.context.moveTo(t.x-3.5,t.y-3.5),this.context.rect(t.x-3.5,t.y-3.5,7,7))});else if("triangle"===e)t.forEach((t,i)=>{null!==t&&(this.context.moveTo(t.x,t.y-4.5),this.context.lineTo(t.x-4.5,t.y+4.5),this.context.lineTo(t.x+4.5,t.y+4.5),this.context.lineTo(t.x,t.y-4.5))});else if("none"===e)return;this.context.closePath(),this.context.fill(),this.context.stroke()}drawActivePoint(t,i,e,s,o=0){if(!this.opts.tooltip||!this.opts.tooltip.group)return;if(this.opts.tooltip.group.length>0&&0==this.opts.tooltip.group.includes(o))return;let a="number"==typeof this.opts.tooltip.index?this.opts.tooltip.index:this.opts.tooltip.index[this.opts.tooltip.group.indexOf(o)];if(this.context.beginPath(),"hollow"==s.activeType?(this.setStrokeStyle(i),this.setFillStyle(this.opts.background),this.setLineWidth(2*this.opts.pixelRatio)):(this.setStrokeStyle("#ffffff"),this.setFillStyle(i),this.setLineWidth(1*this.opts.pixelRatio)),"diamond"===e)t.forEach((t,i)=>{null!==t&&a==i&&(this.context.moveTo(t.x,t.y-4.5),this.context.lineTo(t.x-4.5,t.y),this.context.lineTo(t.x,t.y+4.5),this.context.lineTo(t.x+4.5,t.y),this.context.lineTo(t.x,t.y-4.5))});else if("circle"===e)t.forEach((t,i)=>{null!==t&&a==i&&(this.context.moveTo(t.x+2.5*this.opts.pixelRatio,t.y),this.context.arc(t.x,t.y,3*this.opts.pixelRatio,0,2*Math.PI,!1))});else if("square"===e)t.forEach((t,i)=>{null!==t&&a==i&&(this.context.moveTo(t.x-3.5,t.y-3.5),this.context.rect(t.x-3.5,t.y-3.5,7,7))});else if("triangle"===e)t.forEach((t,i)=>{null!==t&&a==i&&(this.context.moveTo(t.x,t.y-4.5),this.context.lineTo(t.x-4.5,t.y+4.5),this.context.lineTo(t.x+4.5,t.y+4.5),this.context.lineTo(t.x,t.y-4.5))});else if("none"===e)return;this.context.closePath(),this.context.fill(),this.context.stroke()}drawPointText(t,i){let e=i.data,s=i.textOffset?i.textOffset:0;t.forEach((t,o)=>{if(null!==t){this.context.beginPath();let a=i.textSize?i.textSize*this.opts.pixelRatio:this.opts.fontSize;this.setFontSize(a),this.setFillStyle(i.textColor||this.opts.fontColor);let h=e[o];"object"==typeof e[o]&&null!==e[o]&&(h=Array.isArray(e[o])?e[o][1]:e[o].value);let n=i.formatter?i.formatter(h,o,i,this.opts):h;this.setTextAlign("center"),this.context.fillText(String(n),t.x,t.y-4+s*this.opts.pixelRatio),this.context.closePath(),this.context.stroke(),this.setTextAlign("left")}})}getPieDataPoints(t,i=0,e=1){let s=0,o=0;for(let i=0;i<t.length;i++){let e=t[i];e.data=null===e.data?0:e.data,s+=e.data}for(let o=0;o<t.length;o++){let a=t[o];a.data=null===a.data?0:a.data,a._proportion_=0===s?1/t.length*e:a.data/s*e,a._radius_=i}for(let i=0;i<t.length;i++){let e=t[i];e._start_=o,o+=2*e._proportion_*Math.PI}return t}getRoseDataPoints(t,i,e,s,o=1){let a=0,h=0,n=[];for(let i=0;i<t.length;i++){let e=t[i];e.data=null===e.data?0:e.data,a+=e.data,n.push(e.data)}let r=Math.min(...n),l=Math.max(...n),p=s-e;for(let h=0;h<t.length;h++){let n=t[h];n.data=null===n.data?0:n.data,0===a?(n._proportion_=1/t.length*o,n._rose_proportion_=1/t.length*o):(n._proportion_=n.data/a*o,n._rose_proportion_="area"==i?1/t.length*o:n.data/a*o),n._radius_=e+p*((n.data-r)/(l-r))||s}for(let i=0;i<t.length;i++){let e=t[i];e._start_=h,h+=2*e._rose_proportion_*Math.PI}return t}getCandleToolTipData(t,i,e,s,o){var a,h;let n=this.opts.chartData.calPoints,r=(null===(a=o.color)||void 0===a?void 0:a.upFill)||"#f04864",l=(null===(h=o.color)||void 0===h?void 0:h.downFill)||"#2fc25b",p=[r,r,l,r],c=[];i.map(i=>{var s,o,a,h,n,x,d,g;0==e?i.data[1]-i.data[0]<0?p[1]=l:p[1]=r:(i.data[0]<t[e-1][1]&&(p[0]=l),i.data[1]<i.data[0]&&(p[1]=l),i.data[2]>t[e-1][1]&&(p[2]=r),i.data[3]<t[e-1][1]&&(p[3]=l));let u={text:"开盘："+i.data[0],color:p[0],legendShape:"auto"==(null===(s=this.opts.extra.tooltip)||void 0===s?void 0:s.legendShape)?i.legendShape:null===(o=this.opts.extra.tooltip)||void 0===o?void 0:o.legendShape},f={text:"收盘："+i.data[1],color:p[1],legendShape:"auto"==(null===(a=this.opts.extra.tooltip)||void 0===a?void 0:a.legendShape)?i.legendShape:null===(h=this.opts.extra.tooltip)||void 0===h?void 0:h.legendShape},y={text:"最低："+i.data[2],color:p[2],legendShape:"auto"==(null===(n=this.opts.extra.tooltip)||void 0===n?void 0:n.legendShape)?i.legendShape:null===(x=this.opts.extra.tooltip)||void 0===x?void 0:x.legendShape},m={text:"最高："+i.data[3],color:p[3],legendShape:"auto"==(null===(d=this.opts.extra.tooltip)||void 0===d?void 0:d.legendShape)?i.legendShape:null===(g=this.opts.extra.tooltip)||void 0===g?void 0:g.legendShape};c.push(u,f,y,m)});let x=[],d={x:0,y:0};for(let t=0;t<n.length;t++){let i=n[t];void 0!==i[e]&&null!==i[e]&&x.push(i[e])}return d.x=Math.round(x[0][0].x),{textList:c,offset:d}}coordinateToPoint(t,i,e,s,o,a){return{x:(i-e.xMin)*s+o,y:(e.yMax-t)*s+a}}pointToCoordinate(t,i,e,s,o,a){return{x:(i-o)/s+e.xMin,y:e.yMax-(t-a)/s}}lonlat2mercator(t,i){let e=20037508.34*t/180,s=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return s=20037508.34*s/180,[e,s]}mercator2lonlat(t,i){let e=t/20037508.34*180,s=i/20037508.34*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),[e,s]}isRayIntersectsSegment(t,i,e){if(i[1]==e[1])return!1;if(i[1]>t[1]&&e[1]>t[1])return!1;if(i[1]<t[1]&&e[1]<t[1])return!1;if(i[1]==t[1]&&e[1]>t[1])return!1;if(e[1]==t[1]&&i[1]>t[1])return!1;if(i[0]<t[0]&&e[1]<t[1])return!1;return!(e[0]-(e[0]-i[0])*(e[1]-t[1])/(e[1]-i[1])<t[0])}isPoiWithinPoly(t,i,e){let s=0;for(let o=0;o<i.length;o++)if(Array.isArray(i[o])){let a=i[o][0];if(1==i.length&&(a=i[o][0]),Array.isArray(a))for(let i=0;i<a.length-1;i++){let o=a[i],h=a[i+1];e&&(o=this.lonlat2mercator(a[i][0],a[i][1]),h=this.lonlat2mercator(a[i+1][0],a[i+1][1])),this.isRayIntersectsSegment(t,o,h)&&(s+=1)}}return s%2==1}doubleZoom(t){if(!0!==this.opts.enableScroll)return void console.log("请启用滚动条后使用");if(t.length<2)return;const i=[this.getTouches(t[0]),this.getTouches(t[1])],e=Math.abs(i[0].x-i[1].x);if(!this.scrollOption.moveCount){let i={x:t[0].x,y:this.opts.area[0]/this.opts.pixelRatio+2},e={x:t[1].x,y:this.opts.area[0]/this.opts.pixelRatio+2};this.opts.rotate&&(i={x:this.opts.height/this.opts.pix-this.opts.area[0]/this.opts.pix-2,y:t[0].y},e={x:this.opts.height/this.opts.pix-this.opts.area[0]/this.opts.pix-2,y:t[1].y});const s=this.getCurrentDataIndex(i).index,o=this.getCurrentDataIndex(e).index,a=Math.abs(s-o);return this.scrollOption.moveCount=a,this.scrollOption.moveCurrent1=Math.min(s,o),void(this.scrollOption.moveCurrent2=Math.max(s,o))}let s=e/this.scrollOption.moveCount,o=(this.opts.width-this.opts.area[1]-this.opts.area[3])/s;o=o<=2?2:o,o=o>=this.opts.categories.length?this.opts.categories.length:o,this.opts.animation=!1,this.opts.xAxis.itemCount=o;let a=0,h=this.getXAxisPoints(this.opts.categories),n=h.xAxisPoints,r=h.startX,l=h.endX,p=h.eachSpacing,c=p*this.scrollOption.moveCurrent1,x=l-r-p*(n.length-1);a=-c+Math.min(i[0].x,i[1].x)-this.opts.area[3]-p,a>0&&(a=0),a<x&&(a=x),this.scrollOption.currentOffset=a,this.scrollOption.startTouchX=0,this.scrollOption.distance=0,this.calValidDistance(a),this.opts._scrollDistance_=a,this.render()}}class a{static Create(t){switch(t){case"easeOut":return a.EaseOut;case"easeIn":return a.EaseIn;case"easeInOut":return a.EaseInOut;default:return a.Linear}}static EaseOut(t){return Math.pow(t-1,3)+1}static EaseIn(t){return Math.pow(t,3)}static EaseInOut(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)}static Linear(t){return t}}class h{constructor(t){this.isStop=!1,this.startTimeStamp=null,this.delay=17,this.opts=t,this.timing=a.Create(t.timing),this.animationFrame=this.createAnimationFrame(),this.startAnimation()}createAnimationFrame(){return(t,i)=>{setTimeout(()=>{const i=(new Date).getTime();t(i)},i)}}startAnimation(){this.animationFrame(t=>this.step(t),this.delay)}step(t){var i,e,s,o,a,h,n,r,l,p;if(this.isStop)return null===(e=(i=this.opts).onProcess)||void 0===e||e.call(i,1),void(null===(o=(s=this.opts).onFinish)||void 0===o||o.call(s));if(null===this.startTimeStamp&&(this.startTimeStamp=t),t-this.startTimeStamp<this.opts.duration){let i=(t-this.startTimeStamp)/this.opts.duration;i=this.timing(i),null===(h=(a=this.opts).onProcess)||void 0===h||h.call(a,i),this.animationFrame(t=>this.step(t),this.delay)}else null===(r=(n=this.opts).onProcess)||void 0===r||r.call(n,1),null===(p=(l=this.opts).onFinish)||void 0===p||p.call(l)}stop(){this.isStop=!0}}class n extends o{constructor(t,i={}){super(t,i),this.render()}render(){let t=i.fillSeries(this.opts.series,this.opts);const s=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop();let o=t;this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const a=this.calculateLegendData(o,this.opts.chartData),n=a.area.wholeHeight,r=a.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=n;break;case"bottom":this.opts.area[2]+=n;break;case"left":this.opts.area[3]+=r;break;case"right":this.opts.area[1]+=r}const l=this.calculateYAxisData(t),p=l.yAxisWidth;if(this.opts.yAxis.showTitle){let t=0;for(let i=0;i<this.opts.yAxis.data.length;i++)t=Math.max(t,this.opts.yAxis.data[i].titleFontSize?this.opts.yAxis.data[i].titleFontSize*this.opts.pixelRatio:this.opts.fontSize);this.opts.area[0]+=t}let c=0,x=0;for(let t=0;t<p.length;t++)"left"==p[t].position?(this.opts.area[3]+=x>0?p[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:p[t].width,x+=1):"right"==p[t].position&&(this.opts.area[1]+=c>0?p[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:p[t].width,c+=1);if(this.opts.chartData.yAxisData=l,this.opts.categories&&this.opts.categories.length){this.opts.chartData.xAxisData=this.getXAxisPoints(this.opts.categories);let t=this.calculateCategoriesData(this.opts.categories),i=t.xAxisHeight,s=t.angle;e.xAxisHeight=i,this.opts._xAxisTextAngle_=s,this.opts.area[2]+=i,this.opts.chartData.categoriesData=t}else this.opts.chartData.xAxisData={xAxisPoints:[]};if(this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.animation=new h({timing:this.opts.timing,duration:s,onProcess:i=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.drawYAxisGrid(this.opts.categories),this.drawXAxis(this.opts.categories);let e=this.drawColumnDataPoints(t,i),s=e.xAxisPoints,o=e.calPoints,a=e.eachSpacing;this.opts.chartData.xAxisPoints=s,this.opts.chartData.calPoints=o,this.opts.chartData.eachSpacing=a,this.drawYAxis(),!1!==this.opts.enableMarkLine&&1===i&&this.drawMarkLine(),this.drawLegend(this.opts.chartData),this.drawToolTipBridge(i),this.drawCanvas()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}drawToolTipSplitArea(t,e,s){let o=s,a=this.opts.area[0],h=this.opts.height-this.opts.area[2];this.context.beginPath(),this.setFillStyle(i.hexToRgb(e.activeBgColor,e.activeBgOpacity)),this.context.rect(t-o/2,a,o,h-a),this.context.closePath(),this.context.fill(),this.setFillStyle("#FFFFFF")}getColumnDataPoints(t,i,e,s,o,a=1){let h=[],n=this.opts.height-this.opts.area[0]-this.opts.area[2],r=this.opts.width-this.opts.area[1]-this.opts.area[3];return t.forEach((t,l)=>{if(null===t)h.push(null);else{let p={color:"",x:s[l],y:0},c=t;if("object"==typeof t&&null!==t)if(t.constructor.toString().indexOf("Array")>-1){let i,e,s;i=[].concat(this.opts.chartData.xAxisData.ranges),e=i.shift(),s=i.pop(),c=t[1],p.x=this.opts.area[3]+r*(t[0]-e)/(s-e)}else c=t.value,p.color=t.color;p.x+=o/2;let x=n*(Number(c)*a-i)/(e-i);p.y=this.opts.height-x-this.opts.area[2],h.push(p)}}),h}getStackDataPoints(t,i,e,s,o,a,h,n=1){let r=[],l=this.opts.height-this.opts.area[0]-this.opts.area[2];return t.forEach((t,p)=>{if(null===t)r.push(null);else{let c={color:"",x:s[p]+Math.round(o/2),y:0},x=0,d=0;if(a>0){let s=0;for(let t=0;t<=a;t++){s+=h[t].data[p]}x=l*(s-i)/(e-i),d=l*(s-t-i)/(e-i)}else{let s=t;"object"==typeof t&&null!==t&&(s=t.value,c.color=t.color),x=l*(Number(s)-i)/(e-i),d=0}let g=d;x*=n,g*=n,c.y=this.opts.height-Math.round(x)-this.opts.area[2],c.y0=this.opts.height-Math.round(g)-this.opts.area[2],r.push(c)}}),r}fixColumnStackData(t,i){let e=this.opts.extra.column.categoryGap?this.opts.extra.column.categoryGap*this.opts.pixelRatio:0;return t.map((t,s)=>null===t?null:(t.width=Math.ceil(i-2*e),this.opts.extra.column&&this.opts.extra.column.width&&+this.opts.extra.column.width>0&&(t.width=Math.min(t.width,+this.opts.extra.column.width*this.opts.pixelRatio)),t.width<=0&&(t.width=1),t))}fixColumnMeterData(t,i,e,s){var o;let a=(null===(o=this.opts.extra.column)||void 0===o?void 0:o.categoryGap)?this.opts.extra.column.categoryGap*this.opts.pixelRatio:0;return t.map(t=>null===t?null:(t.width=i-2*a,this.opts.extra.column&&this.opts.extra.column.width&&+this.opts.extra.column.width>0&&(t.width=Math.min(t.width,+this.opts.extra.column.width*this.opts.pixelRatio)),e>0&&(t.width-=s),t))}drawColumnPointText(t,i){var e,s;let o=i.data,a=i.textOffset?i.textOffset:0,h=null!==(s=null===(e=this.opts.extra.column)||void 0===e?void 0:e.labelPosition)&&void 0!==s?s:"outside";t.forEach((t,e)=>{if(null!==t){this.context.beginPath();let s=i.textSize?i.textSize*this.opts.pixelRatio:this.opts.fontSize;this.setFontSize(s),this.setFillStyle(i.textColor||this.opts.fontColor);let n=o[e];if("object"==typeof o[e]&&null!==o[e])if(o[e].constructor.toString().indexOf("Array")>-1){n=o[e][1]}else{n=o[e].value}let r=i.formatter?i.formatter(Number(n),e,i,this.opts):n;this.setTextAlign("center");let l=t.y-4*this.opts.pixelRatio+a*this.opts.pixelRatio;t.y>i.zeroPoints&&(l=t.y+a*this.opts.pixelRatio+s),"insideTop"==h&&(l=t.y+s+a*this.opts.pixelRatio,t.y>i.zeroPoints&&(l=t.y-a*this.opts.pixelRatio-4*this.opts.pixelRatio)),"center"==h&&(l=t.y+a*this.opts.pixelRatio+(this.opts.height-this.opts.area[2]-t.y+s)/2,i.zeroPoints<this.opts.height-this.opts.area[2]&&(l=t.y+a*this.opts.pixelRatio+(i.zeroPoints-t.y+s)/2),t.y>i.zeroPoints&&(l=t.y-a*this.opts.pixelRatio-(t.y-i.zeroPoints-s)/2),"stack"==this.opts.extra.column.type&&(l=t.y+a*this.opts.pixelRatio+(t.y0-t.y+s)/2)),"bottom"==h&&(l=this.opts.height-this.opts.area[2]+a*this.opts.pixelRatio-4*this.opts.pixelRatio,i.zeroPoints<this.opts.height-this.opts.area[2]&&(l=i.zeroPoints+a*this.opts.pixelRatio-4*this.opts.pixelRatio),t.y>i.zeroPoints&&(l=i.zeroPoints-a*this.opts.pixelRatio+s+2*this.opts.pixelRatio),"stack"==this.opts.extra.column.type&&(l=t.y0+a*this.opts.pixelRatio-4*this.opts.pixelRatio)),this.context.fillText(String(r),t.x,l),this.context.closePath(),this.context.stroke(),this.setTextAlign("left")}})}drawColumnDataPoints(t,e=1){let s=this.opts.chartData.xAxisData,o=s.xAxisPoints,a=s.eachSpacing;const h={type:"group",width:a/2,seriesGap:2,categoryGap:0,barBorderCircle:!1,barBorderRadius:[0,0,0,0],linearType:"none",linearOpacity:1,customColor:[],colorStop:0,meterBorder:1,meterFillColor:"#FFFFFF",activeBgColor:"#000000",activeBgOpacity:.08,labelPosition:"outside"};let n=i.objectAssign({},h,this.opts.extra.column),r=[];this.context.save();let l=-2,p=o.length+2;return this.opts._scrollDistance_&&0!==this.opts._scrollDistance_&&!0===this.opts.enableScroll&&(this.context.translate(this.opts._scrollDistance_,0),l=Math.floor(-this.opts._scrollDistance_/a)-2,p=l+this.opts.xAxis.itemCount+4),this.opts.tooltip&&this.opts.tooltip.textList&&this.opts.tooltip.textList.length&&1===e&&this.drawToolTipSplitArea(this.opts.tooltip.offset.x,n,a),n.customColor=i.fillCustomColor(n.linearType,n.customColor,t),t.forEach((s,h)=>{let c,x,d;c=[].concat(this.opts.chartData.yAxisData.ranges[s.index]),x=c.pop(),d=c.shift();let g=(this.opts.height-this.opts.area[0]-this.opts.area[2])*(0-x)/(d-x),u=this.opts.height-Math.round(g)-this.opts.area[2];s.zeroPoints=u;let f=s.data,y=[];switch(n.type){case"group":y=this.getColumnDataPoints(f,x,d,o,a,e);let c=this.getStackDataPoints(f,x,d,o,a,h,t,e);r.push(c),y=this.fixColumnData(y,a,t.length,h);for(let t=0;t<y.length;t++){let e=y[t];if(null!==e&&t>l&&t<p){let t=e.x-e.width/2;this.opts.height,e.y,this.opts.area[2],this.context.beginPath();let o=e.color||s.color,a=e.color||s.color;if("none"!==n.linearType){let a=this.context.createLinearGradient(t,e.y,t,u);"opacity"==n.linearType?(a.addColorStop(0,i.hexToRgb(o,n.linearOpacity)),a.addColorStop(1,i.hexToRgb(o,1))):(a.addColorStop(0,i.hexToRgb(n.customColor[s.linearIndex],n.linearOpacity)),a.addColorStop(n.colorStop,i.hexToRgb(n.customColor[s.linearIndex],n.linearOpacity)),a.addColorStop(1,i.hexToRgb(o,1))),o=a}if(n.barBorderRadius&&4===n.barBorderRadius.length||!0===n.barBorderCircle){const i=t,s=e.y>u?u:e.y,o=e.width,a=Math.abs(u-e.y);n.barBorderCircle&&(n.barBorderRadius=[o/2,o/2,0,0]),e.y>u&&(n.barBorderRadius=[0,0,o/2,o/2]);let h=n.barBorderRadius[0],r=n.barBorderRadius[1],l=n.barBorderRadius[2],p=n.barBorderRadius[3],c=Math.min(o/2,a/2);h=h>c?c:h,r=r>c?c:r,l=l>c?c:l,p=p>c?c:p,h=h<0?0:h,r=r<0?0:r,l=l<0?0:l,p=p<0?0:p,this.context.arc(i+h,s+h,h,-Math.PI,-Math.PI/2),this.context.arc(i+o-r,s+r,r,-Math.PI/2,0),this.context.arc(i+o-l,s+a-l,l,0,Math.PI/2),this.context.arc(i+p,s+a-p,p,Math.PI/2,Math.PI)}else this.context.moveTo(t,e.y),this.context.lineTo(t+e.width,e.y),this.context.lineTo(t+e.width,u),this.context.lineTo(t,u),this.context.lineTo(t,e.y),this.setLineWidth(1),this.setStrokeStyle(a);this.setFillStyle(o),this.context.closePath(),this.context.fill()}}break;case"stack":y=this.getStackDataPoints(f,x,d,o,a,h,t,e),r.push(y),y=this.fixColumnStackData(y,a);for(let t=0;t<y.length;t++){let i=y[t];if(null!==i&&t>l&&t<p){this.context.beginPath();let t=i.color||s.color,e=i.x-i.width/2+1,o=this.opts.height-i.y-this.opts.area[2],a=this.opts.height-i.y0-this.opts.area[2];h>0&&(o-=a),this.setFillStyle(String(t)),this.context.moveTo(e,i.y),this.context.fillRect(e,i.y,i.width,o),this.context.closePath(),this.context.fill()}}break;case"meter":y=this.getDataPoints(f,x,d,o,a,e),r.push(y),y=this.fixColumnMeterData(y,a,h,n.meterBorder);for(let t=0;t<y.length;t++){let i=y[t];if(null!==i&&t>l&&t<p){this.context.beginPath(),0==h&&n.meterBorder>0&&(this.setStrokeStyle(s.color),this.setLineWidth(n.meterBorder*this.opts.pixelRatio)),0==h?this.setFillStyle(n.meterFillColor):this.setFillStyle(i.color||s.color);let t=i.x-i.width/2;if(this.opts.height,i.y,this.opts.area[2],n.barBorderRadius&&4===n.barBorderRadius.length||!0===n.barBorderCircle){const e=t,s=i.y,o=i.width,a=u-i.y;n.barBorderCircle&&(n.barBorderRadius=[o/2,o/2,0,0]);let h=n.barBorderRadius[0],r=n.barBorderRadius[1],l=n.barBorderRadius[2],p=n.barBorderRadius[3],c=Math.min(o/2,a/2);h=h>c?c:h,r=r>c?c:r,l=l>c?c:l,p=p>c?c:p,h=h<0?0:h,r=r<0?0:r,l=l<0?0:l,p=p<0?0:p,this.context.arc(e+h,s+h,h,-Math.PI,-Math.PI/2),this.context.arc(e+o-r,s+r,r,-Math.PI/2,0),this.context.arc(e+o-l,s+a-l,l,0,Math.PI/2),this.context.arc(e+p,s+a-p,p,Math.PI/2,Math.PI),this.context.fill()}else this.context.moveTo(t,i.y),this.context.lineTo(t+i.width,i.y),this.context.lineTo(t+i.width,u),this.context.lineTo(t,u),this.context.lineTo(t,i.y),this.context.fill();0==h&&n.meterBorder>0&&(this.context.closePath(),this.context.stroke())}}}}),!1!==this.opts.dataLabel&&1===e&&t.forEach((i,s)=>{let h,r,l;h=[].concat(this.opts.chartData.yAxisData.ranges[i.index]),r=h.pop(),l=h.shift();let p=i.data,c=[];switch(n.type){case"group":c=this.getColumnDataPoints(p,r,l,o,a,e),c=this.fixColumnData(c,a,t.length,s),this.drawColumnPointText(c,i);break;case"stack":c=this.getStackDataPoints(p,r,l,o,a,s,t,e),this.drawColumnPointText(c,i);break;case"meter":c=this.getDataPoints(p,r,l,o,a,e),this.drawColumnPointText(c,i)}}),this.context.restore(),{xAxisPoints:o,calPoints:r,eachSpacing:a}}}class r extends o{constructor(t,i={}){super(t,i),this.render()}render(){let t=this.opts.series,s=[];t=this.fixPieSeries(t);for(let i=0;i<t.length;i++)!1!==t[i].show&&s.push(t[i].name);this.opts.categories=s,t=i.fillSeries(t,this.opts);const o=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop();let a=t;this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const n=this.calculateLegendData(a,this.opts.chartData),r=n.area.wholeHeight,l=n.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=r;break;case"bottom":this.opts.area[2]+=r;break;case"left":this.opts.area[3]+=l;break;case"right":this.opts.area[1]+=l}const p=this.calculateYAxisData(t),c=p.yAxisWidth;if(this.opts.yAxis.showTitle){let t=0;for(let i=0;i<this.opts.yAxis.data.length;i++)t=Math.max(t,this.opts.yAxis.data[i].titleFontSize?this.opts.yAxis.data[i].titleFontSize*this.opts.pixelRatio:this.opts.fontSize);this.opts.area[0]+=t}let x=0,d=0;for(let t=0;t<c.length;t++)"left"==c[t].position?(this.opts.area[3]+=d>0?c[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:c[t].width,d+=1):"right"==c[t].position&&(this.opts.area[1]+=x>0?c[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:c[t].width,x+=1);if(this.opts.chartData.yAxisData=p,this.opts.categories&&this.opts.categories.length){this.opts.chartData.xAxisData=this.getXAxisPoints(this.opts.categories);let t=this.calculateCategoriesData(this.opts.categories),i=t.xAxisHeight,s=t.angle;e.xAxisHeight=i,this.opts._xAxisTextAngle_=s,this.opts.area[2]+=i,this.opts.chartData.categoriesData=t}else this.opts.chartData.xAxisData={xAxisPoints:[]};if(this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.animation=new h({timing:this.opts.timing,duration:o,onProcess:i=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.drawYAxisGrid(this.opts.categories),this.drawXAxis(this.opts.categories);let e=this.drawMountDataPoints(t,i),s=e.xAxisPoints,o=e.calPoints,a=e.eachSpacing;this.opts.chartData.xAxisPoints=s,this.opts.chartData.calPoints=o,this.opts.chartData.eachSpacing=a,this.drawYAxis(),!1!==this.opts.enableMarkLine&&1===i&&this.drawMarkLine(),this.drawLegend(this.opts.chartData),this.drawToolTipBridge(i),this.drawCanvas()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}drawMountDataPoints(t,e=1){let s=this.opts.chartData.xAxisData,o=s.xAxisPoints,a=s.eachSpacing,h=i.objectAssign({},{type:"mount",widthRatio:1,borderWidth:1,barBorderCircle:!1,barBorderRadius:[],linearType:"none",linearOpacity:1,customColor:[],colorStop:0},this.opts.extra.mount);h.widthRatio=h.widthRatio<=0?0:h.widthRatio,h.widthRatio=h.widthRatio>=2?2:h.widthRatio,this.context.save();let n,r,l,p=-2,c=o.length+2;this.opts._scrollDistance_&&0!==this.opts._scrollDistance_&&!0===this.opts.enableScroll&&(this.context.translate(this.opts._scrollDistance_,0),p=Math.floor(-this.opts._scrollDistance_/a)-2,c=p+this.opts.xAxis.itemCount+4),h.customColor=i.fillCustomColor(h.linearType,h.customColor,t),n=[].concat(this.opts.chartData.yAxisData.ranges[0]),r=n.pop(),l=n.shift();let x=(this.opts.height-this.opts.area[0]-this.opts.area[2])*(0-r)/(l-r),d=this.opts.height-Math.round(x)-this.opts.area[2],g=this.getMountDataPoints(t,r,l,o,a,h,e);switch(h.type){case"mount":for(let e=0;e<g.length;e++){let s=g[e];if(null!==s&&e>p&&e<c){let o=s.x-a*h.widthRatio/2;this.opts.height,s.y,this.opts.area[2],this.context.beginPath();let n=s.color||t[e].color,r=s.color||t[e].color;if("none"!==h.linearType){let a=this.context.createLinearGradient(o,s.y,o,d);"opacity"==h.linearType?(a.addColorStop(0,i.hexToRgb(n,h.linearOpacity)),a.addColorStop(1,i.hexToRgb(n,1))):(a.addColorStop(0,i.hexToRgb(h.customColor[t[e].linearIndex],h.linearOpacity)),a.addColorStop(h.colorStop,i.hexToRgb(h.customColor[t[e].linearIndex],h.linearOpacity)),a.addColorStop(1,i.hexToRgb(n,1))),n=a}this.context.moveTo(o,d),this.context.bezierCurveTo(s.x-s.width/4,d,s.x-s.width/4,s.y,s.x,s.y),this.context.bezierCurveTo(s.x+s.width/4,s.y,s.x+s.width/4,d,o+s.width,d),this.setStrokeStyle(r),this.setFillStyle(n),h.borderWidth>0&&(this.setLineWidth(h.borderWidth*this.opts.pixelRatio),this.context.stroke()),this.context.fill()}}break;case"sharp":for(let e=0;e<g.length;e++){let s=g[e];if(null!==s&&e>p&&e<c){let o=s.x-a*h.widthRatio/2,n=this.opts.height-s.y-this.opts.area[2];this.context.beginPath();let r=s.color||t[e].color,l=s.color||t[e].color;if("none"!==h.linearType){let a=this.context.createLinearGradient(o,s.y,o,d);"opacity"==h.linearType?(a.addColorStop(0,i.hexToRgb(r,h.linearOpacity)),a.addColorStop(1,i.hexToRgb(r,1))):(a.addColorStop(0,i.hexToRgb(h.customColor[t[e].linearIndex],h.linearOpacity)),a.addColorStop(h.colorStop,i.hexToRgb(h.customColor[t[e].linearIndex],h.linearOpacity)),a.addColorStop(1,i.hexToRgb(r,1))),r=a}this.context.moveTo(o,d),this.context.quadraticCurveTo(s.x-0,d-n/4,s.x,s.y),this.context.quadraticCurveTo(s.x+0,d-n/4,o+s.width,d),this.setStrokeStyle(l),this.setFillStyle(r),h.borderWidth>0&&(this.setLineWidth(h.borderWidth*this.opts.pixelRatio),this.context.stroke()),this.context.fill()}}break;case"bar":for(let e=0;e<g.length;e++){let s=g[e];if(null!==s&&e>p&&e<c){let o=s.x-a*h.widthRatio/2;this.opts.height,s.y,this.opts.area[2],this.context.beginPath();let n=s.color||t[e].color,r=s.color||t[e].color;if("none"!==h.linearType){let a=this.context.createLinearGradient(o,s.y,o,d);"opacity"==h.linearType?(a.addColorStop(0,i.hexToRgb(n,h.linearOpacity)),a.addColorStop(1,i.hexToRgb(n,1))):(a.addColorStop(0,i.hexToRgb(h.customColor[t[e].linearIndex],h.linearOpacity)),a.addColorStop(h.colorStop,i.hexToRgb(h.customColor[t[e].linearIndex],h.linearOpacity)),a.addColorStop(1,i.hexToRgb(n,1))),n=a}if(h.barBorderRadius&&4===h.barBorderRadius.length||!0===h.barBorderCircle){const t=o,i=s.y>d?d:s.y,e=s.width,a=Math.abs(d-s.y);h.barBorderCircle&&(h.barBorderRadius=[e/2,e/2,0,0]),s.y>d&&(h.barBorderRadius=[0,0,e/2,e/2]);let n=h.barBorderRadius[0],r=h.barBorderRadius[1],l=h.barBorderRadius[2],p=h.barBorderRadius[3],c=Math.min(e/2,a/2);n=n>c?c:n,r=r>c?c:r,l=l>c?c:l,p=p>c?c:p,n=n<0?0:n,r=r<0?0:r,l=l<0?0:l,p=p<0?0:p,this.context.arc(t+n,i+n,n,-Math.PI,-Math.PI/2),this.context.arc(t+e-r,i+r,r,-Math.PI/2,0),this.context.arc(t+e-l,i+a-l,l,0,Math.PI/2),this.context.arc(t+p,i+a-p,p,Math.PI/2,Math.PI)}else this.context.moveTo(o,s.y),this.context.lineTo(o+s.width,s.y),this.context.lineTo(o+s.width,d),this.context.lineTo(o,d),this.context.lineTo(o,s.y);this.setStrokeStyle(r),this.setFillStyle(n),h.borderWidth>0&&(this.setLineWidth(h.borderWidth*this.opts.pixelRatio),this.context.closePath(),this.context.stroke()),this.context.fill()}}break;case"triangle":for(let e=0;e<g.length;e++){let s=g[e];if(null!==s&&e>p&&e<c){let o=s.x-a*h.widthRatio/2;this.opts.height,s.y,this.opts.area[2],this.context.beginPath();let n=s.color||t[e].color,r=s.color||t[e].color;if("none"!==h.linearType){let a=this.context.createLinearGradient(o,s.y,o,d);"opacity"==h.linearType?(a.addColorStop(0,i.hexToRgb(n,h.linearOpacity)),a.addColorStop(1,i.hexToRgb(n,1))):(a.addColorStop(0,i.hexToRgb(h.customColor[t[e].linearIndex],h.linearOpacity)),a.addColorStop(h.colorStop,i.hexToRgb(h.customColor[t[e].linearIndex],h.linearOpacity)),a.addColorStop(1,i.hexToRgb(n,1))),n=a}this.context.moveTo(o,d),this.context.lineTo(s.x,s.y),this.context.lineTo(o+s.width,d),this.setStrokeStyle(r),this.setFillStyle(n),h.borderWidth>0&&(this.setLineWidth(h.borderWidth*this.opts.pixelRatio),this.context.stroke()),this.context.fill()}}}if(!1!==this.opts.dataLabel&&1===e){let i,s,n;i=[].concat(this.opts.chartData.yAxisData.ranges[0]),s=i.pop(),n=i.shift(),g=this.getMountDataPoints(t,s,n,o,a,h,e),this.drawMountPointText(g,t,d)}return this.context.restore(),{xAxisPoints:o,calPoints:g,eachSpacing:a}}getMountDataPoints(t,i,e,s,o,a,h){let n=[],r=this.opts.height-this.opts.area[0]-this.opts.area[2];this.opts.width,this.opts.area[1],this.opts.area[3];let l=o*a.widthRatio;return t.forEach((t,a)=>{if(null===t)n.push(null);else{let p={color:t.color,x:s[a]+o/2,y:0},c=t.data,x=r*(c*h-i)/(e-i);p.y=this.opts.height-x-this.opts.area[2],p.value=c,p.width=l,n.push(p)}}),n}drawMountPointText(t,i,e){this.opts.extra.mount.labelPosition,t.forEach((t,s)=>{if(null!==t){this.context.beginPath();let o=i[s].textSize?i[s].textSize*this.opts.pixelRatio:this.opts.fontSize;this.setFontSize(o),this.setFillStyle(i[s].textColor||this.opts.fontColor);let a=t.value,h=i[s].formatter?i[s].formatter(a,s,i[s],this.opts):a;this.setTextAlign("center");let n=t.y-4*this.opts.pixelRatio+0*this.opts.pixelRatio;t.y>e&&(n=t.y+0*this.opts.pixelRatio+o),this.context.fillText(String(h),t.x,n),this.context.closePath(),this.context.stroke(),this.setTextAlign("left")}})}}class l extends o{constructor(t,i={}){super(t,i),this.render()}render(){let t=this.opts.series,s=this.opts.categories;t=i.fillSeries(t,this.opts);const o=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop();let a=t;this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const n=this.calculateLegendData(a,this.opts.chartData),r=n.area.wholeHeight,l=n.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=r;break;case"bottom":this.opts.area[2]+=r;break;case"left":this.opts.area[3]+=l;break;case"right":this.opts.area[1]+=l}const p=this.calculateYAxisData(t),c=p.yAxisWidth;if(this.opts.yAxis.showTitle){let t=0;for(let i=0;i<this.opts.yAxis.data.length;i++)t=Math.max(t,this.opts.yAxis.data[i].titleFontSize?this.opts.yAxis.data[i].titleFontSize*this.opts.pixelRatio:this.opts.fontSize);this.opts.area[0]+=t}let x=0,d=0;for(let t=0;t<c.length;t++)"left"==c[t].position?(this.opts.area[3]+=d>0?c[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:c[t].width,d+=1):"right"==c[t].position&&(this.opts.area[1]+=x>0?c[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:c[t].width,x+=1);this.opts.chartData.yAxisData=p,this.opts.chartData.xAxisData=this.calculateXAxisData(t),s=this.opts.chartData.xAxisData.rangesFormat;let g=this.calculateCategoriesData(s),u=g.xAxisHeight,f=g.angle;if(e.xAxisHeight=u,this.opts._xAxisTextAngle_=f,this.opts.area[2]+=u,this.opts.chartData.categoriesData=g,this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.animation=new h({timing:this.opts.timing,duration:o,onProcess:i=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.drawXAxis(s);let e=this.drawBarDataPoints(t,i),o=e.yAxisPoints,a=e.calPoints,h=e.eachSpacing;this.opts.chartData.yAxisPoints=o,this.opts.chartData.xAxisPoints=this.opts.chartData.xAxisData.xAxisPoints,this.opts.chartData.calPoints=a,this.opts.chartData.eachSpacing=h,this.drawYAxis(),!1!==this.opts.enableMarkLine&&1===i&&this.drawMarkLine(),this.drawLegend(this.opts.chartData),this.drawToolTipBridge(i),this.drawCanvas()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}drawBarDataPoints(t,e=1){let s=[],o=(this.opts.height-this.opts.area[0]-this.opts.area[2])/this.opts.categories.length;for(let t=0;t<this.opts.categories.length;t++)s.push(this.opts.area[0]+o/2+o*t);let a=i.objectAssign({},{type:"group",width:o/2,meterBorder:4,meterFillColor:"#FFFFFF",barBorderCircle:!1,barBorderRadius:[],seriesGap:2,linearType:"none",linearOpacity:1,customColor:[],colorStop:0},this.opts.extra.bar),h=[];this.context.save();let n=s.length+2;return this.opts.tooltip&&this.opts.tooltip.textList&&this.opts.tooltip.textList.length&&1===e&&this.drawBarToolTipSplitArea(this.opts.tooltip.offset.y,o),a.customColor=i.fillCustomColor(a.linearType,a.customColor,t),t.forEach((r,l)=>{let p,c,x;p=[].concat(this.opts.chartData.xAxisData.ranges),x=p.pop(),c=p.shift();let d=r.data,g=[];switch(a.type){case"group":g=this.getBarDataPoints(d,c,x,s,o,e);let p=this.getBarStackDataPoints(d,c,x,s,o,l,t,e);h.push(p),g=this.fixBarData(g,o,t.length,l);for(let t=0;t<g.length;t++){let e=g[t];if(null!==e&&t>-2&&t<n){let t=this.opts.area[3],s=e.y-e.width/2;e.height,this.context.beginPath();let o=e.color||r.color,h=e.color||r.color;if("none"!==a.linearType){let s=this.context.createLinearGradient(t,e.y,e.x,e.y);"opacity"==a.linearType?(s.addColorStop(0,i.hexToRgb(o,a.linearOpacity)),s.addColorStop(1,i.hexToRgb(o,1))):(s.addColorStop(0,i.hexToRgb(a.customColor[r.linearIndex],a.linearOpacity)),s.addColorStop(a.colorStop,i.hexToRgb(a.customColor[r.linearIndex],a.linearOpacity)),s.addColorStop(1,i.hexToRgb(o,1))),o=s}if(a.barBorderRadius&&4===a.barBorderRadius.length||!0===a.barBorderCircle){const i=t,s=e.width,o=e.y-e.width/2,h=e.height;a.barBorderCircle&&(a.barBorderRadius=[s/2,s/2,0,0]);let n=a.barBorderRadius[0],r=a.barBorderRadius[1],l=a.barBorderRadius[2],p=a.barBorderRadius[3],c=Math.min(s/2,h/2);n=n>c?c:n,r=r>c?c:r,l=l>c?c:l,p=p>c?c:p,n=n<0?0:n,r=r<0?0:r,l=l<0?0:l,p=p<0?0:p,this.context.arc(i+p,o+p,p,-Math.PI,-Math.PI/2),this.context.arc(e.x-n,o+n,n,-Math.PI/2,0),this.context.arc(e.x-r,o+s-r,r,0,Math.PI/2),this.context.arc(i+l,o+s-l,l,Math.PI/2,Math.PI)}else this.context.moveTo(t,s),this.context.lineTo(e.x,s),this.context.lineTo(e.x,s+e.width),this.context.lineTo(t,s+e.width),this.context.lineTo(t,s),this.setLineWidth(1),this.setStrokeStyle(h);this.setFillStyle(o),this.context.closePath(),this.context.fill()}}break;case"stack":g=this.getBarStackDataPoints(d,c,x,s,o,l,t,e),h.push(g),g=this.fixBarStackData(g,o);for(let t=0;t<g.length;t++){let i=g[t];if(null!==i&&t>-2&&t<n){this.context.beginPath();let t=i.color||r.color,e=i.x0;this.setFillStyle(t),this.context.moveTo(e,i.y-i.width/2),this.context.fillRect(e,i.y-i.width/2,i.height,i.width),this.context.closePath(),this.context.fill()}}}}),!1!==this.opts.dataLabel&&1===e&&t.forEach((i,h)=>{let n,r,l;n=[].concat(this.opts.chartData.xAxisData.ranges),l=n.pop(),r=n.shift();let p=i.data,c=[];switch(a.type){case"group":c=this.getBarDataPoints(p,r,l,s,o,e),c=this.fixBarData(c,o,t.length,h),this.drawBarPointText(c,i);break;case"stack":c=this.getBarStackDataPoints(p,r,l,s,o,h,t,e),this.drawBarPointText(c,i)}}),{yAxisPoints:s,calPoints:h,eachSpacing:o}}drawBarToolTipSplitArea(t,e){let s=i.objectAssign({},{activeBgColor:"#000000",activeBgOpacity:.08},this.opts.extra.bar),o=this.opts.area[3],a=this.opts.width-this.opts.area[1];this.context.beginPath(),this.setFillStyle(i.hexToRgb(s.activeBgColor,s.activeBgOpacity)),this.context.rect(o,t-e/2,a-o,e),this.context.closePath(),this.context.fill(),this.setFillStyle("#FFFFFF")}getBarDataPoints(t,i,e,s,o,a=1){let h=[],n=this.opts.width-this.opts.area[1]-this.opts.area[3];return t.forEach((t,o)=>{if(null===t)h.push(null);else{let r={color:"",x:0,y:0};r.y=s[o];let l=t,p=n*(l-i)/(e-i);p*=a,r.height=p,r.value=l,r.x=p+this.opts.area[3],h.push(r)}}),h}getBarStackDataPoints(t,i,e,s,o,a,h,n=1){let r=[],l=this.opts.width-this.opts.area[1]-this.opts.area[3];return t.forEach((t,o)=>{if(null===t)r.push(null);else{let p={color:"",x:0,y:0};p.y=s[o];let c=0,x=0;if(a>0){let s=0;for(let t=0;t<=a;t++)s+=h[t].data[o];c=l*(s-i)/(e-i),x=l*(s-t-i)/(e-i)}else{c=l*(t-i)/(e-i),x=0}let d=x;c*=n,d*=n,p.height=c-d,p.x=this.opts.area[3]+c,p.x0=this.opts.area[3]+d,r.push(p)}}),r}fixBarData(t,i,e,s){return t.map(t=>{var o,a,h,n;if(null===t)return null;let r=0,l=0;return r=(null===(o=this.opts.extra.bar)||void 0===o?void 0:o.seriesGap)?(null===(a=this.opts.extra.bar)||void 0===a?void 0:a.seriesGap)*this.opts.pixelRatio:0,l=(null===(h=this.opts.extra.bar)||void 0===h?void 0:h.categoryGap)?(null===(n=this.opts.extra.bar)||void 0===n?void 0:n.categoryGap)*this.opts.pixelRatio:0,r=Math.min(r,i/e),l=Math.min(l,i/e),t.width=Math.ceil((i-2*l-r*(e-1))/e),this.opts.extra.bar&&this.opts.extra.bar.width&&+this.opts.extra.bar.width>0&&(t.width=Math.min(t.width,+this.opts.extra.bar.width*this.opts.pixelRatio)),t.width<=0&&(t.width=1),t.y+=(s+.5-e/2)*(t.width+r),t})}fixBarStackData(t,i){var e,s;let o=(null===(e=this.opts.extra.bar)||void 0===e?void 0:e.categoryGap)?(null===(s=this.opts.extra.bar)||void 0===s?void 0:s.categoryGap)*this.opts.pixelRatio:0;return t.map((t,e)=>null===t?null:(t.width=Math.ceil(i-2*o),this.opts.extra.bar&&this.opts.extra.bar.width&&+this.opts.extra.bar.width>0&&(t.width=Math.min(t.width,+this.opts.extra.bar.width*this.opts.pixelRatio)),t.width<=0&&(t.width=1),t))}drawBarPointText(t,i){let e=i.data;i.textOffset&&i.textOffset,t.forEach((t,s)=>{if(null!==t){this.context.beginPath();let o=i.textSize?i.textSize*this.opts.pixelRatio:this.opts.fontSize;this.setFontSize(o),this.setFillStyle(i.textColor||this.opts.fontColor);let a=e[s],h=i.formatter?i.formatter(a,s,i,this.opts):a;this.setTextAlign("left"),this.context.fillText(String(h),t.x+4*this.opts.pixelRatio,t.y+o/2-3),this.context.closePath(),this.context.stroke()}})}}class p extends o{constructor(t,i={}){super(t,i),this.render()}render(){let t=i.fillSeries(this.opts.series,this.opts),s=this.opts.categories;const o=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop();let a=t;this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const n=this.calculateLegendData(a,this.opts.chartData),r=n.area.wholeHeight,l=n.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=r;break;case"bottom":this.opts.area[2]+=r;break;case"left":this.opts.area[3]+=l;break;case"right":this.opts.area[1]+=l}const p=this.calculateYAxisData(t),c=p.yAxisWidth;if(this.opts.yAxis.showTitle){let t=0;for(let i=0;i<this.opts.yAxis.data.length;i++)t=Math.max(t,this.opts.yAxis.data[i].titleFontSize?this.opts.yAxis.data[i].titleFontSize*this.opts.pixelRatio:this.opts.fontSize);this.opts.area[0]+=t}let x=0,d=0;for(let t=0;t<c.length;t++)"left"==c[t].position?(this.opts.area[3]+=d>0?c[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:c[t].width,d+=1):"right"==c[t].position&&(this.opts.area[1]+=x>0?c[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:c[t].width,x+=1);this.opts.chartData.yAxisData=p,this.opts.categories&&this.opts.categories.length?this.opts.chartData.xAxisData=this.getXAxisPoints(this.opts.categories):(this.opts.chartData.xAxisData=this.calculateXAxisData(t),s=this.opts.chartData.xAxisData.rangesFormat);let g=this.calculateCategoriesData(s),u=g.xAxisHeight,f=g.angle;if(e.xAxisHeight=u,this.opts._xAxisTextAngle_=f,this.opts.area[2]+=u,this.opts.chartData.categoriesData=g,this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.animation=new h({timing:this.opts.timing,duration:o,onProcess:i=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.drawYAxisGrid(s),this.drawXAxis(s);let e=this.drawLineDataPoints(t,i),o=e.xAxisPoints,a=e.calPoints,h=e.eachSpacing;this.opts.chartData.xAxisPoints=o,this.opts.chartData.calPoints=a,this.opts.chartData.eachSpacing=h,this.drawYAxis(),!1!==this.opts.enableMarkLine&&1===i&&this.drawMarkLine(),this.drawLegend(this.opts.chartData),this.drawToolTipBridge(i),this.drawCanvas()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}drawLineDataPoints(t,e=1){let s=i.objectAssign({},{type:"straight",width:2,activeType:"none",linearType:"none",onShadow:!1,animation:"vertical"},this.opts.extra.line);s.width*=this.opts.pixelRatio;let o=this.opts.chartData.xAxisData,a=o.xAxisPoints,h=o.eachSpacing,n=[];this.context.save();let r=0,l=this.opts.width+h;return this.opts._scrollDistance_&&0!==this.opts._scrollDistance_&&!0===this.opts.enableScroll&&(this.context.translate(this.opts._scrollDistance_,0),r=-this.opts._scrollDistance_-2*h+this.opts.area[3],l=r+(this.opts.xAxis.itemCount+4)*h),t.forEach((t,o)=>{let p,c,x;this.context.beginPath(),this.setStrokeStyle(t.color),this.context.moveTo(-1e4,-1e4),this.context.lineTo(-10001,-10001),this.context.stroke(),p=[].concat(this.opts.chartData.yAxisData.ranges[t.index]),c=p.pop(),x=p.shift();let d=t.data,g=this.getLineDataPoints(d,c,x,a,h,s,e);n.push(g);let u=this.splitPoints(g,t);if("dash"==t.lineType){let i=t.dashLength?t.dashLength:8;i*=this.opts.pixelRatio,this.setLineDash([i,i])}this.context.beginPath();let f=t.color;if("none"!==s.linearType&&t.linearColor&&t.linearColor.length>0){let e=this.context.createLinearGradient(this.opts.chartData.xAxisData.startX,this.opts.height/2,this.opts.chartData.xAxisData.endX,this.opts.height/2);for(let s=0;s<t.linearColor.length;s++)e.addColorStop(t.linearColor[s][0],i.hexToRgb(t.linearColor[s][1],1));f=e}this.setStrokeStyle(f),1==s.onShadow&&t.setShadow&&t.setShadow.length>0?this.setShadow(t.setShadow[0],t.setShadow[1],t.setShadow[2],t.setShadow[3]):this.setShadow(0,0,0,"rgba(0,0,0,0)"),this.setLineWidth(s.width),u.forEach((t,i)=>{if(1===t.length)this.context.moveTo(t[0].x,t[0].y);else{this.context.moveTo(t[0].x,t[0].y);let i=0;if("curve"===s.type)for(let e=0;e<t.length;e++){let s=t[e];if(0==i&&s.x>r&&(this.context.moveTo(s.x,s.y),i=1),e>0&&s.x>r&&s.x<l){let i=this.createCurveControlPoints(t,e-1);this.context.bezierCurveTo(i.ctrA.x,i.ctrA.y,i.ctrB.x,i.ctrB.y,s.x,s.y)}}if("straight"===s.type)for(let e=0;e<t.length;e++){let s=t[e];0==i&&s.x>r&&(this.context.moveTo(s.x,s.y),i=1),e>0&&s.x>r&&s.x<l&&this.context.lineTo(s.x,s.y)}if("step"===s.type)for(let e=0;e<t.length;e++){let s=t[e];0==i&&s.x>r&&(this.context.moveTo(s.x,s.y),i=1),e>0&&s.x>r&&s.x<l&&(this.context.lineTo(s.x,t[e-1].y),this.context.lineTo(s.x,s.y))}this.context.moveTo(t[0].x,t[0].y)}}),this.context.stroke(),this.setLineDash([]),!1!==this.opts.dataPointShape&&this.drawPointShape(g,t.color,t.pointShape),this.drawActivePoint(g,t.color,t.pointShape,s,o)}),!1!==this.opts.dataLabel&&1===e&&t.forEach((t,i)=>{let s,o,n;s=[].concat(this.opts.chartData.yAxisData.ranges[t.index]),o=s.pop(),n=s.shift();let r=t.data,l=this.getDataPoints(r,o,n,a,h,e);this.drawPointText(l,t)}),this.context.restore(),{xAxisPoints:a,calPoints:n,eachSpacing:h}}getLineDataPoints(t,i,e,s,o,a,h){let n=this.opts.xAxis.boundaryGap,r=[],l=this.opts.height-this.opts.area[0]-this.opts.area[2],p=this.opts.width-this.opts.area[1]-this.opts.area[3];return t.forEach((t,c)=>{if(null===t)r.push(null);else{let x={color:"",x:0,y:0};if("vertical"==a.animation){x.x=s[c];let a=t;if("object"==typeof t&&null!==t&&Array.isArray(t)){let i,e,s;i=[].concat(this.opts.chartData.xAxisData.ranges),e=i.shift(),s=i.pop(),a=t[1],x.x=this.opts.area[3]+p*(t[0]-e)/(s-e)}"center"==n&&(x.x+=o/2);let d=l*(a-i)/(e-i);d*=h,x.y=this.opts.height-d-this.opts.area[2],r.push(x)}else{x.x=s[0]+o*c*h;let a=t;"center"==n&&(x.x+=o/2);let p=l*(a-i)/(e-i);x.y=this.opts.height-p-this.opts.area[2],r.push(x)}}}),r}}class c extends o{constructor(t,i={}){super(t,i),this.render()}render(){let t=i.fillSeries(this.opts.series,this.opts),s=this.opts.categories;const o=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop();let a=t;this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const n=this.calculateLegendData(a,this.opts.chartData),r=n.area.wholeHeight,l=n.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=r;break;case"bottom":this.opts.area[2]+=r;break;case"left":this.opts.area[3]+=l;break;case"right":this.opts.area[1]+=l}const p=this.calculateYAxisData(t),c=p.yAxisWidth;if(this.opts.yAxis.showTitle){let t=0;for(let i=0;i<this.opts.yAxis.data.length;i++)t=Math.max(t,this.opts.yAxis.data[i].titleFontSize?this.opts.yAxis.data[i].titleFontSize*this.opts.pixelRatio:this.opts.fontSize);this.opts.area[0]+=t}let x=0,d=0;for(let t=0;t<c.length;t++)"left"==c[t].position?(this.opts.area[3]+=d>0?c[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:c[t].width,d+=1):"right"==c[t].position&&(this.opts.area[1]+=x>0?c[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:c[t].width,x+=1);this.opts.chartData.yAxisData=p,this.opts.categories&&this.opts.categories.length?this.opts.chartData.xAxisData=this.getXAxisPoints(this.opts.categories):(this.opts.chartData.xAxisData=this.calculateXAxisData(t),s=this.opts.chartData.xAxisData.rangesFormat);let g=this.calculateCategoriesData(s),u=g.xAxisHeight,f=g.angle;if(e.xAxisHeight=u,this.opts._xAxisTextAngle_=f,this.opts.area[2]+=u,this.opts.chartData.categoriesData=g,this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.animation=new h({timing:this.opts.timing,duration:o,onProcess:i=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.drawYAxisGrid(s),this.drawXAxis(s);let e=this.drawAreaDataPoints(t,i),o=e.xAxisPoints,a=e.calPoints,h=e.eachSpacing;this.opts.chartData.xAxisPoints=o,this.opts.chartData.calPoints=a,this.opts.chartData.eachSpacing=h,this.drawYAxis(),!1!==this.opts.enableMarkLine&&1===i&&this.drawMarkLine(),this.drawLegend(this.opts.chartData),this.drawToolTipBridge(i),this.drawCanvas()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}drawAreaDataPoints(t,e=1){let s=i.objectAssign({},{type:"straight",opacity:.2,addLine:!1,width:2,gradient:!1,activeType:"none"},this.opts.extra.area),o=this.opts.chartData.xAxisData,a=o.xAxisPoints,h=o.eachSpacing,n=this.opts.height-this.opts.area[2],r=[];this.context.save();let l=0,p=this.opts.width+h;return this.opts._scrollDistance_&&0!==this.opts._scrollDistance_&&!0===this.opts.enableScroll&&(this.context.translate(this.opts._scrollDistance_,0),l=-this.opts._scrollDistance_-2*h+this.opts.area[3],p=l+(this.opts.xAxis.itemCount+4)*h),t.forEach((t,o)=>{let c,x,d;c=[].concat(this.opts.chartData.yAxisData.ranges[t.index]),x=c.pop(),d=c.shift();let g=t.data,u=this.getDataPoints(g,x,d,a,h,e);r.push(u);let f=this.splitPoints(u,t);for(let e=0;e<f.length;e++){let o=f[e];if(this.context.beginPath(),this.setStrokeStyle(i.hexToRgb(t.color,s.opacity)),s.gradient){let e=this.context.createLinearGradient(0,this.opts.area[0],0,this.opts.height-this.opts.area[2]);e.addColorStop(0,i.hexToRgb(t.color,s.opacity)),e.addColorStop(1,i.hexToRgb("#FFFFFF",.1)),this.setFillStyle(e)}else this.setFillStyle(i.hexToRgb(t.color,s.opacity));if(this.setLineWidth(s.width*this.opts.pixelRatio),o.length>1){let t=o[0],i=o[o.length-1];this.context.moveTo(t.x,t.y);let e=0;if("curve"===s.type)for(let t=0;t<o.length;t++){let i=o[t];if(0==e&&i.x>l&&(this.context.moveTo(i.x,i.y),e=1),t>0&&i.x>l&&i.x<p){let e=this.createCurveControlPoints(o,t-1);this.context.bezierCurveTo(e.ctrA.x,e.ctrA.y,e.ctrB.x,e.ctrB.y,i.x,i.y)}}if("straight"===s.type)for(let t=0;t<o.length;t++){let i=o[t];0==e&&i.x>l&&(this.context.moveTo(i.x,i.y),e=1),t>0&&i.x>l&&i.x<p&&this.context.lineTo(i.x,i.y)}if("step"===s.type)for(let t=0;t<o.length;t++){let i=o[t];0==e&&i.x>l&&(this.context.moveTo(i.x,i.y),e=1),t>0&&i.x>l&&i.x<p&&(this.context.lineTo(i.x,o[t-1].y),this.context.lineTo(i.x,i.y))}this.context.lineTo(i.x,n),this.context.lineTo(t.x,n),this.context.lineTo(t.x,t.y)}else{let t=o[0];this.context.moveTo(t.x-h/2,t.y)}if(this.context.closePath(),this.context.fill(),s.addLine){if("dash"==t.lineType){let i=t.dashLength?t.dashLength:8;i*=this.opts.pixelRatio,this.setLineDash([i,i])}if(this.context.beginPath(),this.setStrokeStyle(t.color),this.setLineWidth(s.width*this.opts.pixelRatio),1===o.length)this.context.moveTo(o[0].x,o[0].y);else{this.context.moveTo(o[0].x,o[0].y);let t=0;if("curve"===s.type)for(let i=0;i<o.length;i++){let e=o[i];if(0==t&&e.x>l&&(this.context.moveTo(e.x,e.y),t=1),i>0&&e.x>l&&e.x<p){let t=this.createCurveControlPoints(o,i-1);this.context.bezierCurveTo(t.ctrA.x,t.ctrA.y,t.ctrB.x,t.ctrB.y,e.x,e.y)}}if("straight"===s.type)for(let i=0;i<o.length;i++){let e=o[i];0==t&&e.x>l&&(this.context.moveTo(e.x,e.y),t=1),i>0&&e.x>l&&e.x<p&&this.context.lineTo(e.x,e.y)}if("step"===s.type)for(let i=0;i<o.length;i++){let e=o[i];0==t&&e.x>l&&(this.context.moveTo(e.x,e.y),t=1),i>0&&e.x>l&&e.x<p&&(this.context.lineTo(e.x,o[i-1].y),this.context.lineTo(e.x,e.y))}this.context.moveTo(o[0].x,o[0].y)}this.context.stroke(),this.setLineDash([])}}!1!==this.opts.dataPointShape&&this.drawPointShape(u,t.color,t.pointShape),this.drawActivePoint(u,t.color,t.pointShape,s,o)}),!1!==this.opts.dataLabel&&1===e&&t.forEach((t,i)=>{let s,o,n;s=[].concat(this.opts.chartData.yAxisData.ranges[t.index]),o=s.pop(),n=s.shift();let r=t.data,l=this.getDataPoints(r,o,n,a,h,e);this.drawPointText(l,t)}),this.context.restore(),{xAxisPoints:a,calPoints:r,eachSpacing:h}}}class x extends o{constructor(t,i={}){super(t,i),this.render()}render(){let t=i.fillSeries(this.opts.series,this.opts),s=this.opts.categories;const o=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop();let a=t;this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const n=this.calculateLegendData(a,this.opts.chartData),r=n.area.wholeHeight,l=n.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=r;break;case"bottom":this.opts.area[2]+=r;break;case"left":this.opts.area[3]+=l;break;case"right":this.opts.area[1]+=l}const p=this.calculateYAxisData(t),c=p.yAxisWidth;if(this.opts.yAxis.showTitle){let t=0;for(let i=0;i<this.opts.yAxis.data.length;i++)t=Math.max(t,this.opts.yAxis.data[i].titleFontSize?this.opts.yAxis.data[i].titleFontSize*this.opts.pixelRatio:this.opts.fontSize);this.opts.area[0]+=t}let x=0,d=0;for(let t=0;t<c.length;t++)"left"==c[t].position?(this.opts.area[3]+=d>0?c[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:c[t].width,d+=1):"right"==c[t].position&&(this.opts.area[1]+=x>0?c[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:c[t].width,x+=1);this.opts.chartData.yAxisData=p,this.opts.categories&&this.opts.categories.length?this.opts.chartData.xAxisData=this.getXAxisPoints(this.opts.categories):(this.opts.chartData.xAxisData=this.calculateXAxisData(t),s=this.opts.chartData.xAxisData.rangesFormat);let g=this.calculateCategoriesData(s),u=g.xAxisHeight,f=g.angle;if(e.xAxisHeight=u,this.opts._xAxisTextAngle_=f,this.opts.area[2]+=u,this.opts.chartData.categoriesData=g,this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.animation=new h({timing:this.opts.timing,duration:o,onProcess:i=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.drawYAxisGrid(s),this.drawXAxis(s);let e=this.drawScatterDataPoints(t,i),o=e.xAxisPoints,a=e.calPoints,h=e.eachSpacing;this.opts.chartData.xAxisPoints=o,this.opts.chartData.calPoints=a,this.opts.chartData.eachSpacing=h,this.drawYAxis(),!1!==this.opts.enableMarkLine&&1===i&&this.drawMarkLine(),this.drawLegend(this.opts.chartData),this.drawToolTipBridge(i),this.drawCanvas()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}drawScatterDataPoints(t,i=1){let e=this.opts.chartData.xAxisData,s=e.xAxisPoints,o=e.eachSpacing;this.context.save();let a=0;return this.opts.width,this.opts._scrollDistance_&&0!==this.opts._scrollDistance_&&!0===this.opts.enableScroll&&(this.context.translate(this.opts._scrollDistance_,0),a=-this.opts._scrollDistance_-2*o+this.opts.area[3],this.opts.xAxis.itemCount),t.forEach((t,e)=>{let a,h,n;a=[].concat(this.opts.chartData.yAxisData.ranges[t.index]),h=a.pop(),n=a.shift();let r=t.data,l=this.getDataPoints(r,h,n,s,o,i);this.context.beginPath(),this.setStrokeStyle(t.color),this.setFillStyle(t.color),this.setLineWidth(1*this.opts.pixelRatio);let p=t.pointShape;if("diamond"===p)l.forEach((t,i)=>{null!==t&&(this.context.moveTo(t.x,t.y-4.5),this.context.lineTo(t.x-4.5,t.y),this.context.lineTo(t.x,t.y+4.5),this.context.lineTo(t.x+4.5,t.y),this.context.lineTo(t.x,t.y-4.5))});else if("circle"===p)l.forEach((t,i)=>{null!==t&&(this.context.moveTo(t.x+2.5*this.opts.pixelRatio,t.y),this.context.arc(t.x,t.y,3*this.opts.pixelRatio,0,2*Math.PI,!1))});else if("square"===p)l.forEach((t,i)=>{null!==t&&(this.context.moveTo(t.x-3.5,t.y-3.5),this.context.rect(t.x-3.5,t.y-3.5,7,7))});else{if("triangle"!==p)return;l.forEach((t,i)=>{null!==t&&(this.context.moveTo(t.x,t.y-4.5),this.context.lineTo(t.x-4.5,t.y+4.5),this.context.lineTo(t.x+4.5,t.y+4.5),this.context.lineTo(t.x,t.y-4.5))})}this.context.closePath(),this.context.fill(),this.context.stroke()}),!1!==this.opts.dataLabel&&1===i&&t.forEach((t,e)=>{let a,h,n;a=[].concat(this.opts.chartData.yAxisData.ranges[t.index]),h=a.pop(),n=a.shift();let r=t.data,l=this.getDataPoints(r,h,n,s,o,i);this.drawPointText(l,t)}),this.context.restore(),{xAxisPoints:s,calPoints:[],eachSpacing:o}}}class d extends o{constructor(t,i={}){super(t,i),this.render()}render(){let t=i.fillSeries(this.opts.series,this.opts),s=this.opts.categories;const o=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop();let a=t;this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const n=this.calculateLegendData(a,this.opts.chartData),r=n.area.wholeHeight,l=n.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=r;break;case"bottom":this.opts.area[2]+=r;break;case"left":this.opts.area[3]+=l;break;case"right":this.opts.area[1]+=l}const p=this.calculateYAxisData(t),c=p.yAxisWidth;if(this.opts.yAxis.showTitle){let t=0;for(let i=0;i<this.opts.yAxis.data.length;i++)t=Math.max(t,this.opts.yAxis.data[i].titleFontSize?this.opts.yAxis.data[i].titleFontSize*this.opts.pixelRatio:this.opts.fontSize);this.opts.area[0]+=t}let x=0,d=0;for(let t=0;t<c.length;t++)"left"==c[t].position?(this.opts.area[3]+=d>0?c[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:c[t].width,d+=1):"right"==c[t].position&&(this.opts.area[1]+=x>0?c[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:c[t].width,x+=1);this.opts.chartData.yAxisData=p,this.opts.categories&&this.opts.categories.length?this.opts.chartData.xAxisData=this.getXAxisPoints(this.opts.categories):(this.opts.chartData.xAxisData=this.calculateXAxisData(t),s=this.opts.chartData.xAxisData.rangesFormat);let g=this.calculateCategoriesData(s),u=g.xAxisHeight,f=g.angle;if(e.xAxisHeight=u,this.opts._xAxisTextAngle_=f,this.opts.area[2]+=u,this.opts.chartData.categoriesData=g,this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.animation=new h({timing:this.opts.timing,duration:o,onProcess:i=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.drawYAxisGrid(s),this.drawXAxis(s);let e=this.drawBubbleDataPoints(t,i),o=e.xAxisPoints,a=e.calPoints,h=e.eachSpacing;this.opts.chartData.xAxisPoints=o,this.opts.chartData.calPoints=a,this.opts.chartData.eachSpacing=h,this.drawYAxis(),!1!==this.opts.enableMarkLine&&1===i&&this.drawMarkLine(),this.drawLegend(this.opts.chartData),this.drawToolTipBridge(i),this.drawCanvas()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}drawBubbleDataPoints(t,e=1){let s=i.objectAssign({},{opacity:1,border:2},this.opts.extra.bubble),o=this.opts.chartData.xAxisData,a=o.xAxisPoints,h=o.eachSpacing;this.context.save();let n=0;return this.opts.width,this.opts._scrollDistance_&&0!==this.opts._scrollDistance_&&!0===this.opts.enableScroll&&(this.context.translate(this.opts._scrollDistance_,0),n=-this.opts._scrollDistance_-2*h+this.opts.area[3],this.opts.xAxis.itemCount),t.forEach((t,o)=>{let n,r,l;n=[].concat(this.opts.chartData.yAxisData.ranges[t.index]),r=n.pop(),l=n.shift();let p=t.data,c=this.getDataPoints(p,r,l,a,h,e);this.context.beginPath(),this.setStrokeStyle(t.color),this.setLineWidth(s.border*this.opts.pixelRatio),this.setFillStyle(i.hexToRgb(t.color,s.opacity)),c.forEach((t,i)=>{null!=t&&(this.context.moveTo(t.x+t.r,t.y),this.context.arc(t.x,t.y,t.r*this.opts.pixelRatio,0,2*Math.PI,!1))}),this.context.closePath(),this.context.fill(),this.context.stroke(),!1!==this.opts.dataLabel&&1===e&&c.forEach((i,e)=>{if(null!=i){this.context.beginPath();let e=t.textSize*this.opts.pixelRatio||this.opts.fontSize;this.setFontSize(e),this.setFillStyle(t.textColor||"#FFFFFF"),this.setTextAlign("center"),this.context.fillText(String(i.t),i.x,i.y+e/2),this.context.closePath(),this.context.stroke(),this.setTextAlign("left")}})}),this.context.restore(),{xAxisPoints:a,calPoints:[],eachSpacing:h}}}class g extends o{constructor(t,i={}){super(t,i),this.render()}render(){let t=i.fillSeries(this.opts.series,this.opts);const s=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop();let o=t;this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const a=this.calculateLegendData(o,this.opts.chartData),n=a.area.wholeHeight,r=a.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=n;break;case"bottom":this.opts.area[2]+=n;break;case"left":this.opts.area[3]+=r;break;case"right":this.opts.area[1]+=r}const l=this.calculateYAxisData(t),p=l.yAxisWidth;if(this.opts.yAxis.showTitle){let t=0;for(let i=0;i<this.opts.yAxis.data.length;i++)t=Math.max(t,this.opts.yAxis.data[i].titleFontSize?this.opts.yAxis.data[i].titleFontSize*this.opts.pixelRatio:this.opts.fontSize);this.opts.area[0]+=t}let c=0,x=0;for(let t=0;t<p.length;t++)"left"==p[t].position?(this.opts.area[3]+=x>0?p[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:p[t].width,x+=1):"right"==p[t].position&&(this.opts.area[1]+=c>0?p[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:p[t].width,c+=1);this.opts.chartData.yAxisData=l;{this.opts.chartData.xAxisData=this.getXAxisPoints(this.opts.categories);let t=this.calculateCategoriesData(this.opts.categories),i=t.xAxisHeight,s=t.angle;e.xAxisHeight=i,this.opts._xAxisTextAngle_=s,this.opts.area[2]+=i,this.opts.chartData.categoriesData=t}if(this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.animation=new h({timing:this.opts.timing,duration:s,onProcess:i=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.drawYAxisGrid(this.opts.categories),this.drawXAxis(this.opts.categories);let e=this.drawMixDataPoints(t,i),s=e.xAxisPoints,o=e.calPoints,a=e.eachSpacing;this.opts.chartData.xAxisPoints=s,this.opts.chartData.calPoints=o,this.opts.chartData.eachSpacing=a,this.drawYAxis(),!1!==this.opts.enableMarkLine&&1===i&&this.drawMarkLine(),this.drawLegend(this.opts.chartData),this.drawToolTipBridge(i),this.drawCanvas()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}drawMixDataPoints(t,e=1){var s,o,a;let h=this.opts.chartData.xAxisData,n=h.xAxisPoints,r=h.eachSpacing,l=i.objectAssign({},{width:r/2,barBorderCircle:!1,barBorderRadius:[0,0,0,0],seriesGap:2,linearType:"none",linearOpacity:1,customColor:[],colorStop:0},null===(s=this.opts.extra.mix)||void 0===s?void 0:s.column),p=i.objectAssign({},{opacity:.2,gradient:!1},null===(o=this.opts.extra.mix)||void 0===o?void 0:o.area),c=i.objectAssign({},{width:2},null===(a=this.opts.extra.mix)||void 0===a?void 0:a.line),x=this.opts.height-this.opts.area[2],d=[],g=0,u=0;t.forEach((t,i)=>{"column"==t.type&&(u+=1)}),this.context.save();let f=-2,y=n.length+2,m=0,b=this.opts.width+r;if(this.opts._scrollDistance_&&0!==this.opts._scrollDistance_&&!0===this.opts.enableScroll&&(this.context.translate(this.opts._scrollDistance_,0),f=Math.floor(-this.opts._scrollDistance_/r)-2,y=f+this.opts.xAxis.itemCount+4,m=-this.opts._scrollDistance_-2*r+this.opts.area[3],b=m+(this.opts.xAxis.itemCount+4)*r),l.customColor=i.fillCustomColor(l.linearType,l.customColor,t),t.forEach((t,s)=>{let o,a,h;o=[].concat(this.opts.chartData.yAxisData.ranges[t.index]),a=o.pop(),h=o.shift();let A=t.data,w=this.getDataPoints(A,a,h,n,r,e);if(d.push(w),"column"==t.type){w=this.fixColumnData(w,r,u,g);for(let e=0;e<w.length;e++){let s=w[e];if(null!==s&&e>f&&e<y){let e=s.x-s.width/2;this.opts.height,s.y,this.opts.area[2],this.context.beginPath();let o=s.color||t.color,a=s.color||t.color;if("none"!==l.linearType){let a=this.context.createLinearGradient(e,s.y,e,this.opts.height-this.opts.area[2]);"opacity"==l.linearType?(a.addColorStop(0,i.hexToRgb(o,l.linearOpacity)),a.addColorStop(1,i.hexToRgb(o,1))):(a.addColorStop(0,i.hexToRgb(l.customColor[t.linearIndex],l.linearOpacity)),a.addColorStop(l.colorStop,i.hexToRgb(l.customColor[t.linearIndex],l.linearOpacity)),a.addColorStop(1,i.hexToRgb(o,1))),o=a}if(l.barBorderRadius&&4===l.barBorderRadius.length||l.barBorderCircle){const t=e,i=s.y,o=s.width,a=this.opts.height-this.opts.area[2]-s.y;l.barBorderCircle&&(l.barBorderRadius=[o/2,o/2,0,0]);let h=l.barBorderRadius[0],n=l.barBorderRadius[1],r=l.barBorderRadius[2],p=l.barBorderRadius[3],c=Math.min(o/2,a/2);h=h>c?c:h,n=n>c?c:n,r=r>c?c:r,p=p>c?c:p,h=h<0?0:h,n=n<0?0:n,r=r<0?0:r,p=p<0?0:p,this.context.arc(t+h,i+h,h,-Math.PI,-Math.PI/2),this.context.arc(t+o-n,i+n,n,-Math.PI/2,0),this.context.arc(t+o-r,i+a-r,r,0,Math.PI/2),this.context.arc(t+p,i+a-p,p,Math.PI/2,Math.PI)}else this.context.moveTo(e,s.y),this.context.lineTo(e+s.width,s.y),this.context.lineTo(e+s.width,this.opts.height-this.opts.area[2]),this.context.lineTo(e,this.opts.height-this.opts.area[2]),this.context.lineTo(e,s.y),this.setLineWidth(1),this.setStrokeStyle(a);this.setFillStyle(o),this.context.closePath(),this.context.fill()}}g+=1}if("area"==t.type){let e=this.splitPoints(w,t);for(let s=0;s<e.length;s++){let o=e[s];if(this.context.beginPath(),this.setStrokeStyle(t.color),this.setStrokeStyle(i.hexToRgb(t.color,p.opacity)),p.gradient){let e=this.context.createLinearGradient(0,this.opts.area[0],0,this.opts.height-this.opts.area[2]);e.addColorStop(0,i.hexToRgb(t.color,p.opacity)),e.addColorStop(1,i.hexToRgb("#FFFFFF",.1)),this.setFillStyle(e)}else this.setFillStyle(i.hexToRgb(t.color,p.opacity));if(this.setLineWidth(2*this.opts.pixelRatio),o.length>1){let i=o[0],e=o[o.length-1];this.context.moveTo(i.x,i.y);let s=0;if("curve"===t.style)for(let t=0;t<o.length;t++){let i=o[t];if(0==s&&i.x>m&&(this.context.moveTo(i.x,i.y),s=1),t>0&&i.x>m&&i.x<b){let e=this.createCurveControlPoints(o,t-1);this.context.bezierCurveTo(e.ctrA.x,e.ctrA.y,e.ctrB.x,e.ctrB.y,i.x,i.y)}}else for(let t=0;t<o.length;t++){let i=o[t];0==s&&i.x>m&&(this.context.moveTo(i.x,i.y),s=1),t>0&&i.x>m&&i.x<b&&this.context.lineTo(i.x,i.y)}this.context.lineTo(e.x,x),this.context.lineTo(i.x,x),this.context.lineTo(i.x,i.y)}else{let t=o[0];this.context.moveTo(t.x-r/2,t.y)}this.context.closePath(),this.context.fill()}}if("line"==t.type){this.splitPoints(w,t).forEach((i,e)=>{if("dash"==t.lineType){let i=t.dashLength?t.dashLength:8;i*=this.opts.pixelRatio,this.setLineDash([i,i])}if(this.context.beginPath(),this.setStrokeStyle(t.color),this.setLineWidth(c.width*this.opts.pixelRatio),1===i.length)this.context.moveTo(i[0].x,i[0].y);else{this.context.moveTo(i[0].x,i[0].y);let e=0;if("curve"==t.style)for(let t=0;t<i.length;t++){let s=i[t];if(0==e&&s.x>m&&(this.context.moveTo(s.x,s.y),e=1),t>0&&s.x>m&&s.x<b){let e=this.createCurveControlPoints(i,t-1);this.context.bezierCurveTo(e.ctrA.x,e.ctrA.y,e.ctrB.x,e.ctrB.y,s.x,s.y)}}else for(let t=0;t<i.length;t++){let s=i[t];0==e&&s.x>m&&(this.context.moveTo(s.x,s.y),e=1),t>0&&s.x>m&&s.x<b&&this.context.lineTo(s.x,s.y)}this.context.moveTo(i[0].x,i[0].y)}this.context.stroke(),this.setLineDash([])})}"point"==t.type&&(t.addPoint=!0),1==t.addPoint&&"column"!==t.type&&this.drawPointShape(w,t.color,t.pointShape)}),!1!==this.opts.dataLabel&&1===e){let i=0;t.forEach((t,s)=>{let o,a,h;o=[].concat(this.opts.chartData.yAxisData.ranges[t.index]),a=o.pop(),h=o.shift();let l=t.data,p=this.getDataPoints(l,a,h,n,r,e);"column"!==t.type?this.drawPointText(p,t):(p=this.fixColumnData(p,r,u,i),this.drawPointText(p,t),i+=1)})}return this.context.restore(),{xAxisPoints:n,calPoints:d,eachSpacing:r}}}class u extends o{drawPieOrRingDataPoints(t,s=1){let o=i.objectAssign({},{activeOpacity:.5,activeRadius:10,offsetAngle:0,labelWidth:15,ringWidth:30,customRadius:0,border:!1,borderWidth:2,borderColor:"#FFFFFF",centerColor:"#FFFFFF",linearType:"none",customColor:[]},"pie"==this.opts.type?this.opts.extra.pie:this.opts.extra.ring),a={x:this.opts.area[3]+(this.opts.width-this.opts.area[1]-this.opts.area[3])/2,y:this.opts.area[0]+(this.opts.height-this.opts.area[0]-this.opts.area[2])/2};0==e.pieChartLinePadding&&(e.pieChartLinePadding=o.activeRadius*this.opts.pixelRatio);let h=Math.min((this.opts.width-this.opts.area[1]-this.opts.area[3])/2-e.pieChartLinePadding-e.pieChartTextPadding-this.opts._pieTextMaxLength_,(this.opts.height-this.opts.area[0]-this.opts.area[2])/2-e.pieChartLinePadding-e.pieChartTextPadding);h=h<10?10:h,o.customRadius>0&&(h=o.customRadius*this.opts.pixelRatio),t=this.getPieDataPoints(t,h,s);let n=o.activeRadius*this.opts.pixelRatio;if(o.customColor=i.fillCustomColor(o.linearType,o.customColor,t),(t=t.map(t=>(t._start_+=o.offsetAngle*Math.PI/180,t))).forEach((t,e)=>{if(this.opts.tooltip&&this.opts.tooltip.index==e&&(this.context.beginPath(),this.setFillStyle(i.hexToRgb(t.color,o.activeOpacity||.5)),this.context.moveTo(a.x,a.y),this.context.arc(a.x,a.y,t._radius_+n,t._start_,t._start_+2*t._proportion_*Math.PI),this.context.closePath(),this.context.fill()),0==t.data)return;this.context.beginPath(),this.setLineWidth(o.borderWidth*this.opts.pixelRatio),this.context.lineJoin="round",this.setStrokeStyle(o.borderColor);let s=t.color;if("custom"==o.linearType){let e;e=this.context.createCircularGradient?this.context.createCircularGradient(a.x,a.y,t._radius_):this.context.createRadialGradient(a.x,a.y,0,a.x,a.y,t._radius_),e.addColorStop(0,i.hexToRgb(o.customColor[t.linearIndex],1)),e.addColorStop(1,i.hexToRgb(t.color,1)),s=e}this.setFillStyle(s),this.context.moveTo(a.x,a.y),this.context.arc(a.x,a.y,t._radius_,t._start_,t._start_+2*t._proportion_*Math.PI),this.context.closePath(),this.context.fill(),1==o.border&&this.context.stroke()}),"ring"===this.opts.type){let t=.6*h;"number"==typeof o.ringWidth&&o.ringWidth>0&&(t=Math.max(0,h-o.ringWidth*this.opts.pixelRatio)),this.context.beginPath(),this.setFillStyle(o.centerColor),this.context.moveTo(a.x,a.y),this.context.arc(a.x,a.y,t,0,2*Math.PI),this.context.closePath(),this.context.fill()}return!1!==this.opts.dataLabel&&1===s&&this.drawPieText(t,h,a),1===s&&"ring"===this.opts.type&&this.drawRingTitle(a),{center:a,radius:h,series:t}}drawPieText(t,s,o){let a=e.pieChartLinePadding,h=[],n={start:{x:0,y:0},end:{x:0,y:0},width:0,height:0},r=t.map((t,e)=>{let s=t.formatter?t.formatter(t.value,e,t,this.opts):i.toFixed(100*t._proportion_.toFixed(4))+"%";s=t.labelText?t.labelText:s;let o=2*Math.PI-(t._start_+2*Math.PI*t._proportion_/2);return t._rose_proportion_&&(o=2*Math.PI-(t._start_+2*Math.PI*t._rose_proportion_/2)),{arc:o,text:s,color:t.color,radius:t._radius_,textColor:t.textColor,textSize:t.textSize,labelShow:t.labelShow}});for(let t=0;t<r.length;t++){let s=r[t],o=Math.cos(s.arc)*(s.radius+a),l=Math.sin(s.arc)*(s.radius+a),p=Math.cos(s.arc)*s.radius,c=Math.sin(s.arc)*s.radius,x=o>=0?o+e.pieChartTextPadding:o-e.pieChartTextPadding,d=l,g=this.measureText(s.text,s.textSize*this.opts.pixelRatio||this.opts.fontSize),u=d;n&&i.isSameXCoordinateArea(n.start,{x:x,y:0})&&(u=x>0?Math.min(d,n.start.y):o<0||d>0?Math.max(d,n.start.y):Math.min(d,n.start.y)),x<0&&(x-=g);let f={lineStart:{x:p,y:c},lineEnd:{x:o,y:l},start:{x:x,y:u},end:{x:0,y:0},width:g,height:this.opts.fontSize,text:s.text,color:s.color,textColor:s.textColor,textSize:s.textSize};n=this.avoidCollision(f,n),h.push(n)}for(let t=0;t<h.length;t++){if(!1===r[t].labelShow)continue;let e=h[t],s=i.convertCoordinateOrigin(e.lineStart.x,e.lineStart.y,o),a=i.convertCoordinateOrigin(e.lineEnd.x,e.lineEnd.y,o),n=i.convertCoordinateOrigin(e.start.x,e.start.y,o);this.setLineWidth(1*this.opts.pixelRatio),this.setFontSize(e.textSize*this.opts.pixelRatio||this.opts.fontSize),this.context.beginPath(),this.setStrokeStyle(e.color),this.setFillStyle(e.color),this.context.moveTo(s.x,s.y);let l=e.start.x<0?n.x+e.width:n.x,p=e.start.x<0?n.x-5:n.x+5;this.context.quadraticCurveTo(a.x,a.y,l,n.y),this.context.moveTo(s.x,s.y),this.context.stroke(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(n.x+e.width,n.y),this.context.arc(l,n.y,2*this.opts.pixelRatio,0,2*Math.PI),this.context.closePath(),this.context.fill(),this.context.beginPath(),this.setFontSize(e.textSize*this.opts.pixelRatio||this.opts.fontSize),this.setFillStyle(e.textColor||this.opts.fontColor),this.context.fillText(e.text,p,n.y+3),this.context.closePath(),this.context.stroke(),this.context.closePath()}}avoidCollision(t,e){if(!e)return t;let s=0;const o=e.start.x+e.width/2,a=e.start.y-e.height/2,h=t.start.x+t.width/2>o?1:-1,n=t.start.y-t.height/2>a?1:-1;for(;i.isCollision(t,e)&&s<1e3;)t.start.x+=1*h,t.start.y+=1*n,s++;return s>=1e3&&console.warn("####达到最大尝试次数，可能无法完全避免碰撞"),t}drawRingTitle(t){var i,s,o,a,h,n,r,l,p,c;let x=(null===(i=this.opts.title)||void 0===i?void 0:i.fontSize)||e.titleFontSize,d=(null===(s=this.opts.subtitle)||void 0===s?void 0:s.fontSize)||e.subtitleFontSize,g=(null===(o=this.opts.title)||void 0===o?void 0:o.value)||"",u=(null===(a=this.opts.subtitle)||void 0===a?void 0:a.value)||"",f=(null===(h=this.opts.title)||void 0===h?void 0:h.color)||this.opts.fontColor,y=(null===(n=this.opts.subtitle)||void 0===n?void 0:n.color)||this.opts.fontColor,m=g?x:0,b=u?d:0;if(u){let i=this.measureText(u,d*this.opts.pixelRatio),e=t.x-i/2+((null===(r=this.opts.subtitle)||void 0===r?void 0:r.offsetX)||0)*this.opts.pixelRatio,s=t.y+d*this.opts.pixelRatio/2+((null===(l=this.opts.subtitle)||void 0===l?void 0:l.offsetY)||0)*this.opts.pixelRatio;g&&(s+=(m*this.opts.pixelRatio+5)/2),this.context.beginPath(),this.setFontSize(d*this.opts.pixelRatio),this.setFillStyle(y),this.context.fillText(u,e,s),this.context.closePath(),this.context.stroke()}if(g){let i=this.measureText(g,x*this.opts.pixelRatio),e=t.x-i/2+((null===(p=this.opts.title)||void 0===p?void 0:p.offsetX)||0),s=t.y+x*this.opts.pixelRatio/2+((null===(c=this.opts.title)||void 0===c?void 0:c.offsetY)||0)*this.opts.pixelRatio;u&&(s-=(b*this.opts.pixelRatio+5)/2),this.context.beginPath(),this.setFontSize(x*this.opts.pixelRatio),this.setFillStyle(f),this.context.fillText(g,e,s),this.context.closePath(),this.context.stroke()}}getPieTextMaxLength(t){t=this.getPieDataPoints(t);let e=0;for(let s=0;s<t.length;s++){let o=t[s],a=o.formatter?o.formatter(+o._proportion_.toFixed(2),s,o):i.toFixed(100*o._proportion_)+"%";e=Math.max(e,this.measureText(a,o.textSize*this.opts.pixelRatio||this.opts.fontSize))}return e}}class f extends u{constructor(t,i={}){super(t,i),this.render()}render(){let t=this.opts.series;t=this.fixPieSeries(t),t=i.fillSeries(t,this.opts);const e=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop();let s=t;this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const o=this.calculateLegendData(s,this.opts.chartData),a=o.area.wholeHeight,n=o.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=a;break;case"bottom":this.opts.area[2]+=a;break;case"left":this.opts.area[3]+=n;break;case"right":this.opts.area[1]+=n}if(this.opts.chartData.yAxisData={},this.opts.chartData.xAxisData={},this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.opts._pieTextMaxLength_=!1===this.opts.dataLabel?0:this.getPieTextMaxLength(s),this.animation=new h({timing:this.opts.timing,duration:e,onProcess:i=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.opts.chartData.pieData=this.drawPieOrRingDataPoints(t,i),this.drawLegend(this.opts.chartData),this.drawToolTipBridge(i),this.drawCanvas()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}}class y extends u{constructor(t,i={}){super(t,i),this.render()}render(){let t=this.opts.series;t=this.fixPieSeries(t),t=i.fillSeries(t,this.opts);const e=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop();let s=t;this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const o=this.calculateLegendData(s,this.opts.chartData),a=o.area.wholeHeight,n=o.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=a;break;case"bottom":this.opts.area[2]+=a;break;case"left":this.opts.area[3]+=n;break;case"right":this.opts.area[1]+=n}if(this.opts.chartData.yAxisData={},this.opts.chartData.xAxisData={},this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.opts._pieTextMaxLength_=!1===this.opts.dataLabel?0:this.getPieTextMaxLength(s),this.animation=new h({timing:this.opts.timing,duration:e,onProcess:i=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.opts.chartData.pieData=this.drawPieOrRingDataPoints(t,i),this.drawLegend(this.opts.chartData),this.drawToolTipBridge(i),this.drawCanvas()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}}class m extends u{constructor(t,i={}){super(t,i),this.render()}render(){let t=this.opts.series;t=this.fixPieSeries(t),t=i.fillSeries(t,this.opts);const e=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop();let s=t;this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const o=this.calculateLegendData(s,this.opts.chartData),a=o.area.wholeHeight,n=o.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=a;break;case"bottom":this.opts.area[2]+=a;break;case"left":this.opts.area[3]+=n;break;case"right":this.opts.area[1]+=n}if(this.opts.chartData.yAxisData={},this.opts.chartData.xAxisData={},this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.opts._pieTextMaxLength_=!1===this.opts.dataLabel?0:this.getPieTextMaxLength(s),this.animation=new h({timing:this.opts.timing,duration:e,onProcess:i=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.opts.chartData.pieData=this.drawRoseDataPoints(t,i),this.drawLegend(this.opts.chartData),this.drawToolTipBridge(i),this.drawCanvas()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}drawRoseDataPoints(t,s=1){let o=i.objectAssign({},{type:"area",activeOpacity:.5,activeRadius:10,offsetAngle:0,labelWidth:15,border:!1,borderWidth:2,borderColor:"#FFFFFF",linearType:"none",customColor:[]},this.opts.extra.rose);0==e.pieChartLinePadding&&(e.pieChartLinePadding=o.activeRadius*this.opts.pixelRatio);let a={x:this.opts.area[3]+(this.opts.width-this.opts.area[1]-this.opts.area[3])/2,y:this.opts.area[0]+(this.opts.height-this.opts.area[0]-this.opts.area[2])/2},h=Math.min((this.opts.width-this.opts.area[1]-this.opts.area[3])/2-e.pieChartLinePadding-e.pieChartTextPadding-this.opts._pieTextMaxLength_,(this.opts.height-this.opts.area[0]-this.opts.area[2])/2-e.pieChartLinePadding-e.pieChartTextPadding);h=h<10?10:h;let n=o.minRadius||.5*h;h<n&&(h=n+10),t=this.getRoseDataPoints(t,o.type,n,h,s);let r=o.activeRadius*this.opts.pixelRatio;return o.customColor=i.fillCustomColor(o.linearType,o.customColor,t),(t=t.map(t=>(t._start_+=(o.offsetAngle||0)*Math.PI/180,t))).forEach((t,e)=>{this.opts.tooltip&&this.opts.tooltip.index==e&&(this.context.beginPath(),this.setFillStyle(i.hexToRgb(t.color,o.activeOpacity||.5)),this.context.moveTo(a.x,a.y),this.context.arc(a.x,a.y,r+t._radius_,t._start_,t._start_+2*t._rose_proportion_*Math.PI),this.context.closePath(),this.context.fill()),this.context.beginPath(),this.setLineWidth(o.borderWidth*this.opts.pixelRatio),this.context.lineJoin="round",this.setStrokeStyle(o.borderColor);let s=t.color;if("custom"==o.linearType){let e;e=this.context.createCircularGradient?this.context.createCircularGradient(a.x,a.y,t._radius_):this.context.createRadialGradient(a.x,a.y,0,a.x,a.y,t._radius_),e.addColorStop(0,i.hexToRgb(o.customColor[t.linearIndex],1)),e.addColorStop(1,i.hexToRgb(t.color,1)),s=e}this.setFillStyle(s),this.context.moveTo(a.x,a.y),this.context.arc(a.x,a.y,t._radius_,t._start_,t._start_+2*t._rose_proportion_*Math.PI),this.context.closePath(),this.context.fill(),1==o.border&&this.context.stroke()}),!1!==this.opts.dataLabel&&1===s&&this.drawPieText(t,h,a),{center:a,radius:h,series:t}}}class b extends o{constructor(t,i={}){super(t,i),this.render()}render(){let t=i.fillSeries(this.opts.series,this.opts);const e=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop();let s=t;this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const o=this.calculateLegendData(s,this.opts.chartData),a=o.area.wholeHeight,n=o.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=a;break;case"bottom":this.opts.area[2]+=a;break;case"left":this.opts.area[3]+=n;break;case"right":this.opts.area[1]+=n}if(this.opts.chartData.yAxisData={},this.opts.chartData.xAxisData={},this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.animation=new h({timing:this.opts.timing,duration:e,onProcess:i=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.opts.chartData.radarData=this.drawRadarDataPoints(t,i),this.drawLegend(this.opts.chartData),this.drawToolTipBridge(i),this.drawCanvas()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}drawRadarDataPoints(t,s=1){let o=i.objectAssign({},{gridColor:"#cccccc",gridType:"radar",gridEval:1,axisLabel:!1,axisLabelTofix:0,labelShow:!0,labelColor:"#666666",labelPointShow:!1,labelPointRadius:3,labelPointColor:"#cccccc",opacity:.2,gridCount:3,border:!1,borderWidth:2,linearType:"none",customColor:[]},this.opts.extra.radar),a=this.getRadarCoordinateSeries(this.opts.categories.length),h={x:this.opts.area[3]+(this.opts.width-this.opts.area[1]-this.opts.area[3])/2,y:this.opts.area[0]+(this.opts.height-this.opts.area[0]-this.opts.area[2])/2},n=(this.opts.width-this.opts.area[1]-this.opts.area[3])/2,r=(this.opts.height-this.opts.area[0]-this.opts.area[2])/2,l=Math.min(n-(this.getMaxTextListLength(this.opts.categories,this.opts.fontSize)+e.radarLabelTextMargin),r-e.radarLabelTextMargin);l-=e.radarLabelTextMargin*this.opts.pixelRatio,l=l<10?10:l,l=o.radius?o.radius:l,this.context.beginPath(),this.setLineWidth(1*this.opts.pixelRatio),this.setStrokeStyle(o.gridColor),a.forEach((t,e)=>{let s=i.convertCoordinateOrigin(l*Math.cos(t),l*Math.sin(t),h);this.context.moveTo(h.x,h.y),e%o.gridEval==0&&this.context.lineTo(s.x,s.y)}),this.context.stroke(),this.context.closePath();const p=t=>{let e={x:0,y:0};if(this.context.beginPath(),this.setLineWidth(1*this.opts.pixelRatio),this.setStrokeStyle(o.gridColor),"radar"==o.gridType)a.forEach((s,a)=>{let n=i.convertCoordinateOrigin(l/o.gridCount*t*Math.cos(s),l/o.gridCount*t*Math.sin(s),h);0===a?(e=n,this.context.moveTo(n.x,n.y)):this.context.lineTo(n.x,n.y)}),this.context.lineTo(e.x,e.y);else{let e=i.convertCoordinateOrigin(l/o.gridCount*t*Math.cos(1.5),l/o.gridCount*t*Math.sin(1.5),h);this.context.arc(h.x,h.y,h.y-e.y,0,2*Math.PI,!1)}this.context.stroke(),this.context.closePath()};for(let t=1;t<=o.gridCount;t++)p(t);o.customColor=i.fillCustomColor(o.linearType,o.customColor,t);let c=this.getRadarDataPoints(a,h,l,t,s);if(c.forEach((e,s)=>{this.context.beginPath(),this.setLineWidth(o.borderWidth*this.opts.pixelRatio),this.setStrokeStyle(e.color);let a=i.hexToRgb(e.color,o.opacity);if("custom"==o.linearType){let n;n=this.context.createCircularGradient?this.context.createCircularGradient(h.x,h.y,l):this.context.createRadialGradient(h.x,h.y,0,h.x,h.y,l),n.addColorStop(0,i.hexToRgb(o.customColor[t[s].linearIndex],o.opacity)),n.addColorStop(1,i.hexToRgb(e.color,o.opacity)),a=n}if(this.setFillStyle(a),e.data.forEach((t,i)=>{0===i?this.context.moveTo(t.position.x,t.position.y):this.context.lineTo(t.position.x,t.position.y)}),this.context.closePath(),this.context.fill(),!0===o.border&&this.context.stroke(),this.context.closePath(),!1!==this.opts.dataPointShape){let t=e.data.map(t=>t.position);this.drawPointShape(t,e.color,e.pointShape)}}),!0===o.axisLabel){const e=Math.max(o.max,Math.max(...i.dataCombine(t))),s=l/o.gridCount,a=this.opts.fontSize*this.opts.pixelRatio;this.setFontSize(a),this.setFillStyle(this.opts.fontColor),this.setTextAlign("left");for(let t=0;t<o.gridCount+1;t++){let i=t*e/o.gridCount;i=i.toFixed(o.axisLabelTofix),this.context.fillText(String(i),h.x+3*this.opts.pixelRatio,h.y-t*s+a/2)}}return this.drawRadarLabel(a,l,h),!1!==this.opts.dataLabel&&1===s&&(c.forEach((t,i)=>{this.context.beginPath();let e=t.textSize?t.textSize*this.opts.pixelRatio:this.opts.fontSize;this.setFontSize(e),this.setFillStyle(t.textColor||this.opts.fontColor),t.data.forEach((t,i)=>{Math.abs(t.position.x-h.x)<2?t.position.y<h.y?(this.setTextAlign("center"),this.context.fillText(String(t.value),t.position.x,t.position.y-4)):(this.setTextAlign("center"),this.context.fillText(String(t.value),t.position.x,t.position.y+e+2)):t.position.x<h.x?(this.setTextAlign("right"),this.context.fillText(String(t.value),t.position.x-4,t.position.y+e/2-2)):(this.setTextAlign("left"),this.context.fillText(String(t.value),t.position.x+4,t.position.y+e/2-2))}),this.context.closePath(),this.context.stroke()}),this.setTextAlign("left")),{center:h,radius:l,angleList:a}}getRadarCoordinateSeries(t){let i=2*Math.PI/t,e=[];for(let s=0;s<t;s++)e.push(i*s);return e.map(t=>-1*t+Math.PI/2)}getMaxTextListLength(t,i){let e=t.map(t=>this.measureText(t,i));return Math.max(...e)}getRadarDataPoints(t,e,s,o,a=1){let h=this.opts.extra.radar||{};h.max=h.max||0;let n=Math.max(h.max,Math.max(...i.dataCombine(o))),r=[];for(let h=0;h<o.length;h++){let l=o[h],p={color:l.color,legendShape:l.legendShape,pointShape:l.pointShape,data:[]};l.data.forEach((o,h)=>{let r={angle:t[h],proportion:o/n,value:o,position:{x:0,y:0}};r.position=i.convertCoordinateOrigin(s*r.proportion*a*Math.cos(r.angle),s*r.proportion*a*Math.sin(r.angle),e),p.data.push(r)}),r.push(p)}return r}drawRadarLabel(t,s,o){let a=this.opts.extra.radar||{};t.forEach((t,h)=>{if(!0===a.labelPointShow&&""!==this.opts.categories[h]){let e={x:s*Math.cos(t),y:s*Math.sin(t)},h=i.convertCoordinateOrigin(e.x,e.y,o);this.setFillStyle(a.labelPointColor),this.context.beginPath(),this.context.arc(h.x,h.y,a.labelPointRadius*this.opts.pixelRatio,0,2*Math.PI,!1),this.context.closePath(),this.context.fill()}if(!0===a.labelShow){let n={x:(s+e.radarLabelTextMargin*this.opts.pixelRatio)*Math.cos(t),y:(s+e.radarLabelTextMargin*this.opts.pixelRatio)*Math.sin(t)},r=i.convertCoordinateOrigin(n.x,n.y,o),l=r.x,p=r.y;const c=this.opts.categories;i.approximatelyEqual(n.x,0)?l-=this.measureText(c[h]||"",this.opts.fontSize)/2:n.x<0&&(l-=this.measureText(c[h]||"",this.opts.fontSize)),this.context.beginPath(),this.setFontSize(this.opts.fontSize),this.setFillStyle(a.labelColor||this.opts.fontColor),this.context.fillText(c[h]||"",l,p+this.opts.fontSize/2),this.context.closePath(),this.context.stroke()}})}}class A extends o{constructor(t,i={}){super(t,i),this.render()}render(){let t=i.fillSeries(this.opts.series,this.opts);const e=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop();let s=t;this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const o=this.calculateLegendData(s,this.opts.chartData),a=o.area.wholeHeight,n=o.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=a;break;case"bottom":this.opts.area[2]+=a;break;case"left":this.opts.area[3]+=n;break;case"right":this.opts.area[1]+=n}if(this.opts.chartData.yAxisData={},this.opts.chartData.xAxisData={},this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.animation=new h({timing:this.opts.timing,duration:e,onProcess:i=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.drawWordCloudDataPoints(t,i),this.drawCanvas()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}drawWordCloudDataPoints(t,e=1){let s=i.objectAssign({},{type:"normal"},this.opts.extra.word);this.opts.chartData.wordCloudData||(this.opts.chartData.wordCloudData=this.getWordCloudPoint(t,s.type)),this.context.beginPath(),this.setFillStyle(this.opts.background),this.context.rect(0,0,this.opts.width,this.opts.height),this.context.fill(),this.context.save();let o=this.opts.chartData.wordCloudData;this.context.translate(this.opts.width/2,this.opts.height/2);for(let t=0;t<o.length;t++){this.context.save(),o[t].rotate&&this.context.rotate(90*Math.PI/180);let i=o[t].name,s=o[t].textSize*this.opts.pixelRatio,a=this.measureText(i,s);this.context.beginPath(),this.setStrokeStyle(o[t].color),this.setFillStyle(o[t].color),this.setFontSize(s),o[t].rotate?o[t].areav[0]>0&&(this.opts.tooltip&&this.opts.tooltip.index==t?this.context.strokeText(i,(o[t].areav[0]+5-this.opts.width/2)*e-a*(1-e)/2,(o[t].areav[1]+5+s-this.opts.height/2)*e):this.context.fillText(i,(o[t].areav[0]+5-this.opts.width/2)*e-a*(1-e)/2,(o[t].areav[1]+5+s-this.opts.height/2)*e)):o[t].area[0]>0&&(this.opts.tooltip&&this.opts.tooltip.index==t?this.context.strokeText(i,(o[t].area[0]+5-this.opts.width/2)*e-a*(1-e)/2,(o[t].area[1]+5+s-this.opts.height/2)*e):this.context.fillText(i,(o[t].area[0]+5-this.opts.width/2)*e-a*(1-e)/2,(o[t].area[1]+5+s-this.opts.height/2)*e)),this.context.stroke(),this.context.restore()}this.context.restore()}getWordCloudPoint(t,i){let e=this.opts.series;if("normal"==i)for(let t=0;t<e.length;t++){let i,s,o,a=e[t].name||"",h=(null==e[t].textSize?20:e[t].textSize)*this.opts.pixelRatio,n=this.measureText(a,h),r=0;for(;;){if(r++,i=this.normalInt(-this.opts.width/2,this.opts.width/2,5)-n/2,s=this.normalInt(-this.opts.height/2,this.opts.height/2,5)+h/2,o=[i-5+this.opts.width/2,s-5-h+this.opts.height/2,i+n+5+this.opts.width/2,s+5+this.opts.height/2],!this.collisionNew(o,e,this.opts.width,this.opts.height))break;if(1e3==r){o=[-100,-100,-100,-100];break}}e[t].area=o}else if("vertical"==i){const t=()=>Math.random()>.7;for(let i=0;i<e.length;i++){let s,o,a=e[i].name||"",h=(null==e[i].textSize?20:e[i].textSize)*this.opts.pixelRatio,n=this.measureText(a,h),r=t(),l=[],p=[],c=0;for(;;){let t;if(c++,r?(s=this.normalInt(-this.opts.width/2,this.opts.width/2,5)-n/2,o=this.normalInt(-this.opts.height/2,this.opts.height/2,5)+h/2,l=[o-5-n+this.opts.width/2,-s-5+this.opts.height/2,o+5+this.opts.width/2,-s+h+5+this.opts.height/2],p=[this.opts.width-(this.opts.width/2-this.opts.height/2)-(-s+h+5+this.opts.height/2)-5,this.opts.height/2-this.opts.width/2+(o-5-n+this.opts.width/2)-5,this.opts.width-(this.opts.width/2-this.opts.height/2)-(-s+h+5+this.opts.height/2)+h,this.opts.height/2-this.opts.width/2+(o-5-n+this.opts.width/2)+n+5],t=this.collisionNew(p,e,this.opts.height,this.opts.width)):(s=this.normalInt(-this.opts.width/2,this.opts.width/2,5)-n/2,o=this.normalInt(-this.opts.height/2,this.opts.height/2,5)+h/2,l=[s-5+this.opts.width/2,o-5-h+this.opts.height/2,s+n+5+this.opts.width/2,o+5+this.opts.height/2],t=this.collisionNew(l,e,this.opts.width,this.opts.height)),!t)break;if(1e3==c){l=[-1e3,-1e3,-1e3,-1e3];break}}r?(e[i].area=p,e[i].areav=l):e[i].area=l,e[i].rotate=r}}return e}normalInt(t,i,e){e=0==e?1:e;let s=[];for(let t=0;t<e;t++)s[t]=Math.random();return Math.floor(s.reduce((t,i)=>t+i)/e*(i-t))+t}collisionNew(t,i,e,s){let o=!1;for(let a=0;a<i.length;a++)if(i[a].area){if(!(t[3]<i[a].area[1]||t[0]>i[a].area[2]||t[1]>i[a].area[3]||t[2]<i[a].area[0])){o=!0;break}if(t[0]<0||t[1]<0||t[2]>e||t[3]>s){o=!0;break}o=!1}return o}}class w extends u{constructor(t,i={}){super(t,i),this.render()}render(){let t=i.fillSeries(this.opts.series,this.opts);const e=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop();let s=t;this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const o=this.calculateLegendData(s,this.opts.chartData),a=o.area.wholeHeight,n=o.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=a;break;case"bottom":this.opts.area[2]+=a;break;case"left":this.opts.area[3]+=n;break;case"right":this.opts.area[1]+=n}if(this.opts.chartData.yAxisData={},this.opts.chartData.xAxisData={},this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.animation=new h({timing:this.opts.timing,duration:e,onProcess:i=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.opts.chartData.arcbarData=this.drawArcBarDataPoints(t,i),this.drawCanvas()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}drawArcBarDataPoints(t,e=1){let s=i.objectAssign({},{startAngle:.75,endAngle:.25,type:"default",direction:"cw",lineCap:"round",width:12,gap:2,linearType:"none",customColor:[],backgroundColor:"#E9E9E9"},this.opts.extra.arcbar);t=this.getArcBarDataPoints(t,s,e);let o={x:this.opts.width/2,y:this.opts.height/2};(s.centerX||s.centerY)&&(o={x:s.centerX?s.centerX:this.opts.width/2,y:s.centerY?s.centerY:this.opts.height/2});let a=0;s.radius?a=s.radius:(a=Math.min(o.x,o.y),a-=5*this.opts.pixelRatio,a-=s.width/2),a=a<10?10:a,s.customColor=i.fillCustomColor(s.linearType,s.customColor,t);for(let e=0;e<t.length;e++){let h=t[e];this.setLineWidth(s.width*this.opts.pixelRatio),this.setStrokeStyle(s.backgroundColor),this.setLineCap(s.lineCap),this.context.beginPath(),"default"==s.type?this.context.arc(o.x,o.y,a-(s.width*this.opts.pixelRatio+s.gap*this.opts.pixelRatio)*e,s.startAngle*Math.PI,s.endAngle*Math.PI,"ccw"==s.direction):this.context.arc(o.x,o.y,a-(s.width*this.opts.pixelRatio+s.gap*this.opts.pixelRatio)*e,0,2*Math.PI,"ccw"==s.direction),this.context.stroke();let n=h.color;if("custom"==s.linearType){let t=this.context.createLinearGradient(o.x-a,o.y,o.x+a,o.y);t.addColorStop(1,i.hexToRgb(s.customColor[h.linearIndex],1)),t.addColorStop(0,i.hexToRgb(h.color,1)),n=t}this.setLineWidth(s.width*this.opts.pixelRatio),this.setStrokeStyle(n),this.setLineCap(s.lineCap),this.context.beginPath(),this.context.arc(o.x,o.y,a-(s.width*this.opts.pixelRatio+s.gap*this.opts.pixelRatio)*e,s.startAngle*Math.PI,h._proportion_*Math.PI,"ccw"==s.direction),this.context.stroke()}return this.drawRingTitle(o),{center:o,radius:a,series:t}}getArcBarDataPoints(t,i,e=1){1==e&&(e=.999999);for(let s=0;s<t.length;s++){let o=t[s];o.data=null===o.data?0:o.data;let a=0;a="circle"==i.type?2:"ccw"==i.direction?i.startAngle<i.endAngle?2+i.startAngle-i.endAngle:i.startAngle-i.endAngle:i.endAngle<i.startAngle?2+i.endAngle-i.startAngle:i.startAngle-i.endAngle,o._proportion_=a*o.data*e+i.startAngle,"ccw"==i.direction&&(o._proportion_=i.startAngle-a*o.data*e),o._proportion_>=2&&(o._proportion_=o._proportion_%2)}return t}}class S extends u{constructor(t,i={}){super(t,i),this.render()}render(){let t=i.fillSeries(this.opts.series,this.opts);const e=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop();let s=t;this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const o=this.calculateLegendData(s,this.opts.chartData),a=o.area.wholeHeight,n=o.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=a;break;case"bottom":this.opts.area[2]+=a;break;case"left":this.opts.area[3]+=n;break;case"right":this.opts.area[1]+=n}if(this.opts.chartData.yAxisData={},this.opts.chartData.xAxisData={},this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.animation=new h({timing:this.opts.timing,duration:e,onProcess:i=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.opts.chartData.gaugeData=this.drawGaugeDataPoints(this.opts.categories,t,i),this.drawCanvas()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}drawGaugeDataPoints(t,e,s=1){let o=i.objectAssign({},{type:"default",startAngle:.75,endAngle:.25,width:15,labelOffset:13,splitLine:{fixRadius:0,splitNumber:10,width:15,color:"#FFFFFF",childNumber:5,childWidth:5},pointer:{width:15,color:"auto"},labelColor:this.opts.fontColor},this.opts.extra.gauge);null==o.oldAngle&&(o.oldAngle=o.startAngle),null==o.oldData&&(o.oldData=0),t=this.getGaugeAxisPoints(t,o.startAngle,o.endAngle);let a={x:this.opts.width/2,y:this.opts.height/2},h=Math.min(a.x,a.y);h-=5*this.opts.pixelRatio,h-=o.width/2,h=h<10?10:h;let n=h-o.width,r=0;if("progress"==o.type){let t=h-3*o.width;this.context.beginPath();let l=this.context.createLinearGradient(a.x,a.y-t,a.x,a.y+t);l.addColorStop(0,i.hexToRgb(e[0].color,.3)),l.addColorStop(1,i.hexToRgb("#FFFFFF",.1)),this.setFillStyle(l),this.context.arc(a.x,a.y,t,0,2*Math.PI,!1),this.context.fill(),this.setLineWidth(o.width),this.setStrokeStyle(i.hexToRgb(e[0].color,.3)),this.setLineCap("round"),this.context.beginPath(),this.context.arc(a.x,a.y,n,o.startAngle*Math.PI,o.endAngle*Math.PI,!1),this.context.stroke(),r=o.endAngle<o.startAngle?2+o.endAngle-o.startAngle:o.startAngle-o.endAngle,o.splitLine.splitNumber;let p=r/o.splitLine.splitNumber/o.splitLine.childNumber,c=-h-.5*o.width-o.splitLine.fixRadius,x=-h-o.width-o.splitLine.fixRadius+o.splitLine.width;this.context.save(),this.context.translate(a.x,a.y),this.context.rotate((o.startAngle-1)*Math.PI);let d=o.splitLine.splitNumber*o.splitLine.childNumber+1,g=e[0].data*s;for(let t=0;t<d;t++)this.context.beginPath(),g>t/d?this.setStrokeStyle(i.hexToRgb(e[0].color,1)):this.setStrokeStyle(i.hexToRgb(e[0].color,.3)),this.setLineWidth(3*this.opts.pixelRatio),this.context.moveTo(c,0),this.context.lineTo(x,0),this.context.stroke(),this.context.rotate(p*Math.PI);this.context.restore(),e=this.getGaugeArcBarDataPoints(e,o,s),this.setLineWidth(o.width),this.setStrokeStyle(e[0].color),this.setLineCap("round"),this.context.beginPath(),this.context.arc(a.x,a.y,n,o.startAngle*Math.PI,e[0]._proportion_*Math.PI,!1),this.context.stroke();let u=h-2.5*o.width;this.context.save(),this.context.translate(a.x,a.y),this.context.rotate((e[0]._proportion_-1)*Math.PI),this.context.beginPath(),this.setLineWidth(o.width/3);let f=this.context.createLinearGradient(0,.6*-u,0,.6*u);f.addColorStop(0,i.hexToRgb("#FFFFFF",0)),f.addColorStop(.5,i.hexToRgb(e[0].color,1)),f.addColorStop(1,i.hexToRgb("#FFFFFF",0)),this.setStrokeStyle(f),this.context.arc(0,0,u,.85*Math.PI,1.15*Math.PI,!1),this.context.stroke(),this.context.beginPath(),this.setLineWidth(1),this.setStrokeStyle(e[0].color),this.setFillStyle(e[0].color),this.context.moveTo(-u-o.width/3/2,-4),this.context.lineTo(-u-o.width/3/2-4,0),this.context.lineTo(-u-o.width/3/2,4),this.context.lineTo(-u-o.width/3/2,-4),this.context.stroke(),this.context.fill(),this.context.restore()}else{this.setLineWidth(o.width),this.setLineCap("butt");for(let i=0;i<t.length;i++){let e=t[i];this.context.beginPath(),this.setStrokeStyle(e.color),this.context.arc(a.x,a.y,h,e._startAngle_*Math.PI,e._endAngle_*Math.PI,!1),this.context.stroke()}this.context.save(),r=o.endAngle<o.startAngle?2+o.endAngle-o.startAngle:o.startAngle-o.endAngle;let i=r/o.splitLine.splitNumber,l=r/o.splitLine.splitNumber/o.splitLine.childNumber,p=-h-.5*o.width-o.splitLine.fixRadius,c=-h-.5*o.width-o.splitLine.fixRadius+o.splitLine.width,x=-h-.5*o.width-o.splitLine.fixRadius+o.splitLine.childWidth;this.context.translate(a.x,a.y),this.context.rotate((o.startAngle-1)*Math.PI);for(let t=0;t<o.splitLine.splitNumber+1;t++)this.context.beginPath(),this.setStrokeStyle(o.splitLine.color),this.setLineWidth(2*this.opts.pixelRatio),this.context.moveTo(p,0),this.context.lineTo(c,0),this.context.stroke(),this.context.rotate(i*Math.PI);this.context.restore(),this.context.save(),this.context.translate(a.x,a.y),this.context.rotate((o.startAngle-1)*Math.PI);for(let t=0;t<o.splitLine.splitNumber*o.splitLine.childNumber+1;t++)this.context.beginPath(),this.setStrokeStyle(o.splitLine.color),this.setLineWidth(1*this.opts.pixelRatio),this.context.moveTo(p,0),this.context.lineTo(x,0),this.context.stroke(),this.context.rotate(l*Math.PI);this.context.restore(),e=this.getGaugeDataPoints(e,t,o,s);for(let t=0;t<e.length;t++){let i=e[t];this.context.save(),this.context.translate(a.x,a.y),this.context.rotate((i._proportion_-1)*Math.PI),this.context.beginPath(),this.setFillStyle(i.color),this.context.moveTo(o.pointer.width,0),this.context.lineTo(0,-o.pointer.width/2),this.context.lineTo(-n,0),this.context.lineTo(0,o.pointer.width/2),this.context.lineTo(o.pointer.width,0),this.context.closePath(),this.context.fill(),this.context.beginPath(),this.setFillStyle("#FFFFFF"),this.context.arc(0,0,o.pointer.width/6,0,2*Math.PI,!1),this.context.fill(),this.context.restore()}!1!==this.opts.dataLabel&&this.drawGaugeLabel(o,h,a)}return this.drawRingTitle(a),1===s&&"gauge"===this.opts.type&&(this.opts.extra.gauge.oldAngle=e[0]._proportion_,this.opts.extra.gauge.oldData=e[0].data),{center:a,radius:h,innerRadius:n,categories:t,totalAngle:r}}getGaugeAxisPoints(t,i,e){let s=i-e;e<i&&(s=2+e-i);let o=i;for(let e=0;e<t.length;e++)t[e].value=null==t[e].value||null==t[e].value?0:t[e].value,t[e]._startAngle_=o,t[e]._endAngle_=s*t[e].value+i,t[e]._endAngle_>=2&&(t[e]._endAngle_=t[e]._endAngle_%2),o=t[e]._endAngle_;return t}getGaugeArcBarDataPoints(t,i,e=1){1==e&&(e=.999999);for(let s=0;s<t.length;s++){let o,a=t[s];a.data=null===a.data?0:a.data,o=i.endAngle<i.startAngle?2+i.endAngle-i.startAngle:i.startAngle-i.endAngle,a._proportion_=o*a.data*e+i.startAngle,a._proportion_>=2&&(a._proportion_=a._proportion_%2)}return t}getGaugeDataPoints(t,i,e,s=1){for(let o=0;o<t.length;o++){let a,h=t[o];if(h.data=null===h.data?0:h.data,"auto"==e.pointer.color){for(let t=0;t<i.length;t++)if(h.data<=i[t].value){i[t].color&&(h.color=i[t].color);break}}else h.color=e.pointer.color;a=e.endAngle<e.startAngle?2+e.endAngle-e.startAngle:e.startAngle-e.endAngle,h._endAngle_=a*h.data+e.startAngle,h._oldAngle_=e.oldAngle,e.oldAngle<e.endAngle&&(h._oldAngle_+=2),h.data>=e.oldData?h._proportion_=(h._endAngle_-h._oldAngle_)*s+e.oldAngle:h._proportion_=h._oldAngle_-(h._oldAngle_-h._endAngle_)*s,h._proportion_>=2&&(h._proportion_=h._proportion_%2)}return t}drawGaugeLabel(t,i,e){i=(i-=t.width/2+t.labelOffset*this.opts.pixelRatio)<10?10:i;let s=t.startAngle-t.endAngle;t.endAngle<t.startAngle&&(s=2+t.endAngle-t.startAngle);let o=s/t.splitLine.splitNumber,a=(t.endNumber-t.startNumber)/t.splitLine.splitNumber,h=t.startAngle,n=t.startNumber;for(let s=0;s<t.splitLine.splitNumber+1;s++){let r={x:i*Math.cos(h*Math.PI),y:i*Math.sin(h*Math.PI)},l=t.formatter?t.formatter(n,s,this.opts):n;r.x+=e.x-this.measureText(String(l),this.opts.fontSize)/2,r.y+=e.y;let p=r.x,c=r.y;this.context.beginPath(),this.setFontSize(this.opts.fontSize),this.setFillStyle(t.labelColor),this.context.fillText(String(l),p,c+this.opts.fontSize/2),this.context.closePath(),this.context.stroke(),h+=o,h>=2&&(h%=2),n+=a}}}class D extends o{constructor(t,i={}){super(t,i),this.render()}render(){let t=this.opts.series;t=this.fixPieSeries(t),t=i.fillSeries(t,this.opts);const e=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop();let s=t;this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const o=this.calculateLegendData(s,this.opts.chartData),a=o.area.wholeHeight,n=o.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=a;break;case"bottom":this.opts.area[2]+=a;break;case"left":this.opts.area[3]+=n;break;case"right":this.opts.area[1]+=n}if(this.opts.chartData.yAxisData={},this.opts.chartData.xAxisData={},this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.animation=new h({timing:this.opts.timing,duration:e,onProcess:i=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.opts.chartData.funnelData=this.drawFunnelDataPoints(t,i),this.drawLegend(this.opts.chartData),this.drawToolTipBridge(i),this.drawCanvas()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}drawFunnelDataPoints(t,e=1){let s=i.objectAssign({},{type:"funnel",activeWidth:10,activeOpacity:.3,border:!1,borderWidth:2,borderColor:"#FFFFFF",fillOpacity:1,minSize:0,labelAlign:"right",linearType:"none",customColor:[]},this.opts.extra.funnel),o=(this.opts.height-this.opts.area[0]-this.opts.area[2])/t.length,a={x:this.opts.area[3]+(this.opts.width-this.opts.area[1]-this.opts.area[3])/2,y:this.opts.height-this.opts.area[2]},h=s.activeWidth*this.opts.pixelRatio,n=Math.min((this.opts.width-this.opts.area[1]-this.opts.area[3])/2-h,(this.opts.height-this.opts.area[0]-this.opts.area[2])/2-h),r=this.getFunnelDataPoints(t,n,s,o,e);if(this.context.save(),this.context.translate(a.x,a.y),s.customColor=i.fillCustomColor(s.linearType,s.customColor,t),"pyramid"==s.type)for(let t=0;t<r.length;t++){if(t==r.length-1){this.opts.tooltip&&this.opts.tooltip.index==t&&(this.context.beginPath(),this.setFillStyle(i.hexToRgb(r[t].color,s.activeOpacity)),this.context.moveTo(-h,-o),this.context.lineTo(-r[t].radius-h,0),this.context.lineTo(r[t].radius+h,0),this.context.lineTo(h,-o),this.context.lineTo(-h,-o),this.context.closePath(),this.context.fill()),r[t].funnelArea=[a.x-r[t].radius,a.y-o*(t+1),a.x+r[t].radius,a.y-o*t],this.context.beginPath(),this.setLineWidth(s.borderWidth*this.opts.pixelRatio),this.setStrokeStyle(s.borderColor);let e=i.hexToRgb(r[t].color,s.fillOpacity);if("custom"==s.linearType){let a=this.context.createLinearGradient(r[t].radius,-o,-r[t].radius,-o);a.addColorStop(0,i.hexToRgb(r[t].color,s.fillOpacity)),a.addColorStop(.5,i.hexToRgb(s.customColor[r[t].linearIndex],s.fillOpacity)),a.addColorStop(1,i.hexToRgb(r[t].color,s.fillOpacity)),e=a}this.setFillStyle(e),this.context.moveTo(0,-o),this.context.lineTo(-r[t].radius,0),this.context.lineTo(r[t].radius,0),this.context.lineTo(0,-o),this.context.closePath(),this.context.fill(),1==s.border&&this.context.stroke()}else{this.opts.tooltip&&this.opts.tooltip.index==t&&(this.context.beginPath(),this.setFillStyle(i.hexToRgb(r[t].color,s.activeOpacity)),this.context.moveTo(0,0),this.context.lineTo(-r[t].radius-h,0),this.context.lineTo(-r[t+1].radius-h,-o),this.context.lineTo(r[t+1].radius+h,-o),this.context.lineTo(r[t].radius+h,0),this.context.lineTo(0,0),this.context.closePath(),this.context.fill()),r[t].funnelArea=[a.x-r[t].radius,a.y-o*(t+1),a.x+r[t].radius,a.y-o*t],this.context.beginPath(),this.setLineWidth(s.borderWidth*this.opts.pixelRatio),this.setStrokeStyle(s.borderColor);let e=i.hexToRgb(r[t].color,s.fillOpacity);if("custom"==s.linearType){let a=this.context.createLinearGradient(r[t].radius,-o,-r[t].radius,-o);a.addColorStop(0,i.hexToRgb(r[t].color,s.fillOpacity)),a.addColorStop(.5,i.hexToRgb(s.customColor[r[t].linearIndex],s.fillOpacity)),a.addColorStop(1,i.hexToRgb(r[t].color,s.fillOpacity)),e=a}this.setFillStyle(e),this.context.moveTo(0,0),this.context.lineTo(-r[t].radius,0),this.context.lineTo(-r[t+1].radius,-o),this.context.lineTo(r[t+1].radius,-o),this.context.lineTo(r[t].radius,0),this.context.lineTo(0,0),this.context.closePath(),this.context.fill(),1==s.border&&this.context.stroke()}this.context.translate(0,-o)}else{this.context.translate(0,-(r.length-1)*o);for(let t=0;t<r.length;t++){if(t==r.length-1){this.opts.tooltip&&this.opts.tooltip.index==t&&(this.context.beginPath(),this.setFillStyle(i.hexToRgb(r[t].color,s.activeOpacity)),this.context.moveTo(-h-s.minSize/2,0),this.context.lineTo(-r[t].radius-h,-o),this.context.lineTo(r[t].radius+h,-o),this.context.lineTo(h+s.minSize/2,0),this.context.lineTo(-h-s.minSize/2,0),this.context.closePath(),this.context.fill()),r[t].funnelArea=[a.x-r[t].radius,a.y-o,a.x+r[t].radius,a.y],this.context.beginPath(),this.setLineWidth(s.borderWidth*this.opts.pixelRatio),this.setStrokeStyle(s.borderColor);let e=i.hexToRgb(r[t].color,s.fillOpacity);if("custom"==s.linearType){let a=this.context.createLinearGradient(r[t].radius,-o,-r[t].radius,-o);a.addColorStop(0,i.hexToRgb(r[t].color,s.fillOpacity)),a.addColorStop(.5,i.hexToRgb(s.customColor[r[t].linearIndex],s.fillOpacity)),a.addColorStop(1,i.hexToRgb(r[t].color,s.fillOpacity)),e=a}this.setFillStyle(e),this.context.moveTo(0,0),this.context.lineTo(-s.minSize/2,0),this.context.lineTo(-r[t].radius,-o),this.context.lineTo(r[t].radius,-o),this.context.lineTo(s.minSize/2,0),this.context.lineTo(0,0),this.context.closePath(),this.context.fill(),1==s.border&&this.context.stroke()}else{this.opts.tooltip&&this.opts.tooltip.index==t&&(this.context.beginPath(),this.setFillStyle(i.hexToRgb(r[t].color,s.activeOpacity)),this.context.moveTo(0,0),this.context.lineTo(-r[t+1].radius-h,0),this.context.lineTo(-r[t].radius-h,-o),this.context.lineTo(r[t].radius+h,-o),this.context.lineTo(r[t+1].radius+h,0),this.context.lineTo(0,0),this.context.closePath(),this.context.fill()),r[t].funnelArea=[a.x-r[t].radius,a.y-o*(r.length-t),a.x+r[t].radius,a.y-o*(r.length-t-1)],this.context.beginPath(),this.setLineWidth(s.borderWidth*this.opts.pixelRatio),this.setStrokeStyle(s.borderColor);let e=i.hexToRgb(r[t].color,s.fillOpacity);if("custom"==s.linearType){let a=this.context.createLinearGradient(r[t].radius,-o,-r[t].radius,-o);a.addColorStop(0,i.hexToRgb(r[t].color,s.fillOpacity)),a.addColorStop(.5,i.hexToRgb(s.customColor[r[t].linearIndex],s.fillOpacity)),a.addColorStop(1,i.hexToRgb(r[t].color,s.fillOpacity)),e=a}this.setFillStyle(e),this.context.moveTo(0,0),this.context.lineTo(-r[t+1].radius,0),this.context.lineTo(-r[t].radius,-o),this.context.lineTo(r[t].radius,-o),this.context.lineTo(r[t+1].radius,0),this.context.lineTo(0,0),this.context.closePath(),this.context.fill(),1==s.border&&this.context.stroke()}this.context.translate(0,o)}}return this.context.restore(),!1!==this.opts.dataLabel&&1===e&&this.drawFunnelText(r,o,s.labelAlign,h,a),1===e&&this.drawFunnelCenterText(r,o,s.labelAlign,h,a),{center:a,radius:n,series:r}}getFunnelDataPoints(t,i,e,s,o=1){for(let a=0;a<t.length;a++)"funnel"==e.type?t[a].radius=t[a].data/t[0].data*i*o:t[a].radius=s*(t.length-a)/(s*t.length)*i*o,t[a]._proportion_=t[a].data/t[0].data;return t}drawFunnelText(t,e,s,o,a){for(let h=0;h<t.length;h++){let n,r,l,p,c=t[h];if(!1===c.labelShow)continue;let x=c.formatter?c.formatter(String(c.data),h,t,this.opts):i.toFixed(100*c._proportion_)+"%";x=c.labelText?c.labelText:x,"right"==s&&(n=h==t.length-1?(c.funnelArea[2]+a.x)/2:(c.funnelArea[2]+t[h+1].funnelArea[2])/2,r=n+2*o,l=c.funnelArea[1]+e/2,p=c.textSize?c.textSize*this.opts.pixelRatio:this.opts.fontSize*this.opts.pixelRatio,this.setLineWidth(1*this.opts.pixelRatio),this.setStrokeStyle(c.color),this.setFillStyle(c.color),this.context.beginPath(),this.context.moveTo(n,l),this.context.lineTo(r,l),this.context.stroke(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(r,l),this.context.arc(r,l,2*this.opts.pixelRatio,0,2*Math.PI),this.context.closePath(),this.context.fill(),this.context.beginPath(),this.setFontSize(p),this.setFillStyle(c.textColor||this.opts.fontColor),this.context.fillText(x,r+5,l+p/2-2),this.context.closePath(),this.context.stroke(),this.context.closePath()),"left"==s&&(n=h==t.length-1?(c.funnelArea[0]+a.x)/2:(c.funnelArea[0]+t[h+1].funnelArea[0])/2,r=n-2*o,l=c.funnelArea[1]+e/2,p=c.textSize?c.textSize*this.opts.pixelRatio:this.opts.fontSize*this.opts.pixelRatio,this.setLineWidth(1*this.opts.pixelRatio),this.setStrokeStyle(c.color),this.setFillStyle(c.color),this.context.beginPath(),this.context.moveTo(n,l),this.context.lineTo(r,l),this.context.stroke(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(r,l),this.context.arc(r,l,2,0,2*Math.PI),this.context.closePath(),this.context.fill(),this.context.beginPath(),this.setFontSize(p),this.setFillStyle(c.textColor||this.opts.fontColor),this.context.fillText(x,r-5-this.measureText(x,p),l+p/2-2),this.context.closePath(),this.context.stroke(),this.context.closePath())}}drawFunnelCenterText(t,i,e,s,o){for(let e=0;e<t.length;e++){let s,a,h=t[e];h.centerText&&(s=h.funnelArea[1]+i/2,a=h.centerTextSize*this.opts.pixelRatio||this.opts.fontSize*this.opts.pixelRatio,this.context.beginPath(),this.setFontSize(a),this.setFillStyle(h.centerTextColor||"#FFFFFF"),this.context.fillText(h.centerText,o.x-this.measureText(h.centerText,a)/2,s+a/2-2),this.context.closePath(),this.context.stroke(),this.context.closePath())}}}class T extends o{constructor(t,i={}){super(t,i),this.render()}render(){let t=i.fillSeries(this.opts.series,this.opts);const s=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop();let o=t,a=i.objectAssign({show:!0},this.opts.extra.candle.average);a.show&&(o=this.calCandleMA(a.day,a.name,a.color,t[0].data),o=i.fillSeries(o,this.opts),this.opts.seriesMA=o),this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const n=this.calculateLegendData(o,this.opts.chartData),r=n.area.wholeHeight,l=n.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=r;break;case"bottom":this.opts.area[2]+=r;break;case"left":this.opts.area[3]+=l;break;case"right":this.opts.area[1]+=l}const p=this.calculateYAxisData(t),c=p.yAxisWidth;if(this.opts.yAxis.showTitle){let t=0;for(let i=0;i<this.opts.yAxis.data.length;i++)t=Math.max(t,this.opts.yAxis.data[i].titleFontSize?this.opts.yAxis.data[i].titleFontSize*this.opts.pixelRatio:this.opts.fontSize);this.opts.area[0]+=t}let x=0,d=0;for(let t=0;t<c.length;t++)"left"==c[t].position?(this.opts.area[3]+=d>0?c[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:c[t].width,d+=1):"right"==c[t].position&&(this.opts.area[1]+=x>0?c[t].width+this.opts.yAxis.padding*this.opts.pixelRatio:c[t].width,x+=1);if(this.opts.chartData.yAxisData=p,this.opts.categories&&this.opts.categories.length){this.opts.chartData.xAxisData=this.getXAxisPoints(this.opts.categories);let t=this.calculateCategoriesData(this.opts.categories),i=t.xAxisHeight,s=t.angle;e.xAxisHeight=i,this.opts._xAxisTextAngle_=s,this.opts.area[2]+=i,this.opts.chartData.categoriesData=t}else this.opts.chartData.xAxisData={xAxisPoints:[]};if(this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.animation=new h({timing:this.opts.timing,duration:s,onProcess:i=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.drawYAxisGrid(this.opts.categories),this.drawXAxis(this.opts.categories);let e=this.drawCandleDataPoints(t,o,i),s=e.xAxisPoints,a=e.calPoints,h=e.eachSpacing;this.opts.chartData.xAxisPoints=s,this.opts.chartData.calPoints=a,this.opts.chartData.eachSpacing=h,this.drawYAxis(),!1!==this.opts.enableMarkLine&&1===i&&this.drawMarkLine(),this.drawLegend(this.opts.chartData),this.drawToolTipBridge(i),this.drawCanvas()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}calCandleMA(t,i,e,s){let o=[];for(let a=0;a<t.length;a++){let h={data:[],name:i[a],color:e[a]};for(let i=0,e=s.length;i<e;i++){if(i<t[a]){h.data.push(null);continue}let e=0;for(let o=0;o<t[a];o++)e+=s[i-o][1];h.data.push(+(e/t[a]).toFixed(3))}o.push(h)}return o}drawCandleDataPoints(t,e,s=1){let o=i.objectAssign({},{color:{},average:{}},this.opts.extra.candle);o.color=i.objectAssign({},{upLine:"#f04864",upFill:"#f04864",downLine:"#2fc25b",downFill:"#2fc25b"},o.color),o.average=i.objectAssign({},{show:!0,name:[],day:[],color:this.opts.color},o.average),this.opts.extra.candle=o;let a=this.opts.chartData.xAxisData,h=a.xAxisPoints,n=a.eachSpacing,r=[];this.context.save();let l=-2,p=h.length+2,c=0,x=this.opts.width+n;return this.opts._scrollDistance_&&0!==this.opts._scrollDistance_&&!0===this.opts.enableScroll&&(this.context.translate(this.opts._scrollDistance_,0),l=Math.floor(-this.opts._scrollDistance_/n)-2,p=l+this.opts.xAxis.itemCount+4,c=-this.opts._scrollDistance_-2*n+this.opts.area[3],x=c+(this.opts.xAxis.itemCount+4)*n),(o.average.show||e)&&e.forEach((t,i)=>{let e,o,a;e=[].concat(this.opts.chartData.yAxisData.ranges[t.index]),o=e.pop(),a=e.shift();let r=t.data,l=this.getDataPoints(r,o,a,h,n,s),p=this.splitPoints(l,t);for(let i=0;i<p.length;i++){let e=p[i];if(this.context.beginPath(),this.setStrokeStyle(t.color),this.setLineWidth(1),1===e.length)this.context.moveTo(e[0].x,e[0].y),this.context.arc(e[0].x,e[0].y,1,0,2*Math.PI);else{this.context.moveTo(e[0].x,e[0].y);let t=0;for(let i=0;i<e.length;i++){let s=e[i];if(0==t&&s.x>c&&(this.context.moveTo(s.x,s.y),t=1),i>0&&s.x>c&&s.x<x){let t=this.createCurveControlPoints(e,i-1);this.context.bezierCurveTo(t.ctrA.x,t.ctrA.y,t.ctrB.x,t.ctrB.y,s.x,s.y)}}this.context.moveTo(e[0].x,e[0].y)}this.context.closePath(),this.context.stroke()}}),t.forEach((t,i)=>{let e,a,c;e=[].concat(this.opts.chartData.yAxisData.ranges[t.index]),a=e.pop(),c=e.shift();let x=t.data,d=this.getCandleDataPoints(x,a,c,h,n,s);r.push(d);let g=this.splitCandlePoints(d,t);for(let t=0;t<g[0].length;t++)if(t>l&&t<p){let i=g[0][t];this.context.beginPath(),x[t][1]-x[t][0]>0?(this.setStrokeStyle(o.color.upLine),this.setFillStyle(o.color.upFill),this.setLineWidth(1*this.opts.pixelRatio),this.context.moveTo(i[3].x,i[3].y),this.context.lineTo(i[1].x,i[1].y),this.context.lineTo(i[1].x-n/4,i[1].y),this.context.lineTo(i[0].x-n/4,i[0].y),this.context.lineTo(i[0].x,i[0].y),this.context.lineTo(i[2].x,i[2].y),this.context.lineTo(i[0].x,i[0].y),this.context.lineTo(i[0].x+n/4,i[0].y),this.context.lineTo(i[1].x+n/4,i[1].y),this.context.lineTo(i[1].x,i[1].y),this.context.moveTo(i[3].x,i[3].y)):(this.setStrokeStyle(o.color.downLine),this.setFillStyle(o.color.downFill),this.setLineWidth(1*this.opts.pixelRatio),this.context.moveTo(i[3].x,i[3].y),this.context.lineTo(i[0].x,i[0].y),this.context.lineTo(i[0].x-n/4,i[0].y),this.context.lineTo(i[1].x-n/4,i[1].y),this.context.lineTo(i[1].x,i[1].y),this.context.lineTo(i[2].x,i[2].y),this.context.lineTo(i[1].x,i[1].y),this.context.lineTo(i[1].x+n/4,i[1].y),this.context.lineTo(i[0].x+n/4,i[0].y),this.context.lineTo(i[0].x,i[0].y),this.context.moveTo(i[3].x,i[3].y)),this.context.closePath(),this.context.fill(),this.context.stroke()}}),this.context.restore(),{xAxisPoints:h,calPoints:r,eachSpacing:n}}getCandleDataPoints(t,i,e,s,o,a=1){let h=[],n=this.opts.height-this.opts.area[0]-this.opts.area[2];return t.forEach((t,r)=>{if(null===t)h.push(null);else{let l=[];t.forEach((t,h)=>{let p={x:0,y:0};p.x=s[r]+Math.round(o/2);let c=n*(t-i)/(e-i);c*=a,p.y=this.opts.height-Math.round(c)-this.opts.area[2],l.push(p)}),h.push(l)}}),h}splitCandlePoints(t,i){let e=[],s=[];return t.forEach((t,o)=>{i.connectNulls?null!==t&&s.push(t):null!==t?s.push(t):(s.length&&e.push(s),s=[])}),s.length&&e.push(s),e}}class P extends o{constructor(t,i={}){super(t,i),this.render()}render(){let t=this.opts.series;t=i.fillSeries(t,this.opts),this.opts.animation&&this.opts.duration,this.animation&&this.animation.stop();let e=t;this.opts._series_=t=i.filterSeries(t),this.opts.area=new Array(4);for(let t=0;t<4;t++)this.opts.area[t]=this.opts.padding[t]*this.opts.pixelRatio;const s=this.calculateLegendData(e,this.opts.chartData),o=s.area.wholeHeight,a=s.area.wholeWidth;switch(this.opts.legend.position){case"top":this.opts.area[0]+=o;break;case"bottom":this.opts.area[2]+=o;break;case"left":this.opts.area[3]+=a;break;case"right":this.opts.area[1]+=a}if(this.opts.chartData.yAxisData={},this.opts.chartData.xAxisData={},this.opts.enableScroll&&"right"==this.opts.xAxis.scrollAlign&&void 0===this.opts._scrollDistance_){let t=0,i=this.opts.chartData.xAxisData.xAxisPoints,e=this.opts.chartData.xAxisData.startX;t=this.opts.chartData.xAxisData.endX-e-this.opts.chartData.xAxisData.eachSpacing*(i.length-1),this.scrollOption.currentOffset=t,this.scrollOption.startTouchX=t,this.scrollOption.distance=0,this.scrollOption.lastMoveTime=0,this.opts._scrollDistance_=t}this.context.clearRect(0,0,this.opts.width,this.opts.height),this.opts.rotate&&this.contextRotate(),this.drawMapDataPoints(t,1),setTimeout(()=>{this.event.emit("renderComplete",this.opts)},50)}drawMapDataPoints(t,e){var s,o,a;let h,n,r=i.objectAssign({},{border:!0,mercator:!1,borderWidth:1,active:!0,borderColor:"#666666",fillOpacity:.6,activeBorderColor:"#f04864",activeFillColor:"#facc14",activeFillOpacity:1,color:["#E0F7FF","#81D4FA","#29B6F6","#EF5350","#B71C1C"]},this.opts.extra.map),l=t,p=this.getBoundingBox(l);if(r.mercator){let t=this.lonlat2mercator(p.xMax,p.yMax),i=this.lonlat2mercator(p.xMin,p.yMin);p.xMax=t[0],p.yMax=t[1],p.xMin=i[0],p.yMin=i[1]}let c=this.opts.width/Math.abs(p.xMax-p.xMin),x=this.opts.height/Math.abs(p.yMax-p.yMin),d=c<x?c:x,g=this.opts.width/2-Math.abs(p.xMax-p.xMin)/2*d,u=this.opts.height/2-Math.abs(p.yMax-p.yMin)/2*d,f=[];for(let t=0;t<l.length;t++){let i=l[t].value||0;f.push(i)}let y=this.getValueColors(f,r.color);for(let e=0;e<l.length;e++){this.context.beginPath(),this.setLineWidth(r.borderWidth*this.opts.pixelRatio),this.setStrokeStyle(r.borderColor),this.setFillStyle(i.hexToRgb(t[e].color||y[e],t[e].fillOpacity||r.fillOpacity)),1==r.active&&this.opts.tooltip&&this.opts.tooltip.index==e&&(this.setStrokeStyle(r.activeBorderColor),this.setFillStyle(i.hexToRgb(r.activeFillColor,r.activeFillOpacity)));let s=l[e].geometry.coordinates;for(let t=0;t<s.length;t++){h=s[t],Array.isArray(h)&&1==h.length&&(h=h[0]);for(let t=0;t<h.length;t++){let i=Array(2);i=r.mercator?this.lonlat2mercator(h[t][0],h[t][1]):h[t],n=this.coordinateToPoint(i[1],i[0],p,d,g,u),0===t?(this.context.beginPath(),this.context.moveTo(n.x,n.y)):this.context.lineTo(n.x,n.y)}this.context.fill(),1==r.border&&this.context.stroke()}}if(1==this.opts.dataLabel)for(let t=0;t<l.length;t++){let i=(null===(s=l[t].properties)||void 0===s?void 0:s.centroid)||l[t].properties.center;if(i){r.mercator&&(i=(null===(o=l[t].properties)||void 0===o?void 0:o.centroid)?this.lonlat2mercator(l[t].properties.centroid[0],l[t].properties.centroid[1]):this.lonlat2mercator(l[t].properties.center[0],l[t].properties.center[1])),n=this.coordinateToPoint(i[1],i[0],p,d,g,u);let e=l[t].textSize*this.opts.pixelRatio||this.opts.fontSize,s=l[t].textColor||this.opts.fontColor;r.active&&r.activeTextColor&&this.opts.tooltip&&this.opts.tooltip.index==t&&(s=r.activeTextColor);let h=(null===(a=l[t].properties)||void 0===a?void 0:a.name)||"";this.context.beginPath(),this.setFontSize(e),this.setFillStyle(s),this.context.fillText(h,n.x-this.measureText(h,e)/2,n.y+e/2),this.context.closePath(),this.context.stroke()}}this.opts.chartData.mapData={bounds:p,scale:d,xoffset:g,yoffset:u,mercator:r.mercator},this.drawToolTipBridge(e)}getBoundingBox(t){let i={xMin:180,xMax:0,yMin:90,yMax:0},e=[];for(let s=0;s<t.length;s++){let o=t[s].geometry.coordinates;for(let t=0;t<o.length;t++){let s=o[t];1===s.length&&(e=s[0]);for(let t=0;t<e.length;t++){let s={x:e[t][0],y:e[t][1]};i.xMin=i.xMin<s.x?i.xMin:s.x,i.xMax=i.xMax>s.x?i.xMax:s.x,i.yMin=i.yMin<s.y?i.yMin:s.y,i.yMax=i.yMax>s.y?i.yMax:s.y}}}return i}getValueColors(t,i){const e=(t,i,e)=>t+(i-t)*e;if(0===t.length)return[];if(1===i.length)return t.map(()=>i[0]);const s=Math.min(...t),o=Math.max(...t)-s,a=i.map(t=>{const i=t.replace("#","").slice(0,6);return[parseInt(i.slice(0,2),16),parseInt(i.slice(2,4),16),parseInt(i.slice(4,6),16)]});return t.map(t=>{const i=(0===o?0:(t-s)/o)*(a.length-1),h=Math.floor(i),n=Math.ceil(i),r=i-h,[l,p,c]=a[h],[x,d,g]=a[n]||a[h],u=e(l,x,r),f=e(p,d,r),y=e(c,g,r);return`#${[u,f,y].map(t=>Math.round(t).toString(16).padStart(2,"0")).join("")}`})}}class R extends o{constructor(t,e={}){super(t,e),this.layout={maxDayLabelWidth:0,monthLabelHeight:0,legendHeight:0,legendY:0,legendX:0,legendWidth:0,cellSize:0,contentWidth:0,contentOffsetX:0,gridStartX:0,gridEndX:0,navigationHeight:30,margins:{top:0,left:0,right:0,bottom:0}},this.pagination={enabled:!1,currentPage:0,totalPages:1,monthsPerPage:6,pageData:[]},this.drawData={data:[],year:2023,startDate:void 0,endDate:void 0,yearStart:void 0,yearEnd:void 0,spacing:{outer:5,label:8,legend:10,textVertical:4},tooltip:{visible:!1,x:0,y:0,contributions:0,date:""}};this.opts.extra.heatmap=i.objectAssign({},{cellGap:3,cellRadius:2,legend:{show:!0,position:"center",labelLess:"Less",labelMore:"More",fontSize:11,cellSize:9,cellGap:4,cellRadius:2,textGap:8,colorLevels:5},pagination:{showNavigation:!0,navigationAction:null,monthsPerPage:6},monthLabels:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayLabels:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},this.opts.extra.heatmap);const s=this.opts.extra.heatmap.legend.colorLevels,o=Math.max(3,Math.min(6,s));this.opts.extra.heatmap.legend.colorLevels=o,this.opts.color=this.opts.color.slice(0,o),this.render()}handleNavigationAction(){let t=this.opts.extra.heatmap.pagination.navigationAction;if(!t)return;let i=this.pagination.currentPage;switch(t){case"prev":i-=1;break;case"next":i+=1}this.opts.extra.heatmap.pagination.navigationAction=null,i<0||i>=this.pagination.totalPages||(this.pagination.currentPage=i)}render(){this.handleNavigationAction(),this.fillSeriesData(),this.checkPaginationNeed(),this.calculateLayoutMetrics();const t=this.opts.animation?this.opts.duration:0;this.animation&&this.animation.stop(),this.animation=new h({timing:this.opts.timing,duration:t,onProcess:t=>{this.context.clearRect(0,0,this.opts.width,this.opts.height),this.drawMonthLabels(),this.drawDayLabels(),this.drawLegend(),this.pagination.enabled&&this.drawPaginationNavigation(),this.drawHeatmapWithAnimation(t),this.drawTooltip()},onFinish:()=>{this.event.emit("renderComplete",this.opts)}})}checkPaginationNeed(){const t=53*(12+this.opts.extra.heatmap.cellGap)-this.opts.extra.heatmap.cellGap+this.layout.maxDayLabelWidth+this.drawData.spacing.label+2*this.drawData.spacing.outer;if(this.opts.width<t){this.pagination.enabled=!0;const t=this.opts.extra.heatmap.pagination.monthsPerPage,i=Math.max(1,Math.min(12,t));this.pagination.monthsPerPage=i,this.pagination.totalPages=Math.ceil(12/i),this.pagination.currentPage=Math.max(0,Math.min(this.pagination.currentPage,this.pagination.totalPages-1)),this.preparePageData()}else this.pagination.enabled=!1,this.pagination.currentPage=0,this.pagination.totalPages=1,this.pagination.pageData=this.drawData.data}preparePageData(){if(!this.pagination.enabled)return void(this.pagination.pageData=this.drawData.data);const t=this.pagination.currentPage*this.pagination.monthsPerPage,i=t+this.pagination.monthsPerPage-1;if(this.pagination.pageData=this.drawData.data.filter(e=>{if(!e.isInYear)return!1;const s=e.date.getMonth();return s>=t&&s<=i}),this.pagination.pageData.length>0){const t=this.pagination.pageData[0].date,i=new Date(t);i.setDate(i.getDate()-i.getDay());const e=this.pagination.pageData[this.pagination.pageData.length-1].date,s=new Date(e);s.setDate(s.getDate()+(6-s.getDay()));const o=[],a=new Date(i);for(;a<=s;){const t=this.drawData.data.find(t=>t.date.toDateString()===a.toDateString());t?o.push(t):o.push({date:new Date(a),contributions:0,level:0,isInYear:a>=this.drawData.yearStart&&a<=this.drawData.yearEnd}),a.setDate(a.getDate()+1)}this.pagination.pageData=o}}drawPaginationNavigation(){if(!this.pagination.enabled||!this.opts.extra.heatmap.pagination.showNavigation)return;const t=this.context;t.save();const i=this.opts.height-this.layout.navigationHeight-5,e=this.opts.width/2;this.setFontSize(12),this.setFillStyle(this.opts.fontColor),this.setTextAlign("center"),this.setTextBaseline("middle");const s=`${this.pagination.currentPage+1} / ${this.pagination.totalPages}`,o=this.pagination.monthsPerPage,a=this.pagination.currentPage*o,h=Math.min(a+o-1,11),n=this.opts.extra.heatmap.monthLabels;let r;r=a===h?n[a]:`${n[a]} - ${n[h]}`;const l=`${r} (${s})`;if(t.fillText(l,e,i),this.pagination.currentPage>0){const s=e-80;t.strokeStyle=this.opts.fontColor,t.fillText("< Prev",s,i)}if(this.pagination.currentPage<this.pagination.totalPages-1){const s=e+80;t.strokeStyle=this.opts.fontColor,t.fillText("Next >",s,i)}t.restore()}goToPage(t){t<0||t>=this.pagination.totalPages||(this.pagination.currentPage=t,this.render())}nextPage(){this.goToPage(this.pagination.currentPage+1)}prevPage(){this.goToPage(this.pagination.currentPage-1)}drawHeatmapWithAnimation(t){const i=this.pagination.enabled?this.pagination.pageData:this.drawData.data;if(0===i.length)return;const e=Math.ceil(i.length/7);i.forEach((s,o)=>{if(!s.isInYear)return;const{x:a,y:h}=this.getCellPositionForPagination(o,i),n=o%7,r=.8*(Math.floor(o/7)/Math.max(1,e-1)+.1*Math.sin(n*Math.PI/6)),l=r+.2;if(t<r)return;let p=1;if(t<l){const i=(t-r)/Math.max(.001,l-r),e=this.easeOutBack(i);p=Math.min(1,e)}if(p<=0)return;this.context.save();const c=this.layout.cellSize*p,x=(this.layout.cellSize-c)/2,d=(this.layout.cellSize-c)/2;this.setFillStyle(this.opts.color[s.level]),this.drawRoundedRect(a+x,h+d,c,c,this.opts.extra.heatmap.cellRadius*p),this.context.restore()})}easeOutBack(t){const i=1.70158;return 1+2.70158*Math.pow(t-1,3)+i*Math.pow(t-1,2)}getCellPosition(t){const i=Math.floor(t/7),e=t%7;return{x:this.layout.margins.left+i*(this.layout.cellSize+this.opts.extra.heatmap.cellGap),y:this.layout.margins.top+e*(this.layout.cellSize+this.opts.extra.heatmap.cellGap)}}getCellPositionForPagination(t,i){const e=Math.floor(t/7),s=t%7;return{x:this.layout.margins.left+e*(this.layout.cellSize+this.opts.extra.heatmap.cellGap),y:this.layout.margins.top+s*(this.layout.cellSize+this.opts.extra.heatmap.cellGap)}}calculateLayoutMetrics(){const t=this.opts.fontSize;this.setFontSize(t);let i=0;this.opts.extra.heatmap.dayLabels.forEach(e=>{const s=this.measureText(e||"undefined",t);i=Math.max(i,s)}),this.layout.maxDayLabelWidth=i;const e=this.drawData.spacing;this.layout.monthLabelHeight=t+2*e.textVertical,this.setFontSize(this.opts.extra.heatmap.legend.fontSize),this.layout.legendHeight=Math.max(this.opts.extra.heatmap.legend.cellSize,this.opts.extra.heatmap.legend.fontSize+e.textVertical),this.layout.margins={top:this.layout.monthLabelHeight+e.outer,left:this.layout.maxDayLabelWidth+e.label,right:e.outer,bottom:this.layout.legendHeight+e.legend+e.outer+(this.pagination.enabled&&this.opts.extra.heatmap.pagination.showNavigation?this.layout.navigationHeight:0)},this.calculateContentDimensions(e),this.layout.contentOffsetX=Math.max(0,(this.opts.width-this.layout.contentWidth)/2),this.layout.gridStartX=this.layout.margins.left+this.layout.contentOffsetX+e.outer;const s=this.drawData.data.length>0?Math.ceil(this.drawData.data.length/7):53;this.layout.gridEndX=this.layout.gridStartX+s*this.layout.cellSize+(s-1)*this.opts.extra.heatmap.cellGap,this.calculateLegendDimensions(e),this.layout.margins.left+=this.layout.contentOffsetX+e.outer}calculateContentDimensions(t){let i;i=this.pagination.enabled?this.pagination.pageData.length>0?Math.ceil(this.pagination.pageData.length/7):26:this.drawData.data.length>0?Math.ceil(this.drawData.data.length/7):53;const e=(this.opts.width-this.layout.margins.left-this.layout.margins.right+this.opts.extra.heatmap.cellGap)/i-this.opts.extra.heatmap.cellGap;this.layout.cellSize=Math.max(5,Math.min(12,Math.floor(e))),this.layout.contentWidth=this.layout.maxDayLabelWidth+t.label+i*(this.layout.cellSize+this.opts.extra.heatmap.cellGap)-this.opts.extra.heatmap.cellGap+2*t.outer}calculateLegendDimensions(t){const i=this.opts.extra.heatmap.legend.fontSize,e=this.measureText(this.opts.extra.heatmap.legend.labelLess,i),s=this.measureText(this.opts.extra.heatmap.legend.labelMore,i),o=this.opts.color.length*this.opts.extra.heatmap.legend.cellSize+(this.opts.color.length-1)*this.opts.extra.heatmap.legend.cellGap;let a,h;if(this.layout.legendWidth=e+o+s+2*this.opts.extra.heatmap.legend.textGap,this.layout.legendHeight=Math.max(this.opts.extra.heatmap.legend.cellSize,i+t.textVertical),this.layout.legendY=this.layout.margins.top+7*(this.layout.cellSize+this.opts.extra.heatmap.cellGap)-this.opts.extra.heatmap.cellGap+t.legend,this.pagination.enabled){a=this.layout.margins.left;h=a+(this.opts.width-this.layout.margins.left-this.layout.margins.right-2*t.outer)}else a=this.layout.gridStartX,h=this.layout.gridEndX;const n=h-a;if(this.layout.legendWidth>n)this.layout.legendX=Math.max(10,(this.opts.width-this.layout.legendWidth)/2),this.layout.legendX+this.layout.legendWidth>this.opts.width-10&&(this.layout.legendX=this.opts.width-this.layout.legendWidth-10);else switch(this.opts.extra.heatmap.legend.position){case"left":this.layout.legendX=a;break;case"right":this.layout.legendX=h-this.layout.legendWidth;break;default:const t=a+(h-a)/2;this.layout.legendX=t-this.layout.legendWidth/2}}drawMonthLabels(){const t=this.context;if(t.save(),this.setFontSize(this.opts.fontSize),this.setFillStyle(this.opts.fontColor),this.setTextAlign("center"),this.setTextBaseline("middle"),!this.drawData.startDate)return;const i=this.drawData.spacing,e=new Set,s=i.outer+this.opts.fontSize/2+i.textVertical;let o=0,a=11;this.pagination.enabled&&(o=this.pagination.currentPage*this.pagination.monthsPerPage,a=o+this.pagination.monthsPerPage-1);for(let i=o;i<=a;i++){const o=new Date(this.drawData.year,i,1),a=`${o.getFullYear()}-${o.getMonth()}`;if(e.has(a))continue;if(e.add(a),o>this.drawData.yearEnd)break;let h;if(this.pagination.enabled){const t=this.pagination.pageData.findIndex(t=>t.isInYear&&t.date.getMonth()===i);if(!(t>=0))continue;h=Math.floor(t/7)}else{const t=this.getDaysBetween(this.drawData.startDate,o);h=Math.floor(t/7),h<0&&(h=0);const i=Math.ceil(this.drawData.data.length/7)-1;h>i&&(h=i)}const n=this.layout.margins.left+h*(this.layout.cellSize+this.opts.extra.heatmap.cellGap)+(this.layout.cellSize+this.opts.extra.heatmap.cellGap)/2,r=this.opts.extra.heatmap.monthLabels[o.getMonth()];t.fillText(r,n,s)}t.restore()}drawDayLabels(){const t=this.context;t.save(),this.setFontSize(this.opts.fontSize),this.setFillStyle(this.opts.fontColor),this.setTextAlign("left"),this.setTextBaseline("middle");const i=this.drawData.spacing;this.opts.extra.heatmap.dayLabels.forEach((e,s)=>{const o=this.layout.margins.top+s*(this.layout.cellSize+this.opts.extra.heatmap.cellGap)+this.layout.cellSize/2,a=this.layout.margins.left-this.layout.maxDayLabelWidth-i.label;t.fillText(e,a,o)}),t.restore()}drawLegend(){if(!this.opts.extra.heatmap.legend.show)return;const t=this.context;t.save();const i=this.drawData.spacing,e=this.layout.margins.top+7*(this.layout.cellSize+this.opts.extra.heatmap.cellGap)-this.opts.extra.heatmap.cellGap+i.legend,s=this.opts.extra.heatmap.legend.fontSize;this.setFontSize(s),this.setFillStyle(this.opts.fontColor),this.setTextBaseline("middle");const o=this.opts.color.length*this.opts.extra.heatmap.legend.cellSize+(this.opts.color.length-1)*this.opts.extra.heatmap.legend.cellGap,a=this.measureText(this.opts.extra.heatmap.legend.labelLess,s),h=a+o+this.measureText(this.opts.extra.heatmap.legend.labelMore,s)+2*this.opts.extra.heatmap.legend.textGap;let n=this.layout.legendX;this.layout.legendY=e,this.layout.legendWidth=h,this.setTextAlign("right"),t.fillText(this.opts.extra.heatmap.legend.labelLess,n+a,e);let r=n+a+this.opts.extra.heatmap.legend.textGap;this.opts.color.forEach(t=>{this.setFillStyle(t),this.drawRoundedRect(r,e-this.opts.extra.heatmap.legend.cellSize/2,this.opts.extra.heatmap.legend.cellSize,this.opts.extra.heatmap.legend.cellSize,this.opts.extra.heatmap.legend.cellRadius),r+=this.opts.extra.heatmap.legend.cellSize+this.opts.extra.heatmap.legend.cellGap}),this.setTextAlign("left"),this.setFillStyle(this.opts.fontColor),t.fillText(this.opts.extra.heatmap.legend.labelMore,r+this.opts.extra.heatmap.legend.textGap,e),t.restore()}getDaysBetween(t,i){const e=new Date(t).getTime(),s=new Date(i).getTime();return Math.round(Math.abs((e-s)/864e5))}drawRoundedRect(t,i,e,s,o,a=!0,h=!1){if(o<=0)return a&&this.context.fillRect(t,i,e,s),void(h&&this.context.strokeRect(t,i,e,s));const n=Math.min(o,e/2,s/2);this.context.beginPath(),this.context.moveTo(t+n,i),this.context.arcTo(t+e,i,t+e,i+s,n),this.context.arcTo(t+e,i+s,t,i+s,n),this.context.arcTo(t,i+s,t,i,n),this.context.arcTo(t,i,t+e,i,n),this.context.closePath(),a&&this.context.fill(),h&&this.context.stroke()}fillSeriesData(){if(0==this.opts.series.length)return;let t=this.opts.series[0].data;if(0==t.length)return;this.drawData.year=new Date(t[0].date).getFullYear(),this.drawData.yearStart=new Date(this.drawData.year,0,1),this.drawData.yearEnd=new Date(this.drawData.year,11,31),this.drawData.startDate=new Date(this.drawData.yearStart);const i=this.drawData.startDate.getDay();this.drawData.startDate.setDate(this.drawData.startDate.getDate()-i),this.drawData.endDate=new Date(this.drawData.yearEnd);const e=this.drawData.endDate.getDay();this.drawData.endDate.setDate(this.drawData.endDate.getDate()+(6-e)),this.drawData.data=[];const s=new Date(this.drawData.startDate);for(;s<=this.drawData.endDate;){const i=s>=this.drawData.yearStart&&s<=this.drawData.yearEnd;let e=0;const o=s.toLocaleDateString("en-CA"),a=t.find(t=>new Date(t.date).toLocaleDateString("en-CA")===o);a&&(e=a.value);const h=this.opts.extra.heatmap.legend.colorLevels;let n;if(0===e)n=0;else{const t=4*h/(h-1);n=Math.min(h-1,Math.ceil(e/t))}this.drawData.data.push({date:new Date(s),contributions:e,level:n,isInYear:i}),s.setDate(s.getDate()+1)}}isPointInLegend(t,i){const e=this.layout.legendY-this.layout.legendHeight/2,s=this.layout.legendY+this.layout.legendHeight/2;return t>=this.layout.legendX&&t<=this.layout.legendX+this.layout.legendWidth&&i>=e&&i<=s}touchLegend(t,i){let e=this.getTouches(t);if(this.pagination.enabled&&this.checkNavigationClick(e.x,e.y))return;let s=this.isPointInLegend(e.x,e.y);console.log("####touchLegend",s)}showToolTip(t,e){let s=this.getTouches(t);if(this.opts=i.objectAssign({},this.opts,{_scrollDistance_:this.scrollOption.currentOffset,animation:!1}),this.isPointInLegend(s.x,s.y))return this.drawData.tooltip.visible=!1,void this.render();if(s.x<this.layout.gridStartX||s.y<this.layout.margins.top||s.x>this.layout.gridEndX||s.y>this.opts.height-this.layout.margins.bottom)return this.drawData.tooltip.visible=!1,void this.render();const o=this.pagination.enabled?this.pagination.pageData:this.drawData.data,a=7*Math.floor((s.x-this.layout.margins.left)/(this.layout.cellSize+this.opts.extra.heatmap.cellGap))+Math.floor((s.y-this.layout.margins.top)/(this.layout.cellSize+this.opts.extra.heatmap.cellGap));if(a>=0&&a<o.length){const t=o[a];if(t&&t.isInYear&&t.contributions>0){const i=t.date.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return this.drawData.tooltip={visible:!0,x:s.x,y:s.y,contributions:t.contributions,date:i},void this.render()}}this.drawData.tooltip.visible=!1,this.render()}checkNavigationClick(t,i){if(!this.pagination.enabled)return!1;const e=this.opts.height-this.layout.navigationHeight-5,s=this.opts.width/2,o=e-10;if(this.pagination.currentPage>0){const e=s-80;if(t>=e-30&&t<=e+30&&i>=o&&i<=o+20)return this.prevPage(),!0}if(this.pagination.currentPage<this.pagination.totalPages-1){const e=s+80;if(t>=e-30&&t<=e+30&&i>=o&&i<=o+20)return this.nextPage(),!0}return!1}drawTooltip(){if(!this.drawData.tooltip.visible)return;let t=i.objectAssign({},{showBox:!0,showArrow:!0,showCategory:!1,bgColor:"rgba(30, 30, 30, 0.9)",bgOpacity:.2,borderColor:"#000000",borderWidth:0,borderRadius:4,borderOpacity:.7,boxPadding:8,fontColor:"#FFFFFF",fontSize:13,lineHeight:20,splitLine:!0},this.opts.extra.tooltip);if(!t.showBox)return;const e="rgba(0, 0, 0, "+t.bgOpacity+")";let s=0;t.showArrow&&(s=4);let o=Number((.85*t.fontSize).toFixed());const a=this.context;a.save(),this.setFontSize(t.fontSize);const h=`${this.drawData.tooltip.contributions} contribution${1!==this.drawData.tooltip.contributions?"s":""}`,n=this.measureText(h,t.fontSize);this.setFontSize(o);const r=this.measureText(this.drawData.tooltip.date,o),l=Math.max(n,r)+2*t.boxPadding,p=t.fontSize+o+3*t.boxPadding;let c=this.drawData.tooltip.x+10,x=this.drawData.tooltip.y+10;c+l>this.opts.width&&(c=this.drawData.tooltip.x-l-10),x+p>this.opts.height&&(x=this.drawData.tooltip.y-p-10),this.setShadow(2,2,s,e),this.setFillStyle(t.bgColor),this.drawRoundedRect(c,x,l,p,t.borderRadius),a.shadowBlur=0,this.setFillStyle(t.fontColor),this.setFontSize(t.fontSize),a.fillText(h,c+t.boxPadding,x+t.boxPadding+t.fontSize),this.setFontSize(o),a.fillText(this.drawData.tooltip.date,c+t.boxPadding,x+t.boxPadding+t.fontSize+o+t.boxPadding),a.restore()}}class v{static createRenderer(t,i={}){switch(t.type){case"column":return new n(t,i);case"mount":return new r(t,i);case"bar":return new l(t,i);case"line":return new p(t,i);case"area":return new c(t,i);case"scatter":return new x(t,i);case"bubble":return new d(t,i);case"mix":return new g(t,i);case"pie":return new f(t,i);case"ring":return new y(t,i);case"rose":return new m(t,i);case"radar":return new b(t,i);case"word":return new A(t,i);case"arcbar":return new w(t,i);case"gauge":return new S(t,i);case"funnel":return new D(t,i);case"candle":return new T(t,i);case"map":return new P(t,i);case"heatmap":return new R(t,i);default:throw new Error(`Unsupported chart type: ${t.type}`)}}}var C=Object.freeze({__proto__:null,getGlobalConfig:()=>e,setGlobalConfig:s});const M=class{constructor(t){s({fontUnit:"px"});try{this.chartRenderer=v.createRenderer(t)}catch(t){throw new Error("Failed to create chart renderer")}t.context.canvas.onclick=t=>this.onclick(t),t.context.canvas.onmousemove=t=>this.onmousemove(t),t.context.canvas.onmousedown=t=>this.onmousedown(t),t.context.canvas.onmouseup=()=>this.onmouseup()}updateData(t){this.chartRenderer.updateData(t)}translate(t){var i;null===(i=this.chartRenderer)||void 0===i||i.translate(t)}addEventListener(t,i){var e;null===(e=this.chartRenderer)||void 0===e||e.on(t,i)}delEventListener(t){var i;null===(i=this.chartRenderer)||void 0===i||i.off(t)}onclick(t){var i,e;const s={x:t.offsetX,y:t.offsetY};null===(i=this.chartRenderer)||void 0===i||i.touchLegend(s),null===(e=this.chartRenderer)||void 0===e||e.showToolTip(s)}onmousemove(t){var i,e;const s={x:t.offsetX,y:t.offsetY};null===(i=this.chartRenderer)||void 0===i||i.scroll(s),null===(e=this.chartRenderer)||void 0===e||e.showToolTip(s)}onmousedown(t){var i;const e={x:t.offsetX,y:t.offsetY};null===(i=this.chartRenderer)||void 0===i||i.scrollStart(e)}onmouseup(){var t;null===(t=this.chartRenderer)||void 0===t||t.scrollEnd()}};return M.H5CanvasContext=class{constructor(t){this.ctx=t}get canvas(){return this.ctx.canvas}get width(){return this.ctx.canvas.offsetWidth}get height(){return this.ctx.canvas.offsetHeight}get fillStyle(){return this.ctx.fillStyle}set fillStyle(t){this.ctx.fillStyle=t}get strokeStyle(){return this.ctx.strokeStyle}set strokeStyle(t){this.ctx.strokeStyle=t}get lineWidth(){return this.ctx.lineWidth}set lineWidth(t){this.ctx.lineWidth=t}get lineCap(){return this.ctx.lineCap}set lineCap(t){this.ctx.lineCap=t}get font(){return this.ctx.font}set font(t){this.ctx.font=t}get textAlign(){return this.ctx.textAlign}set textAlign(t){this.ctx.textAlign=t}get textBaseline(){return this.ctx.textBaseline}set textBaseline(t){this.ctx.textBaseline=t}get shadowColor(){return this.ctx.shadowColor}set shadowColor(t){this.ctx.shadowColor=t}get shadowOffsetX(){return this.ctx.shadowOffsetX}set shadowOffsetX(t){this.ctx.shadowOffsetX=t}get shadowOffsetY(){return this.ctx.shadowOffsetY}set shadowOffsetY(t){this.ctx.shadowOffsetY=t}get shadowBlur(){return this.ctx.shadowBlur}set shadowBlur(t){this.ctx.shadowBlur=t}get lineJoin(){return this.ctx.lineJoin}set lineJoin(t){this.ctx.lineJoin=t}beginPath(){this.ctx.beginPath()}setLineDash(t){this.ctx.setLineDash(t)}measureText(t){const i=this.ctx.measureText(t);return{width:i.width,height:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent}}translate(t,i){this.ctx.translate(t,i)}rotate(t){this.ctx.rotate(t)}moveTo(t,i){this.ctx.moveTo(t,i)}lineTo(t,i){this.ctx.lineTo(t,i)}stroke(){this.ctx.stroke()}restore(){this.ctx.restore()}save(){this.ctx.save()}closePath(){this.ctx.closePath()}fillText(t,i,e,s){this.ctx.fillText(t,i,e,s)}fillRect(t,i,e,s){this.ctx.fillRect(t,i,e,s)}rect(t,i,e,s){this.ctx.rect(t,i,e,s)}fill(t){this.ctx.fill(t)}arc(t,i,e,s,o,a){this.ctx.arc(t,i,e,s,o,a)}clearRect(t,i,e,s){this.ctx.clearRect(t,i,e,s)}createLinearGradient(t,i,e,s){return this.ctx.createLinearGradient(t,i,e,s)}bezierCurveTo(t,i,e,s,o,a){this.ctx.bezierCurveTo(t,i,e,s,o,a)}quadraticCurveTo(t,i,e,s){this.ctx.quadraticCurveTo(t,i,e,s)}createRadialGradient(t,i,e,s,o,a){return this.ctx.createRadialGradient(t,i,e,s,o,a)}createCircularGradient(t,i,e){return this.createRadialGradient(t,i,0,t,i,e)}strokeText(t,i,e,s){this.ctx.strokeText(t,i,e,s)}strokeRect(t,i,e,s){this.ctx.strokeRect(t,i,e,s)}arcTo(t,i,e,s,o){this.ctx.arcTo(t,i,e,s,o)}},Object.assign(M,C),M});
//# sourceMappingURL=ucharts-v3.min.js.map
